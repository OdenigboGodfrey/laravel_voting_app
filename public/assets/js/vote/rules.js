!function(t){function e(e){for(var r,a,s=e[0],u=e[1],c=e[2],d=0,h=[];d<s.length;d++)a=s[d],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&h.push(i[a][0]),i[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);for(l&&l(e);h.length;)h.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,s=1;s<n.length;s++){var u=n[s];0!==i[u]&&(r=!1)}r&&(o.splice(e--,1),t=a(a.s=n[0]))}return t}var r={},i={3:0},o=[];function a(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=r,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(n,r,function(e){return t[e]}.bind(null,r));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var l=u;o.push([204,1,0]),n()}({204:function(t,e,n){"use strict";n.r(e);var r,i,o,a,s,u,c,l,d,h,f,p,g,v,m,y,b=n(3),E=n.n(b),w=n(4),T=n.n(w),N=n(5),R=n.n(N),C=n(6),S=n.n(C),D=n(7),k=n.n(D),I=n(2),O=n.n(I),A=n(0),x=n.n(A),_=n(15);!function(t){t.STATEMENT="statement",t.TABLE="table_reference",t.EXPRESSION="expression",t.FIELDS_LIST="fields_list",t.FIELD="field",t.UPDATE_FIELD="update_field",t.DELAYED_OPTION="delayed_option",t.LIMIT_OPTION="limit_option",t.ORDER_BY_OPTION="order_by_option",t.ORDER_BY_EXPRESSION="order_by_expression"}(r||(r={})),function(t){t.SELECT="select",t.UPDATE="update",t.INSERT="insert",t.DELETE="delete"}(i||(i={})),function(t){t.ALL_FIELDS="all",t.SPECIFIC_FIELDS="enumeration"}(o||(o={})),function(t){t.NUMBER="number",t.BOOLEAN="boolean",t.NULL="null",t.STRING="string",t.UNARY="unary",t.LOGICAL="logical",t.MATH="math",t.GROUP="group",t.IDENTIFIER="identifier",t.BINDING="binding",t.FUNCTION_CALL="function_call"}(a||(a={})),function(t){t.RANDOM="random",t.ORDERED="ordered"}(s||(s={})),function(t){t.ASCENDING="asc",t.DESCENDING="desc"}(u||(u={})),function(t){t.NOT="!",t.INVERT="-"}(c||(c={})),function(t){t.OR="||",t.AND="&&"}(l||(l={})),function(t){t.EQUALS="=",t.DIFFERENT="<>",t.LIKE="like",t.IN="in",t.LTE="<=",t.LT="<",t.GTE=">=",t.GT=">"}(d||(d={})),function(t){t.MULTIPLY="*",t.DIVISION="/",t.ADDITION="+",t.DIFFERENCE="-"}(h||(h={})),function(t){t.STRING="string",t.NUMBER="number",t.BOOLEAN="boolean",t.NULL="null",t.OBJECT="object"}(f||(f={})),function(t){t.STRING="string",t.INT="int",t.FLOAT="float",t.BOOLEAN="boolean"}(p||(p={})),function(t){t.IN_MEMORY="memory",t.REMOTE="remote"}(g||(g={})),function(t){t.READ="r",t.WRITE="w",t.READ_WRITE="rw"}(v||(v={})),function(t){t.FORM="private",t.GLOBAL="global"}(m||(m={})),function(t){t[t.INIT=0]="INIT",t[t.CHANGE=1]="CHANGE",t[t.CHECK=2]="CHECK",t[t.UNCHECK=3]="UNCHECK",t[t.TEXT_INPUT=4]="TEXT_INPUT",t[t.ALL_EVENTS=5]="ALL_EVENTS",t[t.REINITIALIZE=6]="REINITIALIZE",t[t.APPROVED=7]="APPROVED",t[t.SUBMITTED=8]="SUBMITTED",t[t.PREFILL=9]="PREFILL"}(y||(y={})),window.EJQLTableColumnType=f,window.EFormRuleEventType=y;var L=n(11),M=n.n(L),F=n(14);function P(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var B=function(){function t(){E()(this,t)}return T()(t,null,[{key:"create",value:function(t,e,n){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?P(Object(n),!0).forEach((function(e){x()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},{action:t,auth:e},{},n)}}]),t}(),U=n(19),V=n.n(U),j=function(){function t(){E()(this,t)}return T()(t,null,[{key:"getType",value:function(t){if(void 0===t)return null;if(null===t)return f.NULL;var e=V()(t);return"number"===e?isFinite(t)?f.NUMBER:null:"boolean"===e?f.BOOLEAN:"string"===e?f.STRING:"object"===e?f.OBJECT:null}},{key:"isNumeric",value:function(t){var e=this.getType(t);return e===f.NUMBER||e===f.STRING&&"-"!==t&&"+"!==t&&/^([\-+])?(0|[1-9]([0-9]+)?)?(\.[0-9]+)?/.test(t)}},{key:"getColumnDefinitions",value:function(t){for(var e,n=Object.create(null),r=0,i=(t||[]).length;r<i&&0===r;r++)for(var o in t[r])t[r].hasOwnProperty(o)&&(e=this.getType(t[r][o]),n[o]=e);var a=[];for(var s in n)null!==n[s]&&a.push({type:n[s],name:s});return a}},{key:"isReservedKeyword",value:function(t){return this.RESERVED_KEYWORDS.indexOf(String(t||""))>-1}},{key:"shuffleArray",value:function(t){for(var e=t.length-1;e>0;e--){var n=Math.floor(Math.random()*(e+1)),r=[t[n],t[e]];t[e]=r[0],t[n]=r[1]}return t}},{key:"compare",value:function(t,e){var n,r,i=this.getType(t),o=this.getType(e);if(null===i&&null===o)return 0;if(null===i||null===o)return null===i?-1:1;if(i===o)switch(i){case f.BOOLEAN:case f.NUMBER:case f.NULL:return t==e?0:t<e?-1:1;case f.STRING:n=String(t).toLowerCase(),r=String(e).toLowerCase()}else n=i!==f.STRING?i===f.NUMBER?String(t):i===f.NULL?"":t?"1":"0":String(t).toLowerCase(),r=o!==f.STRING?o===f.NUMBER?String(e):o===f.NULL?"":e?"1":"0":String(t).toLowerCase();return n===r?0:n<r?-1:1}},{key:"parseString",value:function(t){for(var e,n,r="",i=0,o=t.length;i<o;i++)if("\\"===(e=t.charAt(i)))switch(n=t.charAt(i+1),i++,n){case"r":r+="\r";break;case"n":r+="\n";break;case"t":r+="\t";break;case"\\":case"":r+="\\";break;default:r+=n}else r+=e;return r}},{key:"castToString",value:function(t){return!0===t?"1":!1===t?"0":String(t||"")}},{key:"compareAsStrings",value:function(t,e){var n=this.castToString(t).toLowerCase(),r=this.castToString(e).toLowerCase();return n===r?0:n>r?-1:1}},{key:"encodeData",value:function(t){return Object.keys(t).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])})).join("&")}},{key:"makeRequest",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.REQUEST_METHOD_GET,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.REQUEST_CONTENT_TYPE_PLAIN,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=new XMLHttpRequest;return a&&(s.withCredentials=!0),new Promise((function(a,u){s.onreadystatechange=function(){if(4===s.readyState)if(s.status>=200&&s.status<300){var e;switch(s.responseType){case t.REQUEST_RESPONSE_TYPE_TEXT:e=s.responseText;break;case t.REQUEST_RESPONSE_TYPE_JSON:case t.REQUEST_RESPONSE_TYPE_BLOB:case t.REQUEST_RESPONSE_TYPE_BUFFER:default:e="string"==typeof s.response?JSON.parse(s.response):s.response}a(e)}else u(s.statusText)},s.ontimeout=function(){u(s.statusText)},s.open(n,e,!0),i&&(s.responseType=i),r&&s.setRequestHeader("Content-Type",r),s.send(o)}))}}]),t}();x()(j,"REQUEST_METHOD_POST","POST"),x()(j,"REQUEST_METHOD_GET","GET"),x()(j,"REQUEST_CONTENT_TYPE_PLAIN","text/plain"),x()(j,"REQUEST_CONTENT_TYPE_HTML","text/html"),x()(j,"REQUEST_CONTENT_TYPE_JSON","application/json"),x()(j,"REQUEST_CONTENT_TYPE_MULTIPART","multipart/form-data"),x()(j,"REQUEST_CONTENT_TYPE_X_WWW_FORM_URLENCODED","application/x-www-form-urlencoded"),x()(j,"REQUEST_RESPONSE_TYPE_BUFFER","arraybuffer"),x()(j,"REQUEST_RESPONSE_TYPE_BLOB","blob"),x()(j,"REQUEST_RESPONSE_TYPE_TEXT","text"),x()(j,"REQUEST_RESPONSE_TYPE_JSON","json"),x()(j,"RESERVED_KEYWORDS",["select","from","where","in","limit","order","by","asc","update","table","set","insert","into","values","delete","like"]);var G=function(){function t(e,n,r){E()(this,t),x()(this,"numColumns",void 0),x()(this,"columns",{}),x()(this,"data",[]),x()(this,"rowIndex",void 0),this.numColumns=e.length;for(var i=0;i<this.numColumns;i++)this.columns[e[i].name]={type:e[i].type,index:i};this.data=n,this.rowIndex=r}return T()(t,[{key:"withIndex",value:function(t){return this.rowIndex=t,this}},{key:"withRowData",value:function(t){return this.data=t,this}},{key:"getDataAsArray",value:function(){return this.data}},{key:"getColumnValue",value:function(t){return this.data[this.columns[t].index]}},{key:"setColumnValue",value:function(t,e){this.data[this.columns[t].index]=e}},{key:"toObject",value:function(){var t,e=Object.create(null);for(var n in this.columns)void 0===(t=this.data[this.columns[n].index])&&(t=null),e[n]=t;return e}},{key:"getRowIndex",value:function(){return this.rowIndex}}],[{key:"createFromObject",value:function(e){var n=[],r=[];for(var i in e)n.push({type:f.NULL,name:i}),r.push(e[i]);return new t(n,r,0)}},{key:"createFromTable",value:function(e){return new t(e.describe(),e.createEmptyRow(),void 0)}}]),t}(),q=function(){function t(){E()(this,t),x()(this,"affectedRows",void 0),x()(this,"affectingRows",!1),x()(this,"calcFoundRows",void 0)}return T()(t,[{key:"getAffectedRows",value:function(){return this.affectedRows}},{key:"withAffectedRows",value:function(t){return this.affectedRows=~~t,this}},{key:"withCalcFoundRows",value:function(t){return this.calcFoundRows=t,this}},{key:"getCalcFoundRows",value:function(){return this.calcFoundRows}},{key:"hasRows",value:function(){return!1}},{key:"getRows",value:function(){return[]}},{key:"getRowsAsArray",value:function(){return[]}}]),t}(),H=function(){function t(e,n,r){E()(this,t),x()(this,"statement",void 0),x()(this,"db",void 0),x()(this,"markedRowsForDelete",void 0),x()(this,"bindings",void 0),this.statement=e,this.db=n,this.bindings=r}return T()(t,[{key:"execute",value:function(){var t=this;return function(){return new Promise((function(e,n){try{t.statement.bind(t.bindings,t.db)}catch(r){return void n(r)}t.db.getTable(t.statement.getTable().getName()).fetch().then((function(i){i.isTransactional()&&i.startTransaction();try{t.markedRowsForDelete=[];for(var o,a=i.createIterator(),s=t.statement.getFilter();o=a.next();)(null===s||!!s.compute(o))&&t.markedRowsForDelete.push({rowIndex:o.getRowIndex(),values:o.getDataAsArray()});if(!t.markedRowsForDelete.length)return i.isTransactional()&&i.commitTransaction(),void e((new q).withAffectedRows(0));if(t.applySorting(),t.applyLimits(),!t.markedRowsForDelete.length)return i.isTransactional()&&i.commitTransaction(),void e((new q).withAffectedRows(0));for(var u=0,c=t.markedRowsForDelete.length;u<c;u++)i.deleteRow(t.markedRowsForDelete[u].rowIndex);i.compact(),i.isTransactional()&&i.commitTransaction(),e((new q).withAffectedRows(t.markedRowsForDelete.length))}catch(r){console.error(r),i.isTransactional()&&i.rollbackTransaction(),n(new Error("Failed to execute DELETE statement!"))}})).catch((function(t){console.error(t),n(new Error("Failed to fetch table from server!"))}))}))}}},{key:"applySorting",value:function(){var t=this.statement.getSorter(),e=this.db.getTable(this.statement.getTable().getName());if(t&&!(this.markedRowsForDelete.length<2)){if(t.isRandom())return j.shuffleArray(this.markedRowsForDelete);var n=t.getSortExpressions(),r=n.length,i=function(){for(var t=[],i=0;i<r;i++)i===r-1?t.push(function(t){return function(e,r){var i=n[t].getExpression().compute(e),o=n[t].getExpression().compute(r),a=j.compare(i,o);return n[t].getDirection()===u.DESCENDING&&(a=-a),a}}(i)):t.push(function(e){return function(r,i){var o=n[e].getExpression().compute(r),a=n[e].getExpression().compute(i),s=j.compare(o,a);return n[e].getDirection()===u.DESCENDING&&(s=-s),0===s?t[e+1](r,i):s}}(i));return function(n,r){return t[0](G.createFromTable(e).withRowData(n.values).withIndex(-1),G.createFromTable(e).withRowData(r.values).withIndex(-1))}}();this.markedRowsForDelete.sort(i)}}},{key:"applyLimits",value:function(){var t=this.statement.getLimit();t&&(this.markedRowsForDelete=this.markedRowsForDelete.slice(t.getSkip(),t.getSkip()+t.getLimit()))}}]),t}(),Q=function(){function t(e,n,r){E()(this,t),x()(this,"statement",void 0),x()(this,"db",void 0),x()(this,"bindings",void 0),this.statement=e,this.db=n,this.bindings=r}return T()(t,[{key:"execute",value:function(){var t=this;return function(){return new Promise((function(e,n){try{t.statement.bind(t.bindings,t.db)}catch(r){return void n(r)}t.db.getTable(t.statement.getTable().getName()).fetch().then((function(i){i.isTransactional()&&i.startTransaction();try{for(var o=G.createFromTable(i),a=0,s=t.statement.getFields(),u=s.length;a<u;a++)o.setColumnValue(s[a].getFieldName(),s[a].getExpression().compute(o));i.insertRow(o.getDataAsArray()),i.reIndex(),i.commitTransaction(),e((new q).withAffectedRows(1))}catch(r){i.isTransactional()&&i.rollbackTransaction(),console.error(r),n(new Error("Failed to execute INSERT statement"))}})).catch((function(t){console.error(t),n(new Error("Failed to fetch table from server!"))}))}))}}}]),t}(),J=n(78);function Y(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var W=function(t){S()(n,t);var e=Y(n);function n(){var t;E()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),x()(R()(t),"lastInsertId",void 0),t}return T()(n,[{key:"getLastInsertId",value:function(){return this.lastInsertId}},{key:"withLastInsertId",value:function(t){return this.lastInsertId=t,this}}]),n}(q);function z(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var K=function(t){S()(n,t);var e=z(n);function n(){var t;E()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),x()(R()(t),"rows",[]),t}return T()(n,[{key:"addRows",value:function(t){if(t&&t.length)for(var e=0,n=t.length;e<n;e++)this.rows.push(t[e]);return this}},{key:"hasRows",value:function(){return!0}},{key:"getAffectedRows",value:function(){return this.rows.length}},{key:"getRows",value:function(){return this.rows}},{key:"getRowsAsArray",value:function(){if(!this.rows||!this.rows.length)return[];for(var t,e,n,r,i=[],o=0,a=this.rows.length;o<a;o++){n=[],e=(t=Object.keys(this.rows[o])).length;for(var s=0;s<e;s++)void 0===(r=this.rows[o][t[s]])&&(r=null),n.push(r);i.push(n)}return i}}]),n}(q),$=function(){function t(e,n,r){E()(this,t),x()(this,"statement",void 0),x()(this,"db",void 0),x()(this,"bindings",void 0),this.statement=e,this.db=n,this.bindings=r}return T()(t,[{key:"execute",value:function(){var t=this;return function(){return new Promise((function(e,n){try{t.statement.bind(t.bindings,t.db)}catch(a){return void n(a)}var r=-1!==t.statement.getTable().name.indexOf("salesforcePrefill")?t.db.getRPCEndpointSalesforceName():t.db.getRPCEndpointName(),i=-1!==t.statement.getTable().name.indexOf("salesforcePrefill")?t.db.getAuthorizationTokenSalesforce():t.db.getAuthorizationToken(),o=B.create("query",i,{query:btoa(JSON.stringify(t.statement.getTokenizedStatement())),bindings:btoa(Object(J.b)(JSON.stringify(t.statement.getBindingData()))),applicationConfig:btoa(t.db.getApplicationConfig())});j.makeRequest(r,j.REQUEST_METHOD_POST,j.REQUEST_CONTENT_TYPE_X_WWW_FORM_URLENCODED,j.REQUEST_RESPONSE_TYPE_JSON,j.encodeData(o)).then((function(n){e(t.createStatementResult(n))})).catch((function(t){n(new Error(t))}))}))}}},{key:"createStatementResult",value:function(t){if(!M()(t,Object))throw new Error("Object expected!");if(void 0===t.resultType)throw new Error('Property "resultType" expected!');switch(t.resultType){case i.SELECT:var e=new K;return e.addRows(t.rows),e.withCalcFoundRows(t.foundRows),e;case i.UPDATE:var n=new q;return n.withAffectedRows(parseInt(t.affectedRows)||0),n;case i.INSERT:var r=new W;return r.withLastInsertId(parseInt(t.lastInsertId)||0),r.withAffectedRows(1),r;case i.DELETE:var o=new q;return o.withAffectedRows(parseInt(t.affectedRows)||0),o;default:throw new Error("Invalid server response resultType: ".concat(JSON.stringify(t.resultType)))}}}]),t}(),X=function(){function t(e,n,r){E()(this,t),x()(this,"statement",void 0),x()(this,"db",void 0),x()(this,"bindings",void 0),this.statement=e,this.db=n,this.bindings=r}return T()(t,[{key:"execute",value:function(){var e=this;return function(){return new Promise((function(n,r){try{e.statement.bind(e.bindings,e.db)}catch(a){return void r(a)}var i;if(e.statement.getTable())e.db.getTable(e.statement.getTable().getName()).fetch().then((function(o){try{i=e.applyLimit(e.applyColumnFiltering(e.applySorting(e.getStatementCandidateRows(o))));var s=(new K).addRows(i);e.statement.getUnion()?new t(e.statement.getUnion(),e.db,e.bindings).execute()().then((function(t){s.addRows(t.getRows()),n(s)})).catch((function(t){r(t)})):n(s)}catch(a){console.error(a),r(new Error("Failed to execute SELECT statement!"))}})).catch((function(t){console.error(t),r(new Error("Failed to fetch table from server!"))}));else try{i=[e.createSingleStatementRow()];var o=(new K).addRows(i);e.statement.getUnion()?new t(e.statement.getUnion(),e.db,e.bindings).execute()().then((function(t){o.addRows(t.getRows()),n(o)})).catch((function(t){r(t)})):n(o)}catch(a){console.error(a),r(new Error("Failed to execute INSERT statement!"))}}))}}},{key:"createSingleStatementRow",value:function(){var t,e,n=Object.create(null),r=new G([],[],0),i=this.statement.getFields();if(i.isSelectingAllFields())return n;for(var o=0,a=i.getFields(),s=a.length;o<s;o++)e=a[o].getLiteral(),t=a[o].getExpression().compute(r),null===e&&(e=a[o].getExpression().getLiteral()),n[e]=t;return n}},{key:"getStatementCandidateRows",value:function(t){var e,n,r,i,o,a,s=t.createIterator(),u=[],c=this.statement.getFields(),l=c.isSelectingAllFields(),d=c,h=this.statement.getFilter();for(l||(n=d.getFields());e=s.next();)if(!h||!!h.compute(e))if(l)u.push(e.toObject());else{r=Object.create(null);for(var f=0,p=n.length;f<p;f++)a=n[f].getLiteral(),o=n[f].getExpression().compute(e),null===a&&(a=n[f].getExpression().getLiteral()),r[a]=o;for(var g in(i=e.toObject())["."]=r,r)i[g]=r[g];u.push(i)}return u}},{key:"applySorting",value:function(t){var e=this.statement.getSorter();if(!e||t.length<2)return t;if(e.isRandom())return j.shuffleArray(t);var n=e.getSortExpressions(),r=n.length,i=function(){for(var t=[],e=0;e<r;e++)e===r-1?t.push(function(t){return function(e,r){var i=n[t].getExpression().compute(e),o=n[t].getExpression().compute(r),a=j.compare(i,o);return n[t].getDirection()===u.DESCENDING&&(a=-a),a}}(e)):t.push(function(e){return function(r,i){var o=n[e].getExpression().compute(r),a=n[e].getExpression().compute(i),s=j.compare(o,a);return n[e].getDirection()===u.DESCENDING&&(s=-s),0===s?t[e+1](r,i):s}}(e));return function(e,n){return t[0](G.createFromObject(e),G.createFromObject(n))}}();return t.sort(i)}},{key:"applyLimit",value:function(t){var e=this.statement.getLimit();return e?t.slice(e.getSkip(),e.getSkip()+e.getLimit()):t}},{key:"applyColumnFiltering",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++)e.push(void 0===t[n]["."]?t[n]:t[n]["."]);return e}}]),t}(),Z=function(){function t(e,n,r){E()(this,t),x()(this,"statement",void 0),x()(this,"db",void 0),x()(this,"markedRowsForUpdate",void 0),x()(this,"bindings",void 0),this.statement=e,this.db=n,this.bindings=r}return T()(t,[{key:"execute",value:function(){var t=this;return function(){return new Promise((function(e,n){try{t.statement.bind(t.bindings,t.db)}catch(r){return void n(r)}t.db.getTable(t.statement.getTable().getName()).fetch().then((function(i){i.isTransactional()&&i.startTransaction();try{t.markedRowsForUpdate=[];for(var o,a=i.createIterator(),s=t.statement.getFilter();o=a.next();)(null===s||!!s.compute(o))&&t.markedRowsForUpdate.push({rowIndex:o.getRowIndex(),values:o.getDataAsArray()});if(!t.markedRowsForUpdate.length)return i.isTransactional()&&i.commitTransaction(),void e((new q).withAffectedRows(0));if(t.applySorting(),t.applyLimits(),!t.markedRowsForUpdate.length)return i.isTransactional()&&i.commitTransaction(),void e((new q).withAffectedRows(0));for(var u,c,l=(new q).withAffectedRows(t.markedRowsForUpdate.length),d=G.createFromTable(i),h=t.statement.getFields(),f=h.length,p=0,g=t.markedRowsForUpdate.length;p<g;p++){d.withIndex(t.markedRowsForUpdate[p].rowIndex).withRowData(t.markedRowsForUpdate[p].values);for(var v=0;v<f;v++)u=h[v].getFieldName(),c=h[v].getExpression().compute(d),d.setColumnValue(u,c);i.replace(t.markedRowsForUpdate[p].rowIndex,d.getDataAsArray())}i.reIndex(),i.isTransactional()&&i.commitTransaction(),e(l)}catch(r){console.error(r),i.isTransactional()&&i.rollbackTransaction(),n(new Error("Failed to execute UPDATE statement!"))}})).catch((function(t){console.error(t),n(new Error("Failed to fetch table from server!"))}))}))}}},{key:"applySorting",value:function(){var t=this.statement.getSorter(),e=this.db.getTable(this.statement.getTable().getName());if(t&&!(this.markedRowsForUpdate.length<2)){if(t.isRandom())return j.shuffleArray(this.markedRowsForUpdate);var n=t.getSortExpressions(),r=n.length,i=function(){for(var t=[],i=0;i<r;i++)i===r-1?t.push(function(t){return function(e,r){var i=n[t].getExpression().compute(e),o=n[t].getExpression().compute(r),a=j.compare(i,o);return n[t].getDirection()===u.DESCENDING&&(a=-a),a}}(i)):t.push(function(e){return function(r,i){var o=n[e].getExpression().compute(r),a=n[e].getExpression().compute(i),s=j.compare(o,a);return n[e].getDirection()===u.DESCENDING&&(s=-s),0===s?t[e+1](r,i):s}}(i));return function(n,r){return t[0](G.createFromTable(e).withRowData(n.values).withIndex(-1),G.createFromTable(e).withRowData(r.values).withIndex(-1))}}();this.markedRowsForUpdate.sort(i)}}},{key:"applyLimits",value:function(){var t=this.statement.getLimit();t&&(this.markedRowsForUpdate=this.markedRowsForUpdate.slice(t.getSkip(),t.getSkip()+t.getLimit()))}}]),t}(),tt=n(209),et=n(207),nt=function(){function t(e){E()(this,t),x()(this,"queryId",0),x()(this,"database",void 0),x()(this,"queue",[]),x()(this,"isRunning",!1),this.database=e}return T()(t,[{key:"scheduleStatement",value:function(t,e){var n=this;return Object(tt.a)(this.queue,(function(e){return e.statement===t}))&&Object(et.a)(this.queue,(function(e){return e.statement===t})),new Promise((function(r,i){n.queryId++,n.queue.push({queryId:n.queryId,statement:t,strategy:e,resolve:r,reject:i}),1!==n.queue.length||n.isRunning||(n.database.trigger("busy"),n.next())}))}},{key:"next",value:function(){var t=this;if(!this.isRunning){var e=this.queue.shift();if(void 0!==e){this.isRunning=!0;var n=function(){e.strategy.execute()().then((function(t){e.resolve(t)})).catch((function(t){e.reject(t)})).finally((function(){t.isRunning=!1,t.queue.length?t.next():t.database.trigger("idle")}))};0===this.queue.length%5?setTimeout(n):n()}else this.database.trigger("idle")}}}]),t}(),rt=function t(){E()(this,t)};function it(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var ot=function(t){S()(n,t);var e=it(n);function n(){var t;E()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),x()(R()(t),"literal",void 0),t}return T()(n,[{key:"getOpcodeType",value:function(){return r.EXPRESSION}},{key:"getLiteral",value:function(){return void 0!==this.literal||(this.literal=this.toString().replace(/["']+/g,"").trim()),this.literal}}]),n}(rt);function at(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var st=function(t){S()(n,t);var e=at(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"bindingName",void 0),x()(R()(r),"bindingValue",void 0),r.bindingName=t.name,r}return T()(n,[{key:"getExpressionType",value:function(){return a.BINDING}},{key:"getBindingName",value:function(){return this.bindingName}},{key:"getBindedValue",value:function(){if(void 0===this.bindingValue)throw new Error("Binding "+JSON.stringify(this.bindingName)+" is not binded!");return this.bindingValue}},{key:"getBindings",value:function(){return[this]}},{key:"getFunctions",value:function(){return[]}},{key:"getIdentifiers",value:function(){return[]}},{key:"bind",value:function(t){return this.bindingValue=t,this}},{key:"unbind",value:function(){return this.bindingValue=void 0,this}},{key:"compute",value:function(t){if(void 0!==this.bindingValue)return this.bindingValue;throw new Error("Failed to compute binding: Binding "+this.bindingName+" is not binded!")}},{key:"toString",value:function(){return":"+this.bindingName}}]),n}(ot);function ut(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var ct=function(t){S()(n,t);var e=ut(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"value",void 0),r.value=t.value,r}return T()(n,[{key:"getExpressionType",value:function(){return a.BOOLEAN}},{key:"getBindings",value:function(){return[]}},{key:"getIdentifiers",value:function(){return[]}},{key:"getFunctions",value:function(){return[]}},{key:"compute",value:function(t){return this.value}},{key:"toString",value:function(){return String(this.value)}}]),n}(ot);function lt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var dt=function(t){S()(n,t);var e=lt(n);function n(t){var r;E()(this,n),r=e.call(this),x()(R()(r),"functionName",void 0),x()(R()(r),"arguments",[]),x()(R()(r),"database",null),r.functionName=t.function_name;for(var i=0,o=t.arguments.length;i<o;i++)r.arguments.push(Ge.create(t.arguments[i]));return r}return T()(n,[{key:"getExpressionType",value:function(){return a.FUNCTION_CALL}},{key:"getFunctionName",value:function(){return this.functionName}},{key:"getArguments",value:function(){return this.arguments}},{key:"getBindings",value:function(){for(var t=[],e=0,n=this.arguments.length;e<n;e++)for(var r=0,i=this.arguments[e].getBindings(),o=i.length;r<o;r++)t.push(i[r]);return t}},{key:"getFunctions",value:function(){for(var t=[this],e=0,n=this.arguments.length;e<n;e++)for(var r=0,i=this.arguments[e].getFunctions(),o=i.length;r<o;r++)t.push(i[r]);return t}},{key:"getIdentifiers",value:function(){for(var t=[],e=0,n=this.arguments.length;e<n;e++)for(var r=0,i=this.arguments[e].getIdentifiers(),o=i.length;r<o;r++)t.push(i[r]);return t}},{key:"withDatabase",value:function(t){return this.database=t||null,this}},{key:"compute",value:function(t){if(this.database){for(var e=[],n=0,r=this.arguments.length;n<r;n++)e.push(this.arguments[n].compute(t));return this.database.callFunction(this.functionName,e)}throw new Error("Failed to call function "+JSON.stringify(this.functionName)+": Database not binded to function!")}},{key:"toString",value:function(){for(var t=this.functionName+"(",e=0,n=this.arguments.length;e<n;e++)t+=(0===e?"":", ")+this.arguments[e].toString();return t+")"}}]),n}(ot);function ht(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var ft=function(t){S()(n,t);var e=ht(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"expression",void 0),r.expression=Ge.create(t.expression),r}return T()(n,[{key:"getExpressionType",value:function(){return a.GROUP}},{key:"getBindings",value:function(){return this.expression.getBindings()}},{key:"getFunctions",value:function(){return this.expression.getFunctions()}},{key:"getIdentifiers",value:function(){return this.expression.getIdentifiers()}},{key:"compute",value:function(t){return this.expression.compute(t)}},{key:"toString",value:function(){return"("+this.expression.toString()+")"}}]),n}(ot);function pt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var gt=function(t){S()(n,t);var e=pt(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"identifierName",void 0),r.identifierName=t.name,r}return T()(n,[{key:"getExpressionType",value:function(){return a.IDENTIFIER}},{key:"getIdentifierName",value:function(){return this.identifierName}},{key:"getBindings",value:function(){return[]}},{key:"getFunctions",value:function(){return[]}},{key:"getIdentifiers",value:function(){return[this]}},{key:"compute",value:function(t){return t.getColumnValue(this.identifierName)}},{key:"toString",value:function(){return this.identifierName}}]),n}(ot);function vt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var mt=function(t){S()(n,t);var e=vt(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"left",void 0),x()(R()(r),"right",void 0),r.left=Ge.create(t.left),r.right=null===t.right?null:Ge.create(t.right),r}return T()(n,[{key:"getExpressionType",value:function(){return a.LOGICAL}},{key:"getLeftOperand",value:function(){return this.left}},{key:"getRightOperand",value:function(){return this.right}},{key:"getBindings",value:function(){for(var t=[],e=0,n=this.left.getBindings(),r=n.length;e<r;e++)t.push(n[e]);for(var i=0,o=this.right.getBindings(),a=o.length;i<a;i++)t.push(o[i]);return t}},{key:"getFunctions",value:function(){for(var t=[],e=0,n=this.left.getFunctions(),r=n.length;e<r;e++)t.push(n[e]);for(var i=0,o=this.right.getFunctions(),a=o.length;i<a;i++)t.push(o[i]);return t}},{key:"getIdentifiers",value:function(){for(var t=[],e=0,n=this.left.getIdentifiers(),r=n.length;e<r;e++)t.push(n[e]);for(var i=0,o=this.right.getIdentifiers(),a=o.length;i<a;i++)t.push(o[i]);return t}}]),n}(ot);function yt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var bt=function(t){S()(n,t);var e=yt(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return l.AND}},{key:"compute",value:function(t){return!(!this.left.compute(t)||!this.right.compute(t))}},{key:"toString",value:function(){return this.left.toString()+" and "+this.right.toString()}}]),n}(mt);function Et(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var wt=function(t){S()(n,t);var e=Et(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return d.EQUALS}},{key:"compute",value:function(t){var e=this.left.compute(t),n=this.right.compute(t);return isNaN(e)||isNaN(n)?e!=n||0!==j.compareAsStrings(e,n):Number(e)!=Number(n)}},{key:"toString",value:function(){return this.left.toString()+" <> "+this.right.toString()}}]),n}(mt);function Tt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Nt=function(t){S()(n,t);var e=Tt(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return d.EQUALS}},{key:"compute",value:function(t){var e=this.left.compute(t),n=this.right.compute(t);return isNaN(e)||isNaN(n)?e==n||0===j.compareAsStrings(e,n):Number(e)==Number(n)}},{key:"toString",value:function(){return this.left.toString()+" = "+this.right.toString()}}]),n}(mt);function Rt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Ct=function(t){S()(n,t);var e=Rt(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return d.GT}},{key:"compute",value:function(t){var e=this.left.compute(t),n=this.right.compute(t);return isNaN(e)||isNaN(n)?e>n||j.compareAsStrings(e,n)<0:Number(e)>Number(n)}},{key:"toString",value:function(){return this.left.toString()+" > "+this.right.toString()}}]),n}(mt);function St(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Dt=function(t){S()(n,t);var e=St(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return d.GTE}},{key:"compute",value:function(t){var e=this.left.compute(t),n=this.right.compute(t);return isNaN(e)||isNaN(n)?e>=n||j.compareAsStrings(e,n)<=0:Number(e)>=Number(n)}},{key:"toString",value:function(){return this.left.toString()+" >= "+this.right.toString()}}]),n}(mt);function kt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var It=function(t){S()(n,t);var e=kt(n);function n(t){var r;E()(this,n),r=e.call(this,t),x()(R()(r),"haystack",[]);for(var i=0,o=t.haystack.length;i<o;i++)r.haystack.push(Ge.create(t.haystack[i]));return r}return T()(n,[{key:"getOperator",value:function(){return d.IN}},{key:"compute",value:function(t){for(var e=this.left.compute(t),n=0,r=this.haystack.length;n<r;n++)if(this.equals(e,this.haystack[n].compute(t)))return!0;return!1}},{key:"equals",value:function(t,e){return isNaN(t)||isNaN(e)?t==e||0===j.compareAsStrings(t,e):Number(t)==Number(e)}},{key:"toString",value:function(){for(var t=this.left.toString()+" IN(",e=[],n=0,r=this.haystack.length;n<r;n++)e.push(this.haystack[n].toString());return t+e.join(", ")+")"}},{key:"getBindings",value:function(){for(var t=[],e=0,n=this.left.getBindings(),r=n.length;e<r;e++)t.push(n[e]);for(var i=0,o=this.haystack.length;i<o;i++)for(var a=0,s=this.haystack[i].getBindings(),u=s.length;a<u;a++)t.push(s[a]);return t}},{key:"getFunctions",value:function(){for(var t=[],e=0,n=this.left.getFunctions(),r=n.length;e<r;e++)t.push(n[e]);for(var i=0,o=this.haystack.length;i<o;i++)for(var a=0,s=this.haystack[i].getFunctions(),u=s.length;a<u;a++)t.push(s[a]);return t}},{key:"getIdentifiers",value:function(){for(var t=[],e=0,n=this.left.getIdentifiers(),r=n.length;e<r;e++)t.push(n[e]);for(var i=0,o=this.haystack.length;i<o;i++)for(var a=0,s=this.haystack[i].getIdentifiers(),u=s.length;a<u;a++)t.push(s[a]);return t}}]),n}(mt);function Ot(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var At=function(t){S()(n,t);var e=Ot(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return d.LIKE}},{key:"compute",value:function(t){return this.like(this.left.compute(t),this.right.compute(t))}},{key:"like",value:function(t,e){var n=j.castToString(t),r=j.castToString(e);return this.buildRegularExpression(r).test(n)}},{key:"buildRegularExpression",value:function(t){for(var e="^",n="",r=0,i=t.length;r<i;r++)switch(n=t.charAt(r)){case"%":e+="(.*)";break;case"\n":e+="\\n";break;case"\r":e+="\\r";break;case"\t":e+="\\t";break;case".":case"-":case"[":case"]":case"(":case")":case"?":case"!":case"^":case"$":case"\\":case"/":e+="\\"+n;break;default:e+=n}return new RegExp(e+"$","i")}},{key:"toString",value:function(){return this.left.toString()+" LIKE "+this.right.toString()}}]),n}(mt);function xt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var _t=function(t){S()(n,t);var e=xt(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return d.LT}},{key:"compute",value:function(t){var e=this.left.compute(t),n=this.right.compute(t);return isNaN(e)||isNaN(n)?e<n||j.compareAsStrings(e,n)>0:Number(e)<Number(n)}},{key:"toString",value:function(){return this.left.toString()+" < "+this.right.toString()}}]),n}(mt);function Lt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Mt=function(t){S()(n,t);var e=Lt(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return d.LTE}},{key:"compute",value:function(t){var e=this.left.compute(t),n=this.right.compute(t);return isNaN(e)||isNaN(n)?e<=n||j.compareAsStrings(e,n)>=0:Number(e)<=Number(n)}},{key:"toString",value:function(){return this.left.toString()+" <= "+this.right.toString()}}]),n}(mt);function Ft(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Pt=function(t){S()(n,t);var e=Ft(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return l.OR}},{key:"compute",value:function(t){return!(!this.left.compute(t)&&!this.right.compute(t))}},{key:"toString",value:function(){return this.left.toString()+" or "+this.right.toString()}}]),n}(mt);function Bt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Ut=function(t){S()(n,t);var e=Bt(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"left",void 0),x()(R()(r),"right",void 0),r.left=Ge.create(t.left),r.right=Ge.create(t.right),r}return T()(n,[{key:"getExpressionType",value:function(){return a.MATH}},{key:"getLeftOperand",value:function(){return this.left}},{key:"getRightOperand",value:function(){return this.right}},{key:"getBindings",value:function(){for(var t=[],e=0,n=this.left.getBindings(),r=n.length;e<r;e++)t.push(n[e]);for(var i=0,o=this.right.getBindings(),a=o.length;i<a;i++)t.push(o[i]);return t}},{key:"getFunctions",value:function(){for(var t=[],e=0,n=this.left.getFunctions(),r=n.length;e<r;e++)t.push(n[e]);for(var i=0,o=this.right.getFunctions(),a=o.length;i<a;i++)t.push(o[i]);return t}},{key:"getIdentifiers",value:function(){for(var t=[],e=0,n=this.left.getIdentifiers(),r=n.length;e<r;e++)t.push(n[e]);for(var i=0,o=this.right.getIdentifiers(),a=o.length;i<a;i++)t.push(o[i]);return t}}]),n}(ot);function Vt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var jt=function(t){S()(n,t);var e=Vt(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return h.ADDITION}},{key:"compute",value:function(t){return Number((Number(this.left.compute(t))+Number(this.right.compute(t))).toFixed(6))}},{key:"toString",value:function(){return this.left.toString()+" + "+this.right.toString()}}]),n}(Ut);function Gt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var qt=function(t){S()(n,t);var e=Gt(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return h.DIFFERENCE}},{key:"compute",value:function(t){return Number((Number(this.left.compute(t))-Number(this.right.compute(t))).toFixed(6))}},{key:"toString",value:function(){return this.left.toString()+" - "+this.right.toString()}}]),n}(Ut);function Ht(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Qt=function(t){S()(n,t);var e=Ht(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return h.DIVISION}},{key:"compute",value:function(t){return Number((Number(this.left.compute(t))/Number(this.right.compute(t))).toFixed(6))}},{key:"toString",value:function(){return this.left.toString()+" / "+this.right.toString()}}]),n}(Ut);function Jt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Yt=function(t){S()(n,t);var e=Jt(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return h.MULTIPLY}},{key:"compute",value:function(t){return Number((Number(this.left.compute(t))*Number(this.right.compute(t))).toFixed(6))}},{key:"toString",value:function(){return this.left.toString()+" * "+this.right.toString()}}]),n}(Ut);function Wt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var zt=function(t){S()(n,t);var e=Wt(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getExpressionType",value:function(){return a.NULL}},{key:"getBindings",value:function(){return[]}},{key:"getFunctions",value:function(){return[]}},{key:"getIdentifiers",value:function(){return[]}},{key:"compute",value:function(t){return null}},{key:"toString",value:function(){return"null"}}]),n}(ot);function Kt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var $t=function(t){S()(n,t);var e=Kt(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"value",void 0),r.value=t.value,r}return T()(n,[{key:"getExpressionType",value:function(){return a.NUMBER}},{key:"getBindings",value:function(){return[]}},{key:"getFunctions",value:function(){return[]}},{key:"getIdentifiers",value:function(){return[]}},{key:"compute",value:function(t){return this.value}},{key:"toString",value:function(){return String(this.value)}}]),n}(ot);function Xt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Zt=function(t){S()(n,t);var e=Xt(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"value",void 0),r.value=t.value,r}return T()(n,[{key:"getExpressionType",value:function(){return a.STRING}},{key:"getBindings",value:function(){return[]}},{key:"getFunctions",value:function(){return[]}},{key:"getIdentifiers",value:function(){return[]}},{key:"compute",value:function(t){return this.value}},{key:"toString",value:function(){return JSON.stringify(this.value)}}]),n}(ot);function te(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var ee=function(t){S()(n,t);var e=te(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"operand",void 0),r.operand=Ge.create(t.left),r}return T()(n,[{key:"getExpressionType",value:function(){return a.UNARY}},{key:"getOperand",value:function(){return this.operand}},{key:"getBindings",value:function(){return this.operand.getBindings()}},{key:"getFunctions",value:function(){return this.operand.getFunctions()}},{key:"getIdentifiers",value:function(){return this.operand.getIdentifiers()}}]),n}(ot);function ne(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var re=function(t){S()(n,t);var e=ne(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return c.INVERT}},{key:"compute",value:function(t){var e=this.operand.compute(t);return null===e?null:!0===e?-1:!1===e||isNaN(e)?0:-e}},{key:"toString",value:function(){return"-"+this.operand.toString()}}]),n}(ee);function ie(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var oe=function(t){S()(n,t);var e=ie(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOperator",value:function(){return c.NOT}},{key:"compute",value:function(t){return console.warn('TODO: Properly implement "Unary !" operator'),!this.operand.compute(t)}},{key:"toString",value:function(){return"!"+this.operand.toString()}}]),n}(ee);function ae(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var se=function(t){S()(n,t);var e=ae(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"limit",void 0),x()(R()(r),"skip",void 0),r.limit=t.limit,r.skip=t.skip,r}return T()(n,[{key:"getOpcodeType",value:function(){return r.LIMIT_OPTION}},{key:"getLimit",value:function(){return this.limit}},{key:"getSkip",value:function(){return this.skip}}]),n}(rt);function ue(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var ce=function(t){S()(n,t);var e=ue(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"direction",void 0),x()(R()(r),"expression",void 0),r.direction=t.direction,r.expression=Ge.create(t.expression),r}return T()(n,[{key:"getOpcodeType",value:function(){return r.ORDER_BY_EXPRESSION}},{key:"getDirection",value:function(){return this.direction}},{key:"getExpression",value:function(){return this.expression}}]),n}(rt);function le(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var de=function(t){S()(n,t);var e=le(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"strategy",void 0),r.strategy=t.type,r}return T()(n,[{key:"getOpcodeType",value:function(){return r.ORDER_BY_OPTION}}]),n}(rt);function he(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var fe=function(t){S()(n,t);var e=he(n);function n(t){var r;E()(this,n),r=e.call(this,t),x()(R()(r),"expressions",[]);for(var i=0,o=t.fields.length;i<o;i++)r.expressions.push(Ge.create(t.fields[i]));return r}return T()(n,[{key:"getSortExpressions",value:function(){return this.expressions}},{key:"isRandom",value:function(){return!1}}]),n}(de);function pe(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var ge=function(t){S()(n,t);var e=pe(n);function n(t){return E()(this,n),e.call(this,t)}return T()(n,[{key:"isRandom",value:function(){return!0}}]),n}(de);function ve(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var me=function(t){S()(n,t);var e=ve(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"remote",void 0),x()(R()(r),"binded",void 0),x()(R()(r),"statement",void 0),r.remote=t.remote,r.statement=t,r}return T()(n,[{key:"getOpcodeType",value:function(){return r.STATEMENT}},{key:"isRemote",value:function(){return this.remote}},{key:"bind",value:function(t,e){this.binded=!1;for(var n,r=this.getBindings(),i=r.length,o=t?"function"===typeof t?t():t:{},a=0;a<i;a++)r[a].unbind();for(var s=0;s<i;s++)if(void 0===o[n=r[s].getBindingName()]){if(!e||!e.autoBind(n,r[s]))throw new Error("Failed to bind statement: Binding "+JSON.stringify(n)+" is not defined in bind object, and is also not auto bindable!")}else r[s].bind(o[n]);return this.binded=!0,this}},{key:"getBindingData",value:function(){for(var t,e={},n=this.getBindings(),r=0,i=n.length;r<i;r++)void 0===e[t=n[r].getBindingName()]&&(e[t]=n[r].getBindedValue());return e}},{key:"isBinded",value:function(){return this.binded}},{key:"getTokenizedStatement",value:function(){return JSON.parse(JSON.stringify(this.statement))}}]),n}(rt);function ye(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var be=function(t){S()(n,t);var e=ye(n);function n(t){var r;return E()(this,n),r=e.call(this,t),x()(R()(r),"table",void 0),x()(R()(r),"filter",null),x()(R()(r),"sorter",null),x()(R()(r),"limit",null),r.table=Ge.create(t.table),t.where&&(r.filter=Ge.create(t.where)),t.orderBy&&(r.sorter=Ge.create(t.orderBy)),t.limit&&(r.limit=Ge.create(t.limit)),r}return T()(n,[{key:"getStatementType",value:function(){return i.DELETE}},{key:"getTable",value:function(){return this.table}},{key:"getFilter",value:function(){return this.filter}},{key:"getSorter",value:function(){return this.sorter}},{key:"getLimit",value:function(){return this.limit}},{key:"getBindings",value:function(){var t=[];if(this.filter)for(var e=this.filter.getBindings(),n=0,r=e.length;n<r;n++)t.push(e[n]);if(this.sorter&&!this.sorter.isRandom())for(var i=0,o=this.sorter.getSortExpressions(),a=o.length;i<a;i++)for(var s=0,u=o[i].getExpression().getBindings(),c=u.length;s<c;s++)t.push(u[i]);return t}},{key:"getFunctions",value:function(){var t=[];if(null!==this.filter)for(var e=this.filter.getFunctions(),n=0,r=e.length;n<r;n++)t.push(e[n]);if(null!==this.sorter&&!this.sorter.isRandom())for(var i=0,o=this.sorter.getSortExpressions(),a=o.length;i<a;i++)for(var s=0,u=o[i].getExpression().getFunctions(),c=u.length;s<c;s++)t.push(u[i]);return t}},{key:"getIdentifiers",value:function(){var t=[];if(null!==this.filter)for(var e=this.filter.getIdentifiers(),n=0,r=e.length;n<r;n++)t.push(e[n]);if(null!==this.sorter&&!this.sorter.isRandom())for(var i=0,o=this.sorter.getSortExpressions(),a=o.length;i<a;i++)for(var s=0,u=o[i].getExpression().getIdentifiers(),c=u.length;s<c;s++)t.push(u[s]);return t}}]),n}(me);function Ee(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var we=function(t){S()(n,t);var e=Ee(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"literal",null),x()(R()(r),"expression",void 0),r.literal=t.literal,r.expression=Ge.create(t.expression),r}return T()(n,[{key:"getOpcodeType",value:function(){return r.FIELD}},{key:"getLiteral",value:function(){return this.literal}},{key:"getExpression",value:function(){return this.expression}}]),n}(rt);function Te(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Ne=function(t){S()(n,t);var e=Te(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getOpcodeType",value:function(){return r.FIELDS_LIST}}]),n}(rt);function Re(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Ce=function(t){S()(n,t);var e=Re(n);function n(t){return E()(this,n),e.call(this)}return T()(n,[{key:"isSelectingAllFields",value:function(){return!0}}]),n}(Ne);function Se(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var De=function(t){S()(n,t);var e=Se(n);function n(t){var r;E()(this,n),r=e.call(this),x()(R()(r),"fields",[]);for(var i=0,o=t.fields.length;i<o;i++)r.fields.push(Ge.create(t.fields[i]));return r}return T()(n,[{key:"getFields",value:function(){return this.fields}},{key:"isSelectingAllFields",value:function(){return!1}}]),n}(Ne);function ke(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Ie=function(t){S()(n,t);var e=ke(n);function n(t){var r;E()(this,n),r=e.call(this,t),x()(R()(r),"table",void 0),x()(R()(r),"fields",[]),r.table=Ge.create(t.table);for(var i=0,o=t.fields.length;i<o;i++)r.fields.push(Ge.create(t.fields[i]));return r}return T()(n,[{key:"getStatementType",value:function(){return i.INSERT}},{key:"getTable",value:function(){return this.table}},{key:"getFields",value:function(){return this.fields}},{key:"getBindings",value:function(){for(var t=[],e=0,n=this.fields.length;e<n;e++)for(var r=0,i=this.fields[e].getExpression().getBindings(),o=i.length;r<o;r++)t.push(i[r]);return t}},{key:"getFunctions",value:function(){for(var t=[],e=0,n=this.fields.length;e<n;e++)for(var r=0,i=this.fields[e].getExpression().getFunctions(),o=i.length;r<o;r++)t.push(i[r]);return t}},{key:"getIdentifiers",value:function(){for(var t=[],e=0,n=this.fields.length;e<n;e++)for(var r=0,i=this.fields[e].getExpression().getIdentifiers(),o=i.length;r<o;r++)t.push(i[r]);return t}}]),n}(me),Oe=n(10),Ae=n.n(Oe);function xe(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var _e=function(t){S()(n,t);var e=xe(n);function n(t){var r;return E()(this,n),r=e.call(this,t),x()(R()(r),"fields",void 0),x()(R()(r),"table",null),x()(R()(r),"filter",null),x()(R()(r),"sorter",null),x()(R()(r),"limit",null),x()(R()(r),"calcFoundRows",void 0),x()(R()(r),"union",null),x()(R()(r),"previous",null),r.calcFoundRows=t.calcFoundRows,r.fields=Ge.create(t.fields),t.table&&(r.table=Ge.create(t.table),t.where&&(r.filter=Ge.create(t.where)),t.orderBy&&(r.sorter=Ge.create(t.orderBy)),t.limit&&(r.limit=Ge.create(t.limit))),t.union&&(r.union=Ge.create(t.union).withPreviousStatement(R()(r))),r}return T()(n,[{key:"isRemote",value:function(){return this.previous?this.previous.isRemote():Ae()(O()(n.prototype),"isRemote",this).call(this)}},{key:"getStatementType",value:function(){return i.SELECT}},{key:"getFields",value:function(){return this.fields}},{key:"getTable",value:function(){return this.table}},{key:"getFilter",value:function(){return this.filter}},{key:"getSorter",value:function(){return this.sorter}},{key:"getLimit",value:function(){return this.limit}},{key:"getUnion",value:function(){return this.union}},{key:"withPreviousStatement",value:function(t){return this.previous=t||null,this}},{key:"getBindings",value:function(){var t=[];if(null!==this.fields&&!this.fields.isSelectingAllFields())for(var e=0,n=this.fields.getFields(),r=n.length;e<r;e++)for(var i=0,o=n[e].getExpression().getBindings(),a=o.length;i<a;i++)t.push(o[i]);if(null!==this.filter)for(var s=this.filter.getBindings(),u=0,c=s.length;u<c;u++)t.push(s[u]);if(null!==this.sorter&&!this.sorter.isRandom())for(var l=0,d=this.sorter.getSortExpressions(),h=d.length;l<h;l++)for(var f=0,p=d[l].getExpression().getBindings(),g=p.length;f<g;f++)t.push(p[l]);return t}},{key:"getFunctions",value:function(){var t=[];if(null!==this.fields&&!this.fields.isSelectingAllFields())for(var e=0,n=this.fields.getFields(),r=n.length;e<r;e++)for(var i=0,o=n[e].getExpression().getFunctions(),a=o.length;i<a;i++)t.push(o[i]);if(null!==this.filter)for(var s=this.filter.getFunctions(),u=0,c=s.length;u<c;u++)t.push(s[u]);if(null!==this.sorter&&!this.sorter.isRandom())for(var l=0,d=this.sorter.getSortExpressions(),h=d.length;l<h;l++)for(var f=0,p=d[l].getExpression().getFunctions(),g=p.length;f<g;f++)t.push(p[l]);if(null!==this.union)for(var v=this.union.getFunctions(),m=0,y=v.length;m<y;m++)t.push(v[m]);return t}},{key:"getIdentifiers",value:function(){var t=[];if(null!==this.fields&&!this.fields.isSelectingAllFields())for(var e=0,n=this.fields.getFields(),r=n.length;e<r;e++)for(var i=0,o=n[e].getExpression().getIdentifiers(),a=o.length;i<a;i++)t.push(o[i]);if(null!==this.filter)for(var s=this.filter.getIdentifiers(),u=0,c=s.length;u<c;u++)t.push(s[u]);if(null!==this.sorter&&!this.sorter.isRandom())for(var l=0,d=this.sorter.getSortExpressions(),h=d.length;l<h;l++)for(var f=0,p=d[l].getExpression().getIdentifiers(),g=p.length;f<g;f++)t.push(p[f]);return t}},{key:"getCalcFoundRows",value:function(){return this.calcFoundRows}}]),n}(me);function Le(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Me=function(t){S()(n,t);var e=Le(n);function n(t){var r;E()(this,n),r=e.call(this,t),x()(R()(r),"table",void 0),x()(R()(r),"fields",[]),x()(R()(r),"filter",null),x()(R()(r),"limit",null),x()(R()(r),"sorter",null),x()(R()(r),"timer",null),r.table=Ge.create(t.table),t.delayed&&(r.timer=Ge.create(t.delayed));for(var i=0,o=t.fields.length;i<o;i++)r.fields.push(Ge.create(t.fields[i]));return t.where&&(r.filter=Ge.create(t.where)),t.limit&&(r.limit=Ge.create(t.limit)),t.orderBy&&(r.sorter=Ge.create(t.orderBy)),r}return T()(n,[{key:"getStatementType",value:function(){return i.UPDATE}},{key:"getTimer",value:function(){return this.timer}},{key:"getTable",value:function(){return this.table}},{key:"getFields",value:function(){return this.fields}},{key:"getFilter",value:function(){return this.filter}},{key:"getSorter",value:function(){return this.sorter}},{key:"getLimit",value:function(){return this.limit}},{key:"getBindings",value:function(){for(var t=[],e=0,n=this.fields.length;e<n;e++)for(var r=0,i=this.fields[e].getExpression().getBindings(),o=i.length;r<o;r++)t.push(i[r]);if(this.filter)for(var a=0,s=this.filter.getBindings(),u=s.length;a<u;a++)t.push(s[a]);if(this.sorter&&!this.sorter.isRandom())for(var c=0,l=this.sorter.getSortExpressions(),d=l.length;c<d;c++)for(var h=0,f=l[c].getExpression().getBindings(),p=f.length;h<p;h++)t.push(f[c]);return t}},{key:"getFunctions",value:function(){for(var t=[],e=0,n=this.fields.length;e<n;e++)for(var r=0,i=this.fields[e].getExpression().getFunctions(),o=i.length;r<o;r++)t.push(i[r]);if(this.filter)for(var a=0,s=this.filter.getFunctions(),u=s.length;a<u;a++)t.push(s[a]);if(this.sorter&&!this.sorter.isRandom())for(var c=0,l=this.sorter.getSortExpressions(),d=l.length;c<d;c++)for(var h=0,f=l[c].getExpression().getFunctions(),p=f.length;h<p;h++)t.push(f[c]);return t}},{key:"getIdentifiers",value:function(){for(var t=[],e=0,n=this.fields.length;e<n;e++)for(var r=0,i=this.fields[e].getExpression().getIdentifiers(),o=i.length;r<o;r++)t.push(i[r]);if(this.filter)for(var a=0,s=this.filter.getIdentifiers(),u=s.length;a<u;a++)t.push(s[a]);if(null!==this.sorter&&!this.sorter.isRandom())for(var c=0,l=this.sorter.getSortExpressions(),d=l.length;c<d;c++)for(var h=0,f=l[c].getExpression().getIdentifiers(),p=f.length;h<p;h++)t.push(f[h]);return t}}]),n}(me);function Fe(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Pe=function(t){S()(n,t);var e=Fe(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"timer",void 0),r.timer="number"===typeof t.timer?t.timer:null,r}return T()(n,[{key:"getOpcodeType",value:function(){return r.DELAYED_OPTION}},{key:"getTimerValueInMilliseconds",value:function(){return this.timer}}]),n}(rt);function Be(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Ue=function(t){S()(n,t);var e=Be(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"name",void 0),x()(R()(r),"expression",void 0),r.name=t.name,r.expression=Ge.create(t.expression),r}return T()(n,[{key:"getOpcodeType",value:function(){return r.UPDATE_FIELD}},{key:"getFieldName",value:function(){return this.name}},{key:"getExpression",value:function(){return this.expression}}]),n}(rt);function Ve(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var je=function(t){S()(n,t);var e=Ve(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"name",void 0),r.name=t.name,r}return T()(n,[{key:"getOpcodeType",value:function(){return r.TABLE}},{key:"getName",value:function(){return this.name}}]),n}(rt),Ge=function(){function t(){E()(this,t)}return T()(t,null,[{key:"create",value:function(t){switch(t.op){case r.STATEMENT:switch(t.type){case i.SELECT:return new _e(t);case i.INSERT:return new Ie(t);case i.UPDATE:return new Me(t);case i.DELETE:return new be(t);default:throw new Error("Cannot create statement from token: "+JSON.stringify(t))}case r.TABLE:return new je(t);case r.EXPRESSION:switch(t.type){case a.NUMBER:return new $t(t);case a.BOOLEAN:return new ct(t);case a.NULL:return new zt;case a.STRING:return new Zt(t);case a.UNARY:switch(t.operator){case c.INVERT:return new re(t);case c.NOT:return new oe(t);default:throw new Error("Cannot create unary expression from token: "+JSON.stringify(t))}case a.LOGICAL:switch(t.operator){case l.AND:return new bt(t);case l.OR:return new Pt(t);case d.EQUALS:return new Nt(t);case d.DIFFERENT:return new wt(t);case d.GT:return new Ct(t);case d.GTE:return new Dt(t);case d.LT:return new _t(t);case d.LTE:return new Mt(t);case d.LIKE:return new At(t);case d.IN:return new It(t);default:throw new Error("Cannot create logical expression from token: "+JSON.stringify(t))}case a.MATH:switch(t.operator){case h.ADDITION:return new jt(t);case h.DIFFERENCE:return new qt(t);case h.DIVISION:return new Qt(t);case h.MULTIPLY:return new Yt(t);default:throw new Error("Cannot create math expression from token: "+JSON.stringify(t))}case a.GROUP:return new ft(t);case a.IDENTIFIER:return new gt(t);case a.BINDING:return new st(t);case a.FUNCTION_CALL:return new dt(t);default:throw new Error("Unknown expression type: "+JSON.stringify(t))}case r.FIELDS_LIST:switch(t.type){case o.ALL_FIELDS:return new Ce(t);case o.SPECIFIC_FIELDS:return new De(t);default:throw new Error("Invalid lexer token select fields type: "+JSON.stringify(t))}case r.FIELD:return new we(t);case r.UPDATE_FIELD:return new Ue(t);case r.DELAYED_OPTION:return new Pe(t);case r.LIMIT_OPTION:return new se(t);case r.ORDER_BY_OPTION:switch(t.type){case s.RANDOM:return new ge(t);case s.ORDERED:return new fe(t);default:throw new Error("Invalid lexer token ORDER BY: "+JSON.stringify(t))}case r.ORDER_BY_EXPRESSION:return new ce(t);default:throw new Error("Invalid lexer token opcode type: "+JSON.stringify(t.op))}}}]),t}(),qe=function(){function t(){E()(this,t)}return T()(t,null,[{key:"assertJQLV1ConfigurationStructure",value:function(t){if(!M()(t,Object))throw new Error("Object expected!");if(void 0===t.controlId)throw new Error('Missing property "controlId"');if("string"!==typeof t.controlId)throw new Error('Property "controlId" type should be string');if(void 0===t.eventType)throw new Error('Missing property "eventType"');if("number"!==typeof t.eventType)throw new Error('Property "eventType" type should be number');if(!Array.isArray(t.actions))throw new Error('Missing property "actions"');if(void 0!==t.isRule&&"boolean"!==typeof t.isRule)throw new Error('Property "isRule" type should be boolean|undefined');for(var e=0,n=t.actions.length;e<n;e++)this.assertJQLV1EventActionStructure(t.actions[e])}},{key:"assertJQLV1EventActionStructure",value:function(t){if(!M()(t,Object))throw new Error("Action object expected!");if(void 0===t.controlId)throw new Error('Action property "controlId" type should be string');if("string"!==typeof t.controlId)throw new Error('Action property "controlId" should be string');if(void 0===t.jql)throw new Error('Action property "jql" should be string');if("string"!==typeof t.jql)throw new Error('Action property "jql" should be string')}}]),t}(),He=function(){function t(e,n){E()(this,t),x()(this,"descriptors",void 0),x()(this,"table",void 0),this.table=e,this.descriptors=(n||[]).slice(0)}return T()(t,[{key:"getDescriptors",value:function(){return this.descriptors}},{key:"getTable",value:function(){return this.table}}]),t}();function Qe(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Je=function(t){S()(n,t);var e=Qe(n);function n(t,r){return E()(this,n),e.call(this,t,[r])}return T()(n,[{key:"isUnique",value:function(){return!0}},{key:"isAutoIncrement",value:function(){return null}},{key:"getNextAutoIncrementValue",value:function(){return null}},{key:"index",value:function(){}}]),n}(He);function Ye(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var We=function(t){S()(n,t);var e=Ye(n);function n(t,r){var i;return E()(this,n),i=e.call(this,t,[r]),x()(R()(i),"unique",void 0),x()(R()(i),"autoIncrement",void 0),x()(R()(i),"values",void 0),x()(R()(i),"maxAutoIncrement",0),i.unique=!!r.unique,i.autoIncrement=!!r.autoIncrement,i}return T()(n,[{key:"isUnique",value:function(){return this.unique}},{key:"isAutoIncrement",value:function(){return this.autoIncrement}},{key:"getNextAutoIncrementValue",value:function(){if(this.autoIncrement)return this.maxAutoIncrement+1;throw new Error("Index is not auto-increment!")}},{key:"index",value:function(){this.values=[];var t,e,n=this.table.createIterator();for(this.maxAutoIncrement=0;t=n.next();){var r=t.getColumnValue(this.descriptors[0].name);if(null!==r){var i=String(r).toLowerCase();if(this.values.indexOf(e=i)>-1)throw new Error("Duplicate key "+JSON.stringify(this.descriptors[0].name)+" found with value "+JSON.stringify(e)+" found!");this.values.push(e),this.autoIncrement&&(this.maxAutoIncrement=Math.max(this.maxAutoIncrement,Number(e)))}}}}]),n}(He),ze=function(){function t(){E()(this,t)}return T()(t,null,[{key:"createFromIndexDescriptor",value:function(t,e){return t.getStorageEngine()===g.IN_MEMORY?new We(t,e):new Je(t,e)}}]),t}(),Ke=function(){function t(e){E()(this,t),x()(this,"identifiers",[]),x()(this,"emptyRow",[]),x()(this,"indexes",[]),x()(this,"autoIncrementColumnIndex",null),x()(this,"autoIncrementValue",1);for(var n=0,r=e||[],i=r.length;n<i;n++)if(this.identifiers.push(r[n]),void 0!==r[n].default)this.emptyRow.push(r[n].default);else switch(e[n].type){case f.NULL:this.emptyRow.push(null);break;case f.NUMBER:this.emptyRow.push(0);break;case f.STRING:this.emptyRow.push("");break;case f.BOOLEAN:this.emptyRow.push(!1);break;default:this.emptyRow.push(null)}}return T()(t,[{key:"withSingleColumnIndex",value:function(t){var e,n=0;if(this.indexes)for(var r=0,i=this.indexes.length;r<i;r++)this.indexes[r].isAutoIncrement()&&n++;if(void 0!==t.unique&&t.unique||void 0!==t.autoIncrement&&t.autoIncrement){if((e=ze.createFromIndexDescriptor(this,t)).isAutoIncrement()){if(n++,e.getDescriptors().length>1)throw new Error("Auto-increment indexes must refer to a single column only!");if(n>1)throw new Error("There can be only a single auto-increment index!");if(!e.isUnique())throw new Error("Auto-increment indexes must be unique!");for(var o=!1,a=0,s=this.identifiers.length;a<s;a++)if(this.identifiers[a].name===t.name){if(this.autoIncrementColumnIndex=a,o=!0,this.identifiers[a].type!==f.NUMBER)throw new Error("Auto-increment index column type must be NUMBER!");break}if(!o)throw new Error("Cannot add a index on a non-existing column!")}this.indexes.push(e)}return this}},{key:"describe",value:function(){return this.identifiers.slice(0)}},{key:"hasIdentifier",value:function(t){for(var e=0,n=this.identifiers.length;e<n;e++)if(this.identifiers[e].name===t)return!0;return!1}},{key:"createEmptyRow",value:function(){return this.emptyRow.slice(0)}},{key:"getIndexes",value:function(){return this.indexes}},{key:"reIndex",value:function(){for(var t=0,e=this.indexes.length;t<e;t++)this.indexes[t].index(),this.indexes[t].isAutoIncrement()&&this.setNextAutoIncrementValue(this.indexes[t].getNextAutoIncrementValue())}},{key:"fetch",value:function(){return Promise.resolve(this)}}]),t}(),$e=function(){function t(e){E()(this,t),x()(this,"table",void 0),x()(this,"index",0),x()(this,"row",void 0),this.table=e,this.row=new G(e.describe(),null,null)}return T()(t,[{key:"next",value:function(){var t=this.table.getRowAt(this.index);return null===t?null:(this.row.withIndex(this.index),this.row.withRowData(t),this.index++,this.row)}}]),t}();function Xe(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Ze=function(t){S()(n,t);var e=Xe(n);function n(t,r,i){var o;E()(this,n),o=e.call(this,t),x()(R()(o),"rows",[]),x()(R()(o),"lastTransactionSnapshot",void 0);for(var a=0,s=r.length;a<s;a++)o.rows.push(r[a]);if(i){if(!Array.isArray(i))throw new Error("Invalid class constructor argument: indexes: Expected array!");for(var u=0,c=i.length;u<c;u++)o.withSingleColumnIndex(i[u]);o.reIndex()}return o}return T()(n,[{key:"isRemote",value:function(){return!1}},{key:"getStorageEngine",value:function(){return g.IN_MEMORY}},{key:"getRowAt",value:function(t){return this.rows[t]||null}},{key:"createIterator",value:function(){return new $e(this)}},{key:"replace",value:function(t,e){if(!this.rows[t])throw new Error("Undefined table index: "+JSON.stringify(t));for(var n=0,r=this.rows[t].length;n<r;n++)this.rows[t][n]=e[n]}},{key:"deleteRow",value:function(t){this.rows[t]&&(this.rows[t]=null)}},{key:"insertRow",value:function(t){if(!t||void 0===t.length)throw new Error("Invalid argument row: array expected!");if(t.length!==this.identifiers.length)throw new Error("Row mismatch: Expected "+this.identifiers.length+" values, got "+t.length+" values!");null!==this.autoIncrementColumnIndex&&null===t[this.autoIncrementColumnIndex]&&(t[this.autoIncrementColumnIndex]=this.autoIncrementValue,this.autoIncrementValue++),this.rows.push(t)}},{key:"compact",value:function(){for(var t=this.rows.length-1;t>=0;t--)null===this.rows[t]&&this.rows.splice(t,1)}},{key:"isTransactional",value:function(){return!0}},{key:"startTransaction",value:function(){this.lastTransactionSnapshot=JSON.stringify(this.rows)}},{key:"commitTransaction",value:function(){if(void 0===this.lastTransactionSnapshot)throw new Error('No transaction started before!"');this.lastTransactionSnapshot=void 0}},{key:"rollbackTransaction",value:function(){if(void 0===this.lastTransactionSnapshot)throw new Error("Failed to rollback transaction: No transaction started before!");this.rows=JSON.parse(this.lastTransactionSnapshot)}},{key:"getNextAutoIncrementValue",value:function(){return this.autoIncrementValue+1}},{key:"setNextAutoIncrementValue",value:function(t){if("number"!==typeof t||!isFinite(t))throw new Error("Value is not finite!");if(t%1!==0)throw new Error("Value must be integer!");if(t<1)throw new Error("Value must be greater than 0!");this.autoIncrementValue=t}},{key:"alterIndexes",value:function(t){return Promise.reject()}},{key:"isIndexable",value:function(){return!0}},{key:"isVirtual",value:function(){return!1}}]),n}(Ke),tn=function(){function t(e){E()(this,t),x()(this,"table",void 0),x()(this,"cols",void 0),x()(this,"data",void 0),this.table=e,this.data=Object.create(null);for(var n=0,r=this.table.describe(),i=r.length;n<i;n++)!function(t,e,n){Object.defineProperty(n,String(t),{get:function(){return void 0===n.data[e]||void 0===n.data[e].get?void 0:n.data[e].get()},set:function(t){if(void 0===n.data[e]||void 0===n.data[e].set)throw new Error('Value "'+e+'" is read-only!');n.data[e].set(t)},enumerable:!0,configurable:!1})}(n,r[n].name,this),this.cols=n+1}return T()(t,[{key:"withPropertySetter",value:function(t,e){if(!this.table.hasIdentifier(t))throw new Error('Property "'+t+'" is not allowed!');return this.data[t]=this.data[t]||Object.create(null),this.data[t].set=e,this}},{key:"withPropertyGetter",value:function(t,e){if(!this.table.hasIdentifier(t))throw new Error('Property "'+t+'" is not allowed!');return this.data[t]=this.data[t]||Object.create(null),this.data[t].get=e,this}},{key:"length",get:function(){return this.cols}}]),t}();function en(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var nn=function(t){S()(n,t);var e=en(n);function n(t){return E()(this,n),e.call(this,t,[],void 0)}return T()(n,[{key:"createRow",value:function(){var t=new tn(this);return this.rows.push(t),t}},{key:"withSingleColumnIndex",value:function(t){throw new Error("Cannot add indexes on virtual tables!")}},{key:"replace",value:function(t,e){}},{key:"insertRow",value:function(t){throw new Error("Cannot insert rows on virtual tables!")}},{key:"deleteRow",value:function(t){throw new Error("Cannot delete rows from virtual tables!")}},{key:"isTransactional",value:function(){return!1}},{key:"startTransaction",value:function(){throw new Error("Transactions are not supported on virtual tables!")}},{key:"commitTransaction",value:function(){throw new Error("Transactions are not supported on virtual tables!")}},{key:"rollbackTransaction",value:function(){throw new Error("Transactions are not supported on virtual tables!")}},{key:"getNextAutoIncrementValue",value:function(){return 1}},{key:"isIndexable",value:function(){return!1}},{key:"isVirtual",value:function(){return!0}}]),n}(Ze);function rn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var on=function(t){S()(n,t);var e=rn(n);function n(t,r){var i;if(E()(this,n),i=e.call(this,t),r){if(!Array.isArray(r))throw new Error("Invalid class constructor argument: indexes: Expected array!");for(var o=0,a=r.length;o<a;o++)i.withSingleColumnIndex(r[o])}return i}return T()(n,[{key:"isRemote",value:function(){return!0}},{key:"getStorageEngine",value:function(){return g.REMOTE}},{key:"isTransactional",value:function(){return!1}},{key:"startTransaction",value:function(){throw new Error("Operation handled by backend!")}},{key:"commitTransaction",value:function(){throw new Error("Operation handled by backend!")}},{key:"rollbackTransaction",value:function(){throw new Error("Operation handled by backend!")}},{key:"getNextAutoIncrementValue",value:function(){throw new Error("Operation handled by backend!")}},{key:"setNextAutoIncrementValue",value:function(t){throw new Error("Operation handled by backend!")}},{key:"alterIndexes",value:function(t){return Promise.reject()}},{key:"isIndexable",value:function(){return!0}},{key:"isVirtual",value:function(){return!1}}]),n}(Ke),an=function(){function t(){E()(this,t)}return T()(t,null,[{key:"createVirtualTable",value:function(t){return new nn(t)}},{key:"createFromInMemoryArrayOfObjects",value:function(t,e,n){var r,i,o,a=void 0===e?j.getColumnDefinitions(t):e,s=[],u=a.length;if(!a.length)throw new Error('No valid columns were detected in "in-memory" array!');for(var c=0,l=t.length;c<l;c++){var d=0,h=void 0;for(h=0;h<u;h++)if(Array.isArray(t[c][a[h].name])){d=t[c][a[h].name].length;break}if(d>0)for(var p=0;p<d;p++){r=[];for(var g=0;g<u;g++)i=g==h?t[c][a[g].name][p]:t[c][a[g].name],null!==(o=j.getType(i))&&o===a[g].type||(i=null),r.push(i);s.push(r)}else{r=[];for(var v=0;v<u;v++)i=t[c][a[v].name],(o=j.getType(i))===f.OBJECT&&(i=i[Object.keys(i)[0]],o=j.getType(i)),null!==o&&o===a[v].type||(i=null),r.push(i);s.push(r)}}return new Ze(a,s,n)}},{key:"createFromRemoteTableDefinition",value:function(t,e){return new on(t,e)}}]),t}();window.JQLTableFactory=an;var sn=function(){function t(e,n){E()(this,t),x()(this,"identifiers",[]),x()(this,"indexes",[]),x()(this,"remote",void 0),x()(this,"storageEngine",void 0),x()(this,"db",void 0),x()(this,"table",void 0),x()(this,"name",void 0),x()(this,"deferredTable",null),this.db=n,this.name=e.name,this.remote=e.storageEngine===g.REMOTE,this.storageEngine=e.storageEngine,this.computeIdentifiers(e.schema),this.computeIndexDescriptors(e.indexes)}return T()(t,[{key:"describe",value:function(){return this.identifiers}},{key:"hasIdentifier",value:function(t){for(var e=0,n=this.identifiers.length;e<n;e++)if(this.identifiers[e].name===t)return!0;return!1}},{key:"isRemote",value:function(){return this.remote}},{key:"fetch",value:function(){var t=this;return this.table||(this.isRemote()?this.table=new Promise((function(e,n){t.deferredTable=an.createFromRemoteTableDefinition(t.describe(),t.indexes),e(t.deferredTable)})):this.table=new Promise((function(e,n){var r=-1!==t.name.indexOf("salesforcePrefill")?t.db.getAuthorizationTokenSalesforce():t.db.getAuthorizationToken(),i=B.create("fetch-table",r,{name:t.name,applicationConfig:btoa(t.db.getApplicationConfig())});j.makeRequest(-1!==t.name.indexOf("salesforcePrefill")?t.db.getRPCEndpointSalesforceName():t.db.getRPCEndpointName(),j.REQUEST_METHOD_POST,j.REQUEST_CONTENT_TYPE_X_WWW_FORM_URLENCODED,j.REQUEST_RESPONSE_TYPE_JSON,j.encodeData(i)).then((function(n){t.deferredTable=an.createFromInMemoryArrayOfObjects(n,t.identifiers,t.indexes),e(t.deferredTable)})).catch((function(t){n(new Error(t))}))}))),this.table}},{key:"getStorageEngine",value:function(){return this.storageEngine}},{key:"computeIdentifiers",value:function(e){for(var n in e)e.hasOwnProperty(n)&&this.identifiers.push({name:n,type:t.castBackendDataTypeToFrontendDataType(e[n]),default:null})}},{key:"computeIndexDescriptors",value:function(t){if(t){if(!Array.isArray(t))throw new Error("Invalid argument: indexes: array expected!");for(var e=0,n=t.length;e<n;e++)this.indexes.push(t[e])}}},{key:"getIndexes",value:function(){if(this.deferredTable)return this.deferredTable.getIndexes();for(var t=[],e=0,n=(this.indexes||[]).length;e<n;e++)t.push(ze.createFromIndexDescriptor(this,this.indexes[e]));return t}},{key:"alterIndexes",value:function(t){var e=this;return new Promise((function(n,r){e.db.alterTableIndexes(e.name,t).then((function(t){e.deferredTable=null,e.indexes=t.indexes,n(!0)})).catch((function(t){r(t)}))}))}},{key:"isIndexable",value:function(){return!this.deferredTable||this.deferredTable.isIndexable()}},{key:"isVirtual",value:function(){return!!this.deferredTable&&this.deferredTable.isVirtual()}},{key:"isTransactional",value:function(){return!this.deferredTable||this.deferredTable.isTransactional()}}],[{key:"castBackendDataTypeToFrontendDataType",value:function(t){switch(t){case p.BOOLEAN:return f.BOOLEAN;case p.FLOAT:case p.INT:return f.NUMBER;case p.STRING:return f.STRING;default:return f.NULL}}}]),t}();function un(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function cn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?un(Object(n),!0).forEach((function(e){x()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):un(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ln(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var dn,hn,fn=function(t){S()(n,t);var e=ln(n);function n(){var t;return E()(this,n),t=e.call(this),x()(R()(t),"functions",{}),x()(R()(t),"tables",{}),x()(R()(t),"planner",void 0),x()(R()(t),"authorizationToken",void 0),x()(R()(t),"authorizationTokenSalesforce",void 0),x()(R()(t),"rpcEndpointName",void 0),x()(R()(t),"rpcEndpointSalesforceName",void 0),x()(R()(t),"bindingProviders",[]),x()(R()(t),"onSchemaChanged",void 0),x()(R()(t),"applicationConfig",void 0),t.onSchemaChanged=F.a.create((function(){t.trigger("schema-changed")}),100),t}return T()(n,[{key:"initPlanner",value:function(){return this.planner=new nt(this),this}},{key:"withAuthorizationToken",value:function(t){return this.authorizationToken=t,this}},{key:"getAuthorizationToken",value:function(){return this.authorizationToken}},{key:"withApplicationConfig",value:function(t){return this.applicationConfig=t,this}},{key:"getApplicationConfig",value:function(){return this.applicationConfig}},{key:"withAuthorizationTokenSalesforce",value:function(t){return this.authorizationTokenSalesforce=t,this}},{key:"getAuthorizationTokenSalesforce",value:function(){return this.authorizationTokenSalesforce}},{key:"withRPCEndpointName",value:function(t){return this.rpcEndpointName=t,this}},{key:"getRPCEndpointName",value:function(){return this.rpcEndpointName}},{key:"withRPCEndpointSalesforceName",value:function(t){return this.rpcEndpointSalesforceName=t,this}},{key:"getRPCEndpointSalesforceName",value:function(){return this.rpcEndpointSalesforceName}},{key:"isValidIdentifierName",value:function(t){return"string"===typeof t&&/^[a-zA-Z$_][a-zA-Z0-9_$]+$/.test(t)}},{key:"withFunction",value:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this.isValidIdentifierName(t))throw new Error(JSON.stringify(t)+" is not a valid function name!");if(t=t.toLowerCase(),j.isReservedKeyword(t))throw new Error(JSON.stringify(t)+" is a reserved keyword and cannot be used as a function name!");if(void 0!==this.functions[t])throw new Error("Function "+JSON.stringify(t)+" already registered in database!");return this.functions[t]={func:e,local:n,remote:r},this}},{key:"hasLocalFunction",value:function(t){return!("string"!==typeof t||(t=t.toLowerCase(),void 0===this.functions[t]||!this.functions.hasOwnProperty(t)||!this.functions[t].local))}},{key:"hasRemoteFunction",value:function(t){return!("string"!==typeof t||(t=t.toLowerCase(),void 0===this.functions[t]||!this.functions.hasOwnProperty(t)||!this.functions[t].remote))}},{key:"callFunction",value:function(t,e){if(this.hasLocalFunction(t))return this.functions[t.toLowerCase()].func.apply(this,e);throw new Error("Failed to call function "+JSON.stringify(t)+": Function not defined!")}},{key:"getFunction",value:function(t){if(this.hasLocalFunction(t))return this.functions[t].func;throw new Error("Failed to get function "+JSON.stringify(t)+": Function not defined!")}},{key:"withTable",value:function(t,e){if(!this.isValidTableName(t))throw new Error(JSON.stringify(t)+" is not a valid table name!");if(void 0!==this.tables[t])throw new Error("Table "+JSON.stringify(t)+" already created!");return this.tables[t]=e,this.onSchemaChanged(),this}},{key:"isValidTableName",value:function(t){return"string"===typeof t&&/^[a-zA-Z0-9_\-$]+$/.test(t)}},{key:"withTablesList",value:function(t){for(var e=0,n=t.length;e<n;e++)this.withTable(t[e].name,new sn(t[e],this));return this.onSchemaChanged(),this}},{key:"hasTable",value:function(t){return"string"===typeof t&&void 0!==this.tables[t]&&this.tables.hasOwnProperty(t)}},{key:"enumerateTables",value:function(){var t=[];for(var e in this.tables)this.tables.hasOwnProperty(e)&&t.push({name:e,instance:this.tables[e]});return t}},{key:"getTable",value:function(t){if(this.hasTable(t))return this.tables[t];throw new Error("Table "+JSON.stringify(t)+" does not exist!")}},{key:"createStatement",value:function(t){if(!t||"string"!==typeof t)throw new Error("Invalid argument: statement: string expected!");if(!window.JQLGrammar)throw new Error("Cannot load JQLGrammar library!");var e=Ge.create(window.JQLGrammar.parse(t)),n=e.getTable();if(n){if(!this.hasTable(n.getName()))throw new Error("Failed to create statement: Table "+JSON.stringify(n.getName())+" does not exist!");for(var r=this.getTable(n.getName()),i=e.getIdentifiers(),o=0,a=i.length;o<a;o++)if(!r.hasIdentifier(i[o].getIdentifierName()))throw new Error("Unknown table identifier "+JSON.stringify(i[o].getIdentifierName()));if(r.isRemote()!==e.isRemote()){if(!e.isRemote())throw new Error("REMOTE statement clause is mandatory on encrypted tables");if(e.isRemote()&&r.isVirtual())throw new Error("REMOTE statements are not possible on virtual tables");if(r.isRemote()&&!e.isRemote())throw new Error("ENCRYPTED tables require remote statements")}}else if(e.getIdentifiers().length)throw new Error("A statement which does not affect a table cannot have identifiers!");for(var s=e.getFunctions(),u=0,c=s.length;u<c;u++){var l=s[u].getFunctionName();if(!e.isRemote()&&!this.hasLocalFunction(l)||e.isRemote()&&!this.hasRemoteFunction(l))throw new Error("Failed to create statement: Function "+JSON.stringify(s[u].getFunctionName())+" is not declared!");s[u].withDatabase(this)}return e}},{key:"executeStatement",value:function(t,e){try{return this.planner.scheduleStatement(t,this.createExecutionStrategy(t,e))}catch(n){return Promise.reject(n)}}},{key:"createExecutionStrategy",value:function(t,e){if(t.isRemote())return new $(t,this,e);switch(t.getStatementType()){case i.SELECT:return new X(t,this,e);case i.INSERT:return new Q(t,this,e);case i.UPDATE:return new Z(t,this,e);case i.DELETE:return new H(t,this,e);default:throw new Error("Failed to create execution strategy: Uknown statement type!")}}},{key:"createTableFromCSVFile",value:function(t){var e=this,n=new FormData;return n.append("action","create-table-from-csv"),n.append("auth",this.authorizationToken),n.append("csvFile",t.csvFile||""),n.append("setting",btoa(JSON.stringify({table:{name:t.tableName,namespace:t.tableNamespace,accessMode:t.tableAccessMode,storageEngine:t.tableStorageEngine},csvParser:{enclosure:j.parseString(t.csvFieldEnclosure),encloseAllFields:t.csvEncloseAllFields,delimiter:j.parseString(t.csvFieldDelimiter),escapeCharacter:j.parseString(t.csvEscapeCharacter),autoTrim:t.csvAutoTrim,lineTerminator:j.parseString(t.csvLineTerminator)}}))),new Promise((function(t,r){e.makePostRequest(n).then((function(n){e.withTablesList([n]),t(n)})).catch((function(t){r(new Error(t))}))}))}},{key:"dropTable",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.hasTable(t))return Promise.reject(new Error("Table '".concat(t,"' does not exist!")));var r=B.create("drop-table",this.authorizationToken,cn({name:t},n));return new Promise((function(n,i){e.makePostRequest(r).then((function(r){delete e.tables[t],e.onSchemaChanged(),n(r)})).catch((function(t){i(new Error(t))}))}))}},{key:"unmountTable",value:function(t){if(!this.hasTable(t))throw new Error("Failed to unmount table "+JSON.stringify(t)+": Table not found!");delete this.tables[t]}},{key:"alterTableIndexes",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.hasTable(t))return Promise.reject(new Error("Table '".concat(t,"' does not exist!")));var i=B.create("alter-table-indexes",this.authorizationToken,cn({name:t,indexes:btoa(JSON.stringify(e||null))},r));return new Promise((function(t,e){n.makePostRequest(i).then((function(e){t(e),n.onSchemaChanged()})).catch((function(t){e(new Error(t))}))}))}},{key:"autoBind",value:function(t,e){for(var n=0,r=this.bindingProviders.length;n<r;n++)if(this.bindingProviders[n].canBind(t))return e.bind(this.bindingProviders[n].getBindedValue(t)),!0;return!1}},{key:"withAutoBindingProvider",value:function(t){return this.bindingProviders.push(t),this}},{key:"getJQLFormConfiguration",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=B.create("fetch-form-events",this.authorizationToken,cn({},e));return new Promise((function(e,r){t.makePostRequest(n).then((function(t){e(t)})).catch((function(t){r(new Error(t))}))}))}},{key:"saveJQLFormConfiguration",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(!Array.isArray(t))throw new Error("Array of IJQLv1FormEventConfiguration expected");for(var r=0,i=t.length;r<i;r++)qe.assertJQLV1ConfigurationStructure(t[r]);for(var o=JSON.parse(JSON.stringify(t)),a=0,s=t.length;a<s;a++)for(var u=0,c=t[a].actions.length;u<c;u++)o[a].actions[u].statement=window.JQLGrammar.parse(t[a].actions[u].jql);var l=B.create("save-jql-configuration",this.authorizationToken,cn({configuration:btoa(JSON.stringify(o))},n));return new Promise((function(n,r){e.makePostRequest(l).then((function(){n(t)})).catch((function(t){r(new Error(t))}))}))}catch(d){return Promise.reject(d)}}},{key:"deleteAllAssociatedSettingsAndAllTables",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var n=B.create("delete-jql-configuration-and-associated-tables",this.authorizationToken,cn({},e));return new Promise((function(e,r){t.makePostRequest(n).then((function(t){e(t)})).catch((function(t){r(new Error(t))}))}))}catch(r){return Promise.reject(r)}}},{key:"downloadTableAsCSV",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.hasTable(t))return Promise.reject(new Error("Table '".concat(t,"' does not exist!")));var r=B.create("export-table",this.authorizationToken,cn({name:t},n));return new Promise((function(t,n){e.makePostRequest(r).then((function(e){t(e)})).catch((function(t){n(new Error(t))}))}))}},{key:"makePostRequest",value:function(t){return j.makeRequest(this.rpcEndpointName,j.REQUEST_METHOD_POST,M()(t,FormData)?j.REQUEST_CONTENT_TYPE_MULTIPART:j.REQUEST_CONTENT_TYPE_X_WWW_FORM_URLENCODED,j.REQUEST_RESPONSE_TYPE_JSON,M()(t,FormData)?t:j.encodeData(t))}},{key:"triggerNextQuery",value:function(){this.planner.next()}}]),n}(_.a);!function(t){t[t.BY_SETTING_THE_VALUE_ATTRIBUTE=0]="BY_SETTING_THE_VALUE_ATTRIBUTE",t[t.BY_SETTING_THE_CHECKED_ATTRIBUTE=1]="BY_SETTING_THE_CHECKED_ATTRIBUTE",t[t.BY_SETTING_OPTIONS_AND_THEN_VALUE=2]="BY_SETTING_OPTIONS_AND_THEN_VALUE",t[t.BY_CUSTOM_PLUGIN_WHICH_CAN_FAIL=3]="BY_CUSTOM_PLUGIN_WHICH_CAN_FAIL",t[t.BY_USING_PROPRIETARY_DOM_ABSTRACTION_LAYER_METHOD=4]="BY_USING_PROPRIETARY_DOM_ABSTRACTION_LAYER_METHOD"}(dn||(dn={})),function(t){t[t.LEGACY_EDITOR=0]="LEGACY_EDITOR",t[t.LATEST_EDITOR_VERSION=1]="LATEST_EDITOR_VERSION",t[t.LEGACY_SALESFORCE_EDITOR=2]="LEGACY_SALESFORCE_EDITOR",t[t.LATEST_SALESFORCE_EDITOR_VERSION=3]="LATEST_SALESFORCE_EDITOR_VERSION"}(hn||(hn={}));var pn=n(33),gn=function(){function t(){E()(this,t)}return T()(t,[{key:"NOT",value:function(t){return!t}}],[{key:"DATE_DIFF",value:function(e,n,r){void 0===r&&(r=t.DEFAULT_JQL_DATE_FORMAT);var i=t.timeUtils.parseDate(e,r),o=t.timeUtils.parseDate(n,r),a=i.getTime(),s=o.getTime();return Math.ceil(Math.abs(s-a)/864e5)}},{key:"DATE_BETWEEN",value:function(e,n,r,i){void 0===i&&(i=t.DEFAULT_JQL_DATE_FORMAT);var o=t.timeUtils.parseDate(n,i),a=t.timeUtils.parseDate(r,i),s=t.timeUtils.parseDate(e,i),u=o.getTime(),c=a.getTime(),l=s.getTime();return l>=Math.min(u,c)&&l<=Math.max(u,c)}},{key:"DATE_FORMAT",value:function(e,n,r){void 0===n&&(n=t.DEFAULT_JQL_DATE_FORMAT),void 0===r&&(r=t.DEFAULT_JQL_DATE_FORMAT),""===e&&(e=r.replace("%Y","1970").replace("%m","01").replace("%d","01"));var i=t.timeUtils.parseDate(e,r);return t.timeUtils.formatTime(Math.floor(i.getTime()/1e3),n)}},{key:"DATE_GET_NUMBER_OF_DAYS",value:function(e,n){void 0===n&&(n=t.DEFAULT_JQL_DATE_FORMAT);try{var r=e?t.timeUtils.parseDate(e,n):new Date;if(!r)return 0;var i=r.getMonth(),o=r.getDate(),a=r.getFullYear(),s=0===a%4;return 365*(a-1)+~~(a/4)+t.DAYS_MAPPINGS[i]+o+(s&&i<2?-1:0)}catch(u){return 0}}},{key:"TIME_GET_NUMBER_OF_MINUTES",value:function(e,n){void 0===n&&(n=t.DEFAULT_JQL_TIME_FORMAT);var r=e?t.timeUtils.parseDate(e,n):new Date;return r?60*r.getHours()+r.getMinutes():0}},{key:"CURRENT_DATE",value:function(e){var n=new Date;return n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0),t.timeUtils.formatTime(Math.floor(n.getTime()/1e3),e||t.DEFAULT_JQL_DATE_FORMAT)}},{key:"DATE_COMPARE",value:function(e,n,r){var i=t.timeUtils.parseDate(e,r||t.DEFAULT_JQL_DATE_FORMAT),o=t.timeUtils.parseDate(n,r||t.DEFAULT_JQL_DATE_FORMAT),a=i.getTime(),s=o.getTime();return a===s?0:a<s?-1:1}},{key:"TIME_COMPARE",value:function(e,n,r){if(""===e)return-1;var i=t.timeUtils.stringToTime(e,r||t.DEFAULT_JQL_DATE_FORMAT),o=t.timeUtils.stringToTime(n,r||t.DEFAULT_JQL_DATE_FORMAT),a=i.getTime(),s=o.getTime();return a===s?0:a<s?-1:1}},{key:"DATE_ADD_INTERVAL",value:function(e,n,r){var i,o,a,s=t.timeUtils.parseDate(e,r||t.DEFAULT_JQL_DATE_FORMAT),u=0,c=null,l=null,d=null,h=null,f=null,p=null,g=null,v=String(n||"").toLowerCase();for(["-","+"].indexOf(i=v.substr(0,1))>-1&&(u="-"===i?-1:1,v=v.substr(1));o=/^([\s]+)?([1-9]([\d]+)?)([\s]+)?(day(s)?|month(s)?|year(s)?|hour(s)?|minute(s)?|second(s)?|millisecond(s)?)([\s]+)?/.exec(v);)switch(v=v.substr(o[0].length),a=~~o[2],o[5]){case"day":case"days":c=null===c?a:c+a;break;case"month":case"months":l=null===l?a:l+a;break;case"year":case"years":d=null===d?a:d+a;break;case"hour":case"hours":h=null===h?a:h+a;break;case"minute":case"minutes":f=null===f?a:f+a;break;case"second":case"seconds":p=null===p?a:p+a;break;case"millisecond":case"milliseconds":g=null===g?a:g+a}return null!==g&&s.setMilliseconds(s.getMilliseconds()+u*g),null!==p&&s.setSeconds(s.getSeconds()+u*p),null!==f&&s.setMinutes(s.getMinutes()+u*f),null!==h&&s.setHours(s.getHours()+u*h),null!==c&&s.setDate(s.getDate()+u*c),null!==l&&s.setMonth(s.getMonth()+u*l),null!==d&&s.setFullYear(s.getFullYear()+u*d),t.timeUtils.formatTime(Math.floor(s.getTime()/1e3),r||t.DEFAULT_JQL_DATE_FORMAT)}},{key:"CONCAT",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e?e.join(""):""}},{key:"SUM",value:function(){for(var t,e=0,n=0,r=arguments.length;n<r;n++)t=parseFloat(n<0||arguments.length<=n?void 0:arguments[n]),!isNaN(t)&&isFinite(t)&&(e+=t);return e}},{key:"EQUALS",value:function(t,e){return t==e}},{key:"COMPARE",value:function(t,e){var n,r,i,o,a,s,u;return null===t&&null===e?0:null===t?-2:(!1===t&&(t="0"),!1!==e&&null!==e||(e="0"),!0===t&&(t="1"),!0===e&&(e="1"),"string"===(r=V()(t))||"string"===(i=V()(e))?(o="string"===r?t.toLowerCase():String(t).toLowerCase(),a="string"===i?e.toLowerCase():String(e).toLowerCase(),s=parseFloat(o),u=parseFloat(a),n=isFinite(s)&&isFinite(u)?s===u?0:s<u?-1:1:o===a?0:o<a?-1:1):n=t===e?0:t<e?-1:1,n)}},{key:"IF",value:function(t,e,n){return t?e:n}},{key:"BOOL",value:function(t){return"0"!==t&&t!==1/0||(t=~~t),!!t}},{key:"INT",value:function(e){if(t.BOOL(e)){var n=parseInt(String(e));return!isNaN(n)&&isFinite(n)?n:0}return 0}},{key:"FLOAT",value:function(e){if(t.BOOL(e)){var n=parseFloat(String(e));return!isNaN(n)&&isFinite(n)?n:0}return 0}},{key:"STRING",value:function(t){switch(t){case!1:return"false";case null:return"null";case 0:return"0";default:return String(t||"")}}},{key:"FROM_BASE64",value:function(t){return atob(t)}},{key:"TO_BASE64",value:function(t){return btoa(t)}},{key:"REPLACE",value:function(t,e,n){if(!e)return t;var r=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),i=new RegExp(r,"ig");return String(t).replace(i,String(n))}},{key:"ALERT",value:function(){for(var e=[],n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(var o=0,a=r.length;o<a;o++)(r[o]||0===r[o])&&e.push(String(r[o]));return e.length&&t.INTERFACE_ENABLED&&setTimeout((function(){alert(e.join(" "))}),100),e.length?e.join(" "):null}},{key:"UNIQUE_ID_BASED_ON_DATE_MILISECOND",value:function(){return(+new Date).toString(36)}},{key:"IN",value:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o;if(!r||!(o=r.length))return!1;for(var a=0;a<o;a++)if(0===t.COMPARE(e,r[a]))return!0;return!1}},{key:"onInterfaceEnabled",value:function(){t.INTERFACE_ENABLED=!0}}]),t}();function vn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}x()(gn,"timeUtils",void 0),x()(gn,"DEFAULT_JQL_DATE_FORMAT","%Y-%m-%d"),x()(gn,"DEFAULT_JQL_TIME_FORMAT","%H:%i:%s"),x()(gn,"INTERFACE_ENABLED",!1),x()(gn,"DAYS_MAPPINGS",[0,31,59,90,120,151,181,212,243,273,304,334]),gn.timeUtils=pn.a.createInstanceInNonSingletonModeWithoutInternationalizationSupport();var mn=function(t){S()(n,t);var e=vn(n);function n(t,r){var i,o;return E()(this,n),i=e.call(this),x()(R()(i),"jq",void 0),x()(R()(i),"controls",[]),x()(R()(i),"formRules",void 0),i.jq=t,i.formRules=r,i.initializeControlMappings(),i.initializeNativeDOMEventsBridge(),(o=R()(i)).on("initialize-platform-specific-tasks",(function(t){setTimeout((function(){o.initializePlatformSpecificTasks(t)}),500)})),setTimeout((function(){for(var t=0,e=o.controls.length;t<e;t++)o.formRules.getLogger().log('Trigger "control-event" EFormRuleEventType.INIT for',o.controls[t].controlId),o.trigger("control-event",y.INIT,o.controls[t].domNode,o.controls[t].controlId)}),100),setTimeout((function(){var t;if(null!==o.formRules.getPreviouslySubmittedFormData())for(var e=0,n=o.controls.length;e<n;e++)t=o.formRules.getSubmissionValueForControlId(o.controls[e].controlId),o.formRules.getLogger().log('Trigger "control-event" EFormRuleEventType.REINITIALIZE for',o.controls[e].controlId,"with value: ",JSON.stringify(t)),o.trigger("control-event",y.REINITIALIZE,o.controls[e].domNode,o.controls[e].controlId,t)}),110),setTimeout((function(){o.formRules.getLogger().log("Enabling user interface"),gn.onInterfaceEnabled()}),500),i}return T()(n,[{key:"clearControlsCache",value:function(){}},{key:"getControlValueById",value:function(t){var e,n,r=this.getControlById(t);if(null!==r)switch(n=r.nodeName.toLowerCase()){case"label":case"span":e=this.jq(r).text();break;default:e=this.jq(r).val()}else n="NULL";return this.formRules.getLogger().log("getControlValueById("+t+", "+n+" ) => ",JSON.stringify(e)),e}},{key:"castAnyToString",value:function(t){switch(V()(t)){case"string":return t;case"boolean":return t?"1":"0";case"number":return isFinite(t)?String(t):"0";default:return null===t?"":M()(t,Array)?this.castAnyToString(String(t.join("\t"))||""):String(JSON.stringify(t))}}},{key:"setupTextarea",value:function(t,e){var n=[];if(e)if("string"===typeof e)e&&(n=[String(e)]);else if(e&&M()(e,Array))for(var r=0,i=e.length;r<i;r++)if(e[r]){var o=this.castAnyToString(e[r]);o&&n.push(o)}t.value=n.join("\n")}},{key:"setupDropdown",value:function(t,e){var n,r,i=[];if(e)if("string"===typeof e)e&&(i=[String(e)]);else if(e&&M()(e,Array))for(var o=0,a=e.length;o<a;o++)if(e[o]){var s=this.castAnyToString(e[o]);s&&i.push(s)}for(;t.options.length;)t.remove(0);for(var u=0,c=i.length;u<c;u++)n=document.createElement("option"),r=i[u].split("\t"),n.text=r[0],n.value=r[1]||r[0],t.add(n);t.selectedIndex=i.length?0:-1,this.jq(t).parent().find(".select2-container > a > span:nth-child(1)").text(String(i[0]||"").split("\t")[0])}},{key:"setControlValueById",value:function(t,e){var r=this.getControlById(t);if(null!==r){var i,o=r.nodeName.toLowerCase();switch(o){case"input":switch(i=r.getAttribute("type")){case"checkbox":case"radio":r.checked=n.castAnyToCheckboxOrRadioValue(e),this.formRules.getLogger().log("setControlValueById("+t+" <"+i+">, "+JSON.stringify(n.castAnyToCheckboxOrRadioValue(e)));break;default:r.value=this.castAnyToString(e),this.reinitializeControlThirdPartyPluginsAfterItsValueHasBeenUpdated(r),this.formRules.getLogger().log("setControlValueById("+t+" <"+i+">, "+JSON.stringify(e))}break;case"textarea":this.setupTextarea(r,e),this.formRules.getLogger().log("setControlValueById("+t+" <"+o+">, "+JSON.stringify(e));break;case"select":this.setupDropdown(r,e),this.formRules.getLogger().log("setControlValueById("+t+" <"+o+">, "+JSON.stringify(e));break;case"label":case"span":this.formRules.getLogger().log("setControlValueById("+t+" <"+o+">, "+JSON.stringify(e)+": IGNORED");break;default:console.warn("AbstractionLayer: I don't know how to set the value for a input of type "+JSON.stringify(o))}}else this.formRules.getLogger().log("setControlValueById("+t+"): control not found!")}},{key:"getControlById",value:function(t){for(var e=String(t),n=0,r=this.controls.length;n<r;n++)if(this.controls[n].controlId===e)return this.controls[n].domNode;return null}},{key:"controlExistsInForm",value:function(t){var e=String(t);if(t){for(var n=0,r=this.controls.length;n<r;n++)if(e===this.controls[n].controlId)return!0;return!1}return!1}},{key:"isControl",value:function(t){return function(e,n){switch(t.nodeName.toLowerCase()){case"label":case"span":return n(t).closest(".uberfieldlat").hasClass("uberfieldlat");default:return!0}}(0,this.jq)}},{key:"initializeControlMappings",value:function(){var t;t=this,(0,this.jq)("form#mainform123 [id^=id123-control], form#mainform123 #id123-button-send, form#mainform123 [id^=id123-title]").each((function(){t.isControl(this)&&t.controls.push({controlId:n.getControlIdFromDOMNode(this),domNode:this})}))}},{key:"initializeNativeDOMEventsBridge",value:function(){var t;t=this,(0,this.jq)("form#mainform123").on("click","input[type=radio], input[type=checkbox]",(function(){t.trigger("control-event",this.checked?y.CHECK:y.UNCHECK,this,n.getControlIdFromDOMNode(this))})).on("change","select, input[type=text], input[type=number],input[type=email], input[type=password], textarea",(function(){t.trigger("control-event",y.CHANGE,this,n.getControlIdFromDOMNode(this))})).on("input","input:not([type=radio]):not([type=checkbox])",(function(){t.trigger("control-event",y.TEXT_INPUT,this,n.getControlIdFromDOMNode(this))}))}},{key:"getControlUpdateValueStrategy",value:function(t){var e=this.getControlById(t);if(null===e)return null;switch(e.nodeName.toLowerCase()){case"input":switch(e.getAttribute("type")){case"checkbox":case"radio":return dn.BY_SETTING_THE_CHECKED_ATTRIBUTE;default:return dn.BY_SETTING_THE_VALUE_ATTRIBUTE}case"textarea":return dn.BY_SETTING_THE_VALUE_ATTRIBUTE;case"select":return dn.BY_SETTING_OPTIONS_AND_THEN_VALUE;default:return dn.BY_CUSTOM_PLUGIN_WHICH_CAN_FAIL}}},{key:"initializeControlValueWhenTheFormIsPrefillingASubmission",value:function(t,e){var r,i=this.getControlUpdateValueStrategy(t);if(null!==i&&null!==e&&void 0!==e)switch(r=this.getControlById(t),i){case dn.BY_SETTING_THE_CHECKED_ATTRIBUTE:r.checked=n.castAnyToCheckboxOrRadioValue(e);break;case dn.BY_SETTING_THE_VALUE_ATTRIBUTE:r.value=String(e||"")||"";break;case dn.BY_SETTING_OPTIONS_AND_THEN_VALUE:this.setupDropdown(r,String(e||"")||""),r.selectedIndex=0;break;case dn.BY_USING_PROPRIETARY_DOM_ABSTRACTION_LAYER_METHOD:console.warn("DOMAbstractionLayer v1: Proprietary dom setters are not implemented by this abstraction layer");break;case dn.BY_CUSTOM_PLUGIN_WHICH_CAN_FAIL:}}},{key:"getControls",value:function(){return this.controls}},{key:"getJQuery",value:function(){return this.jq}},{key:"reinitializeControlThirdPartyPluginsAfterItsValueHasBeenUpdated",value:function(t){try{"datepicker"==t.dataset.toggle&&this.jq(t).datepicker("update",t.value)}catch(e){}}},{key:"initializePlatformSpecificTasks",value:function(t){if(t&&t.nextPreviewFormData)for(var e=function(e){return t.nextPreviewFormData[e||""]||null},n=this.getControls(),r=this.jq,i=0,o=n.length;i<o;i++)if(null!==e(n[i].controlId)&&""!=e(n[i].controlId)){var a=n[i].domNode;if("SELECT"==a.tagName){for(var s=r(a),u=0,c=s[0].options.length;u<c;u++)s[0].options[u].selected=s[0].options[u].value==e(n[i].controlId);-1!==a.className.indexOf("js-dropdown-searchable")?s.select2():s.trigger("change")}}}},{key:"getCurrentLanguage",value:function(){return"en"}}],[{key:"castAnyToCheckboxOrRadioValue",value:function(t){switch(!0){case"yes"===t:case!0===t:return!0;case"no"===t:case 0===t:return!1;default:return!!t}}},{key:"getControlIdFromDOMNode",value:function(t){return"id123-button-send"===t.id?"submit":String(t.id||t.name||"").replace(/^(id123-)?(control|title)/g,"").replace(/[^\d]+/g,"_")||null}}]),n}(_.a),yn=n(8),bn=function(){function t(e,n,r,i){E()(this,t),x()(this,"app",void 0),x()(this,"jq",void 0),x()(this,"notificationsAreaContainer",void 0),x()(this,"mainApplicationNode",void 0),this.app=e,this.jq=n,this.notificationsAreaContainer=r,this.mainApplicationNode=i}return T()(t,[{key:"alert",value:function(t,e,n,r){var i=this.createDialog(String(t||this.app.getI18n().translateText("myforms_UI_dlg_title_ALERT")),[{type:yn.c.OK,callback:function(t,e){n&&M()(n,Function)&&n(),e.close()}}],{width:r&&r.width?r.width:"500px",height:r&&r.height?r.height:void 0});i.body.textContent=String(e||"")||this.app.getI18n().translateText("myforms_UI_dlg_title_ALERT"),i.body.setAttribute("data-dialog-role","system-dialog")}},{key:"prompt",value:function(t,e,n,r){var i=this.createDialog(String(t||this.app.getI18n().translateText("myforms_UI_dlg_title_QUESTION")),[{type:yn.c.YES,callback:function(t,e){n&&M()(n,Function)&&n(),e.close()}},{type:yn.c.NO,callback:function(t,e){r&&M()(r,Function)&&(r(),yn.c.DOWNLOAD),e.close()}}],{width:"600px"});i.body.textContent=String(e||"")||this.app.getI18n().translateText("myforms_UI_dlg_title_QUESTION"),i.body.setAttribute("data-dialog-role","system-dialog")}},{key:"markNotificationTooltipAsClosed",value:function(t){var e=JSON.parse(localStorage.getItem("closed_notification_tooltips")||"{}");e[t]=1,localStorage.setItem("closed_notification_tooltips",JSON.stringify(e))}},{key:"isNotificationTooltipMarkedAsClosed",value:function(t){return!!JSON.parse(localStorage.getItem("closed_notification_tooltips")||"{}")[t]}},{key:"createNotificationTooltip",value:function(e,n){return function(r){var i=document.createElement("div"),o=document.createElement("div"),a=document.createElement("div"),s=document.createElement("div"),u=document.createElement("div");i.tabIndex=0,i.setAttribute("data-ui-tooltip-modal","1"),o.setAttribute("data-ui-tooltip-dialog","1"),o.setAttribute("data-placement",t.getNotificationTooltipPlacementAttribute(n.placement)),o.setAttribute(t.getNotificationTooltipStylingAttribute(n.tooltipType),"1"),a.setAttribute("data-ui-body","1"),u.setAttribute("data-ui-buttons","1"),1===e.length&&u.setAttribute("data-single-button-tooltip","1"),2===e.length&&u.setAttribute("data-two-buttons-tooltip","1"),i.appendChild(o),o.appendChild(a),a.appendChild(s);for(var c=!1,l={close:function(){c||(i.parentNode&&i.parentNode.removeChild(i),c=!0,n&&n.onCloseCallback&&n.onCloseCallback(l))},show:function(){o.removeAttribute("data-hide-tooltip")},hide:function(){o.setAttribute("data-hide-tooltip","")},persistentClose:function(){c||(i.parentNode&&i.parentNode.removeChild(i),c=!0,window.CFTracker&&window.CFTracker.event("tooltip_dismissed_".concat(n.tooltipId)),n&&n.tooltipId&&r.markNotificationTooltipAsClosed(n.tooltipId),n&&n.onCloseCallback&&n.onCloseCallback(l))},tooltip:s,body:a,tooltipId:n.tooltipId||null},d=0,h=e.length;d<h;d++)!function(e){var r=document.createElement("button");r.innerHTML=e.html||(e.i18nKey&&this.app.getI18n().translateText(e.i18nKey)!==e.i18nKey?this.app.getI18n().translateText(e.i18nKey):e.text),r.setAttribute(t.getNotificationTooltipStylingAttribute(n.tooltipType),"1"),r.onclick=function(){e.callback(l)},u.appendChild(r)}(e[d]);return o.appendChild(u),n&&(n.width&&(o.style.width=n.width),n.height&&(o.style.height=n.height)),n&&n.tooltipId&&r.isNotificationTooltipMarkedAsClosed(n.tooltipId)?setTimeout((function(){l.close()}),500):document.body.appendChild(i),i.focus(),l}(this)}},{key:"createDialog",value:function(e,n,r){return function(i,o){var a=document.createElement("div"),s=document.createElement("div"),u=document.createElement("div"),c=document.createElement("div"),l=document.createElement("div"),d=document.createElement("div"),h=document.createElement("div");a.tabIndex=0,a.className="ui-modal",s.className="ui-dialog",u.className="ui-titlebar",u.textContent=e,c.className="ui-titlebody",d.className="ui-body",h.className="ui-buttons bootstrap-iso",l.className="ui-close i123-close",a.appendChild(s),u.appendChild(c),u.appendChild(l),s.appendChild(u),s.appendChild(d);var f=!1;function p(t){var e;t.preventDefault(),t.stopPropagation(),o(h).find("> button").each((function(){switch(parseInt(o(this).attr("data-role").replace(/^button-type-/,""))){case yn.c.OK:case yn.c.YES:case yn.c.SAVE:case yn.c.FORM_MIGRATE:e||(e=this)}})),e&&o(e).click()}var g={close:function(){f||(o(d).find("form").off("submit",p),a.parentNode.removeChild(a),f=!0)},body:d,titlebody:c,dialog:s,setHTML:function(t){d.innerHTML=t,o(d).find("form").on("submit",p)},clearInlineErrors:function(){o(d).find("label.error").text("")},hide:function(){o(a).addClass("hidden")},show:function(){o(a).removeClass("hidden")},isClosed:function(){return f}};l.onclick=function(){if(r&&r.onCloseButtonClick)try{r.onCloseButtonClick()}catch(t){}g.close()},a.addEventListener("keyup",(function(t){27==(t.keyCode||t.charCode)&&(g.close(),r&&r.onCloseButtonClick&&r.onCloseButtonClick())}),!1);for(var v=0,m=n.length;v<m;v++)!function(e){var n=document.createElement("button");n.textContent=i.getDialogButtonLabel(e.type),h.appendChild(n),n.setAttribute("data-role","button-type-".concat(e.type)),n.className="btn ".concat(t.getDialogButtonClass(e.type)),n.onclick=function(){e.callback(e.type,g)}}(n[v]);return s.appendChild(h),r&&(r.width&&(s.style.width=r.width),r.height&&(s.style.height=r.height)),document.body.appendChild(a),a.focus(),a.addEventListener("keydown",(function(t){var e=t.target||t.srcElement;e&&-1===["input","select","textarea"].indexOf(e.nodeName.toLowerCase())&&(e.hasAttribute("data-allow-keyboard")||t.stopPropagation())}),!0),a.addEventListener("keypress",(function(t){var e=t.target||t.srcElement;e&&-1===["input","select","textarea"].indexOf(e.nodeName.toLowerCase())&&t.stopPropagation()}),!0),a.addEventListener("keyup",(function(t){var e=t.target||t.srcElement;e&&-1===["input","select","textarea"].indexOf(e.nodeName.toLowerCase())&&t.stopPropagation()}),!0),g}(this,this.jq)}},{key:"getDialogButtonLabel",value:function(t){switch(t){case yn.c.OK:return this.app.getI18n().translateText("myforms_UI_btn_OK");case yn.c.YES:return this.app.getI18n().translateText("myforms_UI_btn_YES");case yn.c.ABORT:return this.app.getI18n().translateText("myforms_UI_btn_ABORT");case yn.c.RETRY:return this.app.getI18n().translateText("myforms_UI_btn_RETRY");case yn.c.CANCEL:return this.app.getI18n().translateText("myforms_UI_btn_CANCEL");case yn.c.IGNORE:return this.app.getI18n().translateText("myforms_UI_btn_IGNORE");case yn.c.NO:return this.app.getI18n().translateText("myforms_UI_btn_NO");case yn.c.SAVE:return this.app.getI18n().translateText("myforms_UI_btn_SAVE");case yn.c.CHANGE:return this.app.getI18n().translateText("myforms_UI_btn_CHANGE");case yn.c.DELETE:return this.app.getI18n().translateText("myforms_UI_btn_DELETE");case yn.c.DOWNLOAD:return this.app.getI18n().translateText("myforms_UI_btn_DOWNLOAD");case yn.c.CLOSE:return this.app.getI18n().translateText("myforms_UI_btn_CLOSE");case yn.c.ENABLE_COMPLIANCE:return this.app.getI18n().translateText("myformsHipaaChangeStatusTitle0");case yn.c.DISABLE_COMPLIANCE:return this.app.getI18n().translateText("myformsHipaaChangeStatusTitle1");case yn.c.CREATE:return this.app.getI18n().translateText("applications_UI_btn_CREATE");case yn.c.DONE:return this.app.getI18n().translateText("applications_UI_btn_DONE");case yn.c.TRY_FORM:return this.app.getI18n().translateText("oldEditor_TryFormBtn");case yn.c.NO_THANKS:return this.app.getI18n().translateText("editForm_noThanksButton");case yn.c.UPDATE:return this.app.getI18n().translateText("Update");case yn.c.MAYBE_LATER:return this.app.getI18n().translateText("wix_popupMaybeLater");case yn.c.UPGRADE_NOW:return this.app.getI18n().translateText("LinkUpdateNowTitle");case yn.c.UPGRADE_NOW_PAYWALL:return this.app.getI18n().translateText("paywall_upgrade_button_1");case yn.c.CONTINUE:return this.app.getI18n().translateText("userServeyPopup_continue");case yn.c.KEEP_EDITING_FORM:return this.app.getI18n().translateText("edt_UI_btn_keep_editing_form");case yn.c.CLOSE_EDITOR:return this.app.getI18n().translateText("edt_UI_btn_close_editor");case yn.c.IMPORT:return this.app.getI18n().translateText("edt_UI_btn_import");case yn.c.ADD_DOMAIN:return this.app.getI18n().translateText("js_iep_domainalias05");case yn.c.VALIDATE:return this.app.getI18n().translateText("edt_UI_btn_validate_smtp");case yn.c.FORM_MIGRATE:return"Migrate";case yn.c.REQUEST_A_DEMO_CORPORATE_PAYWALL:return this.app.getI18n().translateText("paywall_request_a_demo");default:throw new Error("Invalid button type: ".concat(JSON.stringify(t),". Please use one of EDialogButtonType types"))}}},{key:"getCurrentNotification",value:function(){return this.notificationsAreaContainer.firstElementChild}},{key:"createNotification",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yn.d.DEFAULT,i=arguments.length>3?arguments[3]:void 0,o=document.createElement("div");if(o.className="notification",o.innerHTML=n?t.escapeHTML(e):e,i||void 0===i){var a=document.createElement("div");a.className="close",o.appendChild(a)}switch(this.notificationsAreaContainer.innerHTML="",r){case yn.d.DEFAULT:break;case yn.d.ERROR:this.jq(o).prepend('<span class="i123-warning"></span>'),this.jq(o).addClass("ERROR");break;case yn.d.SUCCESS:this.jq(o).prepend('<span class="i123-check"></span>'),this.jq(o).addClass("SUCCESS")}return this.notificationsAreaContainer.appendChild(o),this.jq(this.mainApplicationNode).addClass("with-notification"),o}},{key:"createResponsiveNotification",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yn.d.DEFAULT,i=arguments.length>3?arguments[3]:void 0,o=document.createElement("div"),a=n?t.escapeHTML(e):e;if(o.className="notification",o.innerHTML='<span class="notification-content">'.concat(a,"</span>"),i||void 0===i){var s=document.createElement("div");s.className="close",o.appendChild(s)}switch(this.notificationsAreaContainer.innerHTML="",r){case yn.d.DEFAULT:break;case yn.d.ERROR:this.jq(o).prepend('<span class="i123-warning"></span>'),this.jq(o).addClass("ERROR");break;case yn.d.SUCCESS:this.jq(o).prepend('<span class="i123-check"></span>'),this.jq(o).addClass("SUCCESS")}return this.notificationsAreaContainer.appendChild(o),this.jq(this.mainApplicationNode).addClass("with-notification"),o}},{key:"closeAllNotifications",value:function(){this.jq(this.mainApplicationNode).removeClass("with-notification"),this.notificationsAreaContainer.innerHTML=""}},{key:"getRootNode",value:function(){return this.mainApplicationNode}}],[{key:"getDialogButtonClass",value:function(t){switch(t){case yn.c.OK:case yn.c.YES:case yn.c.SAVE:case yn.c.CHANGE:case yn.c.DOWNLOAD:case yn.c.ENABLE_COMPLIANCE:case yn.c.CREATE:case yn.c.DONE:case yn.c.TRY_FORM:case yn.c.UPDATE:case yn.c.UPGRADE_NOW:case yn.c.UPGRADE_NOW_PAYWALL:case yn.c.CONTINUE:case yn.c.KEEP_EDITING_FORM:case yn.c.IMPORT:case yn.c.ADD_DOMAIN:case yn.c.VALIDATE:case yn.c.FORM_MIGRATE:case yn.c.REQUEST_A_DEMO_CORPORATE_PAYWALL:return"btn-secondary-cta";case yn.c.DELETE:case yn.c.DISABLE_COMPLIANCE:return"btn-secondary-red";default:return"btn-outline"}}},{key:"getNotificationTooltipStylingAttribute",value:function(t){switch(t){case yn.f.WARNING:return"data-styling-warning";case yn.f.ERROR:return"data-styling-error";case yn.f.DEFAULT:default:return"data-styling-regular"}}},{key:"getNotificationTooltipPlacementAttribute",value:function(t){switch(t){case yn.e.TOP_LEFT:return"top-left";case yn.e.TOP_CENTER:return"top-center";case yn.e.TOP_RIGHT:return"top-right";case yn.e.LEFT:return"left";case yn.e.CENTER:return"center";case yn.e.RIGHT:return"right";case yn.e.BOTTOM_LEFT:return"bottom-left";case yn.e.BOTTOM_CENTER:return"bottom-center";case yn.e.BOTTOM_RIGHT:default:return"bottom-right"}}},{key:"escapeHTML",value:function(e){t.HTMLEscaper.textContent=e;var n=t.HTMLEscaper.innerHTML;return t.HTMLEscaper.textContent="",n}}]),t}();function En(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}x()(bn,"HTMLEscaper",document.createElement("div"));var wn,Tn=function(t){S()(n,t);var e=En(n);function n(t,r){var i;if(E()(this,n),i=e.call(this),x()(R()(i),"jq",void 0),x()(R()(i),"cache",{}),x()(R()(i),"started",{}),x()(R()(i),"loadedJS",{}),i.jq=t,r)for(var o in r)r.hasOwnProperty(o)&&i.preloadResource(o,r[o]);return i}return T()(n,[{key:"preloadResource",value:function(t,e){this.cache[t]=e}},{key:"isPageNotFoundBuffer",value:function(t){return t&&"string"===typeof t&&t.indexOf('data-page-name="404error">')>-1}},{key:"getWithPromise",value:function(t){var e=this;return new Promise((function(n,r){e.get(t).then((function(t){n(t)})).fail((function(t){r(t)}))}))}},{key:"get",value:function(t){if(!t||"string"!==typeof t)throw new Error("Invalid argument: non-empty string expected!");return e=this,n=this.jq,void 0!==e.cache[t]?n.Deferred((function(n){n.resolve(e.cache[t])})).promise():e.started[t]?n.Deferred((function(n){e.on("fetch_"+t,(function(){n.resolve(e.cache[t])})),e.on("error_"+t,(function(){n.reject(new Error('Failed fetching resource: "'+t+'"'))}))})).promise():(e.started[t]=(new Date).toString(),n.Deferred((function(r){var i=-1===t.indexOf("?")?t+"?_="+ +new Date:t+"&_="+ +new Date;n.get(i).then((function(n){if(e.isPageNotFoundBuffer(n))return r.reject(new Error("Resource "+t+" seems to be a not-found page!")),e.trigger("error_"+t),e.off("fetch_"+t),void e.off("error_"+t);e.cache[t]=n,delete e.started[t],r.resolve(e.cache[t]),e.trigger("fetch_"+t),e.off("fetch_"+t),e.off("error_"+t)})).fail((function(n){var i;setTimeout((function(){throw new Error("Failed to load resource from editor: "+t)}),0),null===(i=CFTracker)||void 0===i||i.event("editor_load_resource_error"),r.reject(new Error('Failed fetching resource: "'+t+'"')),e.trigger("error_"+t),e.off("fetch_"+t),e.off("error_"+t)}))})).promise());var e,n}},{key:"loadJavascript",value:function(t){return e=this.jq,this.loadedJS[t]?e.Deferred((function(t){t.resolve(!0)})).promise():e.Deferred((function(e){var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",t),n.onload=function(){e.resolve(!0)},n.onerror=function(){var n;null===(n=CFTracker)||void 0===n||n.event("editor_load_resource_error"),e.reject(new Error('Failed to load external javascript: "'+t+'"'))},document.getElementsByTagName("head")[0].appendChild(n)})).promise();var e}}]),n}(_.a),Nn=function(){function t(e,n){E()(this,t),x()(this,"dataGrid",void 0),x()(this,"rootDOMNode",void 0),x()(this,"gutterNumberDOMNode",void 0),x()(this,"height",28),x()(this,"rowData",void 0),x()(this,"cells",[]),x()(this,"rowIndex",void 0),x()(this,"selected",!1),x()(this,"selectedCellIndex",void 0),this.dataGrid=e,this.rootDOMNode=document.createElement("div"),this.rootDOMNode.setAttribute("data-role","row"),this.gutterNumberDOMNode=document.createElement("div"),this.gutterNumberDOMNode.setAttribute("data-role","gutter-number"),this.rootDOMNode.style.height=this.height+"px",this.gutterNumberDOMNode.style.height=this.height+"px",this.rowData=n||[],this.initCells()}return T()(t,[{key:"getRootDOMNode",value:function(){return this.rootDOMNode}},{key:"getGutterNumberDOMNode",value:function(){return this.gutterNumberDOMNode}},{key:"getHeight",value:function(){return this.height}},{key:"withHeight",value:function(t){return(t=~~t||0)<0&&(t=0),this.height=t,this.rootDOMNode.style.height=t+"px",this.gutterNumberDOMNode.style.height=t+"px",this.dataGrid.updateClientHeightDelayed(),this}},{key:"initCells",value:function(){for(var t=0,e=this.dataGrid.getColumns(),n=e.length;t<n;t++){var r=document.createElement("div");r.setAttribute("data-role","cell"),r.setAttribute("data-index",String(t)),r.innerHTML=e[t].renderValue(void 0===this.rowData[t]?null:this.rowData[t]),this.rootDOMNode.appendChild(r),this.cells.push(r)}}},{key:"getRowIndex",value:function(){return this.rowIndex}},{key:"withRowIndex",value:function(t){return null===t?(this.rowIndex=null,this.gutterNumberDOMNode.innerHTML=""):(t=~~t,this.rowIndex=t,this.gutterNumberDOMNode.appendChild(document.createElement("span")).textContent=String(this.rowIndex)),this}},{key:"getCells",value:function(){return this.cells}},{key:"getSelectedState",value:function(){return this.selected}},{key:"withSelectedState",value:function(t){return this.selected=!!t,this.selected?(this.rootDOMNode.setAttribute("data-selected",""),this.gutterNumberDOMNode.setAttribute("data-selected",""),this.dataGrid.getCollection()&&this.dataGrid.getCollection().setSelectedRowIndex(~~this.rootDOMNode.getAttribute("data-index"))):(this.rootDOMNode.removeAttribute("data-selected"),this.gutterNumberDOMNode.removeAttribute("data-selected"),null!==this.selectedCellIndex&&void 0!==this.selectedCellIndex&&this.withSelectedCellIndex(null)),this}},{key:"getSelectedCellIndex",value:function(){return null===this.selectedCellIndex||void 0===this.selectedCellIndex?null:this.selectedCellIndex}},{key:"withSelectedCellIndex",value:function(t){if(null===t||void 0===t)this.selectedCellIndex=void 0;else{if((t=~~t)<0)throw new Error("Invalid index!");if(t>=this.cells.length)throw new Error("Invalid index!");this.selectedCellIndex=t}for(var e=0,n=this.cells.length;e<n;e++)e===this.selectedCellIndex?this.cells[e].setAttribute("data-selected",""):this.cells[e].hasAttribute("data-selected")&&this.cells[e].removeAttribute("data-selected");return this}},{key:"getDataAt",value:function(t){return this.rowData[t]||null}},{key:"setDataAt",value:function(t,e){this.rowData[t]=e,this.cells[t].innerHTML=this.dataGrid.getColumns()[t].renderValue(void 0===this.rowData[t]?null:this.rowData[t])}}]),t}(),Rn=function(){function t(){E()(this,t)}return T()(t,null,[{key:"renderBooleanValue",value:function(t){return t&&"0"!==t?'<span data-type="boolean">true</span>':null===t?'<span data-type="null">NULL</span>':'<span data-type="boolean">false</span>'}},{key:"renderNumericValue",value:function(t){return null!==t&&!isNaN(t)&&isFinite(t)?'<span data-type="number">'+String(t)+"</span>":null===t?'<span data-type="null">NULL</span>':'<span data-type="number">NaN</span>'}},{key:"renderStringValue",value:function(t){return t||0===t?(this.htmlescaper.textContent=String(t||""),'<span data-type="string">'+this.htmlescaper.innerHTML+"</span>"):null===t?'<span data-type="null">NULL</span>':'<span data-type="string"></span>'}},{key:"renderUnknownDataTypeValue",value:function(t){switch(V()(t)){case"number":return this.renderNumericValue(t);case"string":return isNaN(Number(t))?this.renderStringValue(t):this.renderNumericValue(t);case"boolean":return this.renderBooleanValue(t);default:return this.renderStringValue(t)}}}]),t}();x()(Rn,"htmlescaper",document.createElement("div")),function(t){t[t.NONE=0]="NONE",t[t.ASCENDING=1]="ASCENDING",t[t.DESCENDING=2]="DESCENDING"}(wn||(wn={}));var Cn=function(){function t(e){E()(this,t),x()(this,"name",void 0),x()(this,"caption",void 0),x()(this,"width",100),x()(this,"columnType",void 0),x()(this,"rootDOMNode",void 0),x()(this,"captionDOMNode",void 0),x()(this,"dataGrid",void 0),x()(this,"resizerDOMNode",void 0),x()(this,"sortModeDecoration",void 0),x()(this,"sortDirection",void 0),x()(this,"valueRenderer",void 0),x()(this,"editable",void 0),this.dataGrid=e,this.rootDOMNode=document.createElement("div"),this.rootDOMNode.setAttribute("data-role","column"),this.captionDOMNode=document.createElement("span"),this.captionDOMNode.setAttribute("data-role","caption"),this.sortModeDecoration=document.createElement("div"),this.sortModeDecoration.setAttribute("data-role","sort-direction-indicator"),this.rootDOMNode.appendChild(this.captionDOMNode),this.rootDOMNode.appendChild(this.sortModeDecoration),this.rootDOMNode.style.width=this.width+"px",this.resizerDOMNode=document.createElement("div"),this.resizerDOMNode.setAttribute("data-role","column-resizer")}return T()(t,[{key:"getRootDOMNode",value:function(){return this.rootDOMNode}},{key:"getResizerDOMNode",value:function(){return this.resizerDOMNode}},{key:"getColumnName",value:function(){return this.name}},{key:"withColumnName",value:function(t){return this.name=String(t||""),this.rootDOMNode.setAttribute("data-name",String(t||"")),this.onNameOrCaptionChanged(),this}},{key:"withColumnCaption",value:function(t){return this.caption=t,this.onNameOrCaptionChanged(),this}},{key:"getColumnType",value:function(){return this.columnType}},{key:"withColumnType",value:function(t){return this.columnType=t,this}},{key:"onNameOrCaptionChanged",value:function(){this.captionDOMNode.textContent=this.rootDOMNode.title=String(this.caption||this.name)}},{key:"getWidth",value:function(){return this.width}},{key:"withWidth",value:function(t){return(t=~~t||0)<5&&(t=5),this.width=t,this.rootDOMNode.style.width=this.width+"px",this.dataGrid.updateClientWidth(),this}},{key:"getSortDirection",value:function(){return this.sortDirection}},{key:"withSortDirection",value:function(t){switch(t){case wn.ASCENDING:this.sortDirection=t,this.rootDOMNode.setAttribute("data-sort-direction","ascending");break;case wn.DESCENDING:this.sortDirection=t,this.rootDOMNode.setAttribute("data-sort-direction","descending");break;case wn.NONE:default:this.sortDirection=wn.NONE,this.rootDOMNode.removeAttribute("data-sort-direction")}}},{key:"withValueRenderer",value:function(t){return this.valueRenderer=t||null,this}},{key:"renderValue",value:function(t,e){if(this.valueRenderer)return this.valueRenderer(t,e);switch(this.columnType){case yn.b.BOOLEAN:return Rn.renderBooleanValue(t);case yn.b.NUMBER:return Rn.renderNumericValue(t);case yn.b.STRING:return Rn.renderStringValue(t);case yn.b.UNKNOWN:default:return Rn.renderUnknownDataTypeValue(t)}}},{key:"isEditable",value:function(){return this.editable}},{key:"withEditable",value:function(t){return this.editable=!!t,this}}]),t}();function Sn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Dn=function(t){S()(n,t);var e=Sn(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"row",void 0),x()(R()(r),"cell",void 0),x()(R()(r),"columnIndex",void 0),x()(R()(r),"column",void 0),x()(R()(r),"dataGrid",void 0),x()(R()(r),"editInput",void 0),x()(R()(r),"previousCellHTML",void 0),r.dataGrid=t,r}return T()(n,[{key:"getRow",value:function(){return this.row||null}},{key:"getColumnIndex",value:function(){return this.columnIndex||0===this.columnIndex?this.columnIndex:null}},{key:"getColumn",value:function(){return this.column||null}},{key:"getCell",value:function(){return this.cell||null}},{key:"cancelEditing",value:function(){this.isEditing()&&(this.row=void 0,this.cell.innerHTML=this.previousCellHTML,this.cell=void 0,this.column=void 0,this.editInput=void 0)}},{key:"doneEditing",value:function(){if(this.isEditing()){var t;switch(this.column.getColumnType()){case yn.b.BOOLEAN:t=this.editInput.checked;break;case yn.b.NUMBER:t=parseFloat(this.editInput.value),(isNaN(t)||null===t)&&(t=null);break;default:t=this.editInput.value}var e=this.row.getDataAt(this.columnIndex),n=this.columnIndex,r=this.row;this.cancelEditing(),e!==t&&(r.setDataAt(n,t),this.dataGrid.onRowUpdated(r,n,t,e))}}},{key:"editCell",value:function(t){var e=this;this.isEditing()&&this.doneEditing(),t&&null!==t.columnIndex&&(this.row=this.dataGrid.getRows()[t.rowIndex]||null,this.row&&(this.columnIndex=t.columnIndex,this.column=this.dataGrid.getColumns()[t.columnIndex]||null,this.column&&this.column.isEditable()&&(this.cell=this.row.getCells()[t.columnIndex]||null,this.cell&&(this.previousCellHTML=this.cell.innerHTML,this.cell.innerHTML="",this.editInput=this.createEditorInput(this.column.getColumnType(),this.row.getDataAt(this.columnIndex)),this.cell.appendChild(this.editInput),setTimeout((function(){e.editInput.focus();try{e.editInput.select()}catch(t){}}),10),this.editInput.onblur=function(){e.doneEditing()}))))}},{key:"isEditing",value:function(){return!!this.cell&&!!this.row&&!!this.column}},{key:"createEditorInput",value:function(t,e){var n;switch(t){case yn.b.BOOLEAN:(n=document.createElement("input")).setAttribute("type","checkbox"),n.checked=this.castToBoolean(e);break;case yn.b.NUMBER:(n=document.createElement("input")).setAttribute("type","number"),n.value=this.castToNumber(e);break;case yn.b.STRING:case yn.b.UNKNOWN:default:(n=document.createElement("input")).setAttribute("type","text"),n.value=this.castToString(e)}return n.setAttribute("data-role","editor"),n}},{key:"castToBoolean",value:function(t){return"0"!==t&&!!~~t}},{key:"castToNumber",value:function(t){return null===t||isNaN(t)||!isFinite(t)?"":String(t)}},{key:"castToString",value:function(t){return t?String(t):""}}]),n}(_.a);function kn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var In=function(t){S()(n,t);var e=kn(n);function n(t){var r;return E()(this,n),r=e.call(this),x()(R()(r),"jq",void 0),x()(R()(r),"uniqueGridId",void 0),x()(R()(r),"internalStyleDOMNode",void 0),x()(R()(r),"columns",[]),x()(R()(r),"rows",[]),x()(R()(r),"rootDOMNode",void 0),x()(R()(r),"headerDOMNode",void 0),x()(R()(r),"selectAllColumnsDOMNode",void 0),x()(R()(r),"bodyDOMNode",void 0),x()(R()(r),"gutterDOMNode",void 0),x()(R()(r),"footerDOMNode",void 0),x()(R()(r),"clientDOMNode",void 0),x()(R()(r),"clientWidth",0),x()(R()(r),"clientHeight",0),x()(R()(r),"clientScrollTop",0),x()(R()(r),"clientScrollLeft",0),x()(R()(r),"sortable",!1),x()(R()(r),"selectedRowIndex",void 0),x()(R()(r),"collection",void 0),x()(R()(r),"editor",void 0),x()(R()(r),"emptyStateHTMLDOMNode",void 0),x()(R()(r),"updateClientHeightDelayed",void 0),x()(R()(r),"renderInternalCssDelayed",void 0),n.styleId++,r.uniqueGridId=n.styleId,r.jq=t,r.rootDOMNode=document.createElement("div"),r.rootDOMNode.setAttribute("data-role","data-grid"),r.rootDOMNode.setAttribute("data-grid-uid",String(r.uniqueGridId)),r.rootDOMNode.appendChild(r.internalStyleDOMNode=document.createElement("style")),r.headerDOMNode=r.rootDOMNode.appendChild(document.createElement("div")),r.headerDOMNode.setAttribute("data-role","header"),r.selectAllColumnsDOMNode=r.headerDOMNode.appendChild(document.createElement("div")),r.selectAllColumnsDOMNode.setAttribute("data-role","select-all-columns"),r.gutterDOMNode=r.rootDOMNode.appendChild(document.createElement("div")),r.gutterDOMNode.setAttribute("data-role","gutter"),r.bodyDOMNode=r.rootDOMNode.appendChild(document.createElement("div")),r.bodyDOMNode.setAttribute("data-role","body"),r.clientDOMNode=r.bodyDOMNode.appendChild(document.createElement("div")),r.clientDOMNode.setAttribute("data-role","client"),r.clientDOMNode.setAttribute("data-allow-keyboard",""),r.clientDOMNode.tabIndex=0,r.footerDOMNode=r.rootDOMNode.appendChild(document.createElement("div")),r.footerDOMNode.setAttribute("data-role","footer"),r.emptyStateHTMLDOMNode=document.createElement("div"),r.emptyStateHTMLDOMNode.setAttribute("data-role","empty-state"),r.bodyDOMNode.appendChild(r.emptyStateHTMLDOMNode),r.updateClientHeightDelayed=F.a.create((function(){r.updateClientHeight()}),100),r.renderInternalCssDelayed=F.a.create((function(){r.renderInternalCSS()}),1),r.editor=new Dn(R()(r)),r.init(),r}return T()(n,[{key:"getSelectedIndex",value:function(){for(var t=0,e=this.rows.length;t<e;t++)if(this.rows[t].getSelectedState())return t;return-1}},{key:"getRootDOMNode",value:function(){return this.rootDOMNode}},{key:"createColumn",value:function(){var t=new Cn(this);return this.columns.push(t),this.headerDOMNode.appendChild(t.getRootDOMNode()),this.headerDOMNode.appendChild(t.getResizerDOMNode()),this.updateClientWidth(),this.renderInternalCssDelayed(),t}},{key:"createRow",value:function(t){var e=new Nn(this,t),n=this.rows.length;return e.getRootDOMNode().setAttribute("data-index",String(n)),e.getGutterNumberDOMNode().setAttribute("data-index",String(n)),this.rows.push(e),this.clientDOMNode.appendChild(e.getRootDOMNode()),this.gutterDOMNode.appendChild(e.getGutterNumberDOMNode()),this.updateClientHeightDelayed(),e}},{key:"getClientWidth",value:function(){return this.clientWidth}},{key:"withClientWidth",value:function(t){return(t=~~t||0)<0&&(t=0),this.clientWidth=t,this.clientDOMNode.style.width=t+"px",this}},{key:"getClientHeight",value:function(){return this.clientHeight}},{key:"withClientHeight",value:function(t){return(t=~~t||0)<0&&(t=0),this.clientHeight=t,this.clientDOMNode.style.height=t+"px",this}},{key:"updateClientWidth",value:function(){for(var t=0,e=0,n=this.columns.length;e<n;e++)t+=this.columns[e].getWidth();this.withClientWidth(t),this.renderInternalCSS()}},{key:"updateClientHeight",value:function(){for(var t=0,e=0,n=this.rows.length;e<n;e++)t+=this.rows[e].getHeight();this.withClientHeight(t)}},{key:"getClientScrollTop",value:function(){return this.clientScrollTop}},{key:"withClientScrollTop",value:function(t){return(t=~~t||0)<0&&(t=0),this.clientScrollTop=t,this.bodyDOMNode.scrollTop=this.clientScrollTop,this.renderInternalCSS(),this}},{key:"getClientScrollLeft",value:function(){return this.clientScrollLeft}},{key:"withClientScrollLeft",value:function(t){return(t=~~t||0)<0&&(t=0),this.clientScrollLeft=t,this.bodyDOMNode.scrollLeft=this.clientScrollLeft,this.renderInternalCSS(),this}},{key:"isSortingEnabled",value:function(){return this.sortable}},{key:"withSortingEnabled",value:function(t){if(this.sortable=!!t,!this.sortable)for(var e=0,n=this.columns.length;e<n;e++)this.columns[e].withSortDirection(wn.NONE);return this}},{key:"clearRows",value:function(){for(;this.rows.length;){var t=this.rows.shift();this.clientDOMNode.removeChild(t.getRootDOMNode()),this.gutterDOMNode.removeChild(t.getGutterNumberDOMNode())}this.withClientHeight(0),this.withClientScrollTop(0)}},{key:"dispose",value:function(){for(this.emptyStateHTMLDOMNode.innerHTML="",this.rootDOMNode.removeAttribute("data-num-rows");this.columns.length;){var t=this.columns.shift();this.headerDOMNode.removeChild(t.getRootDOMNode()),this.headerDOMNode.removeChild(t.getResizerDOMNode())}this.clearRows(),this.withClientWidth(0),this.withClientScrollLeft(0),this.updateClientWidth()}},{key:"init",value:function(){var t,e;(t=this.jq)((e=this).bodyDOMNode).on("scroll",(function(t){e.withClientScrollLeft(this.scrollLeft),e.withClientScrollTop(this.scrollTop)})),t(e.headerDOMNode).on("mousedown","[data-role=column-resizer]",(function(t){for(var n,r=0,i=e.columns.length;r<i;r++)if(e.columns[r].getResizerDOMNode()===this){n=e.columns[r];break}if(n){var o=n.getWidth(),a=t.clientX,s=function(t){var e=t.clientX-a;n.withWidth(o+e)};document.body.addEventListener("mousemove",s,!0),document.body.addEventListener("mouseup",(function t(e){document.body.removeEventListener("mousemove",s,!0),document.body.removeEventListener("mouseup",t,!0)}),!0)}})).on("click","[data-role=column] > [data-role=caption]",(function(t){if(e.sortable){for(var n,r=this.parentNode,i=0,o=e.columns.length;i<o;i++)e.columns[i].getRootDOMNode()===r?n=e.columns[i]:e.columns[i].getSortDirection()!==wn.NONE&&e.columns[i].withSortDirection(wn.NONE);if(n){switch(n.getSortDirection()){case wn.ASCENDING:case wn.NONE:default:n.withSortDirection(wn.DESCENDING);break;case wn.DESCENDING:n.withSortDirection(wn.ASCENDING)}e.onColumnSorted(n)}}})),t(e.gutterDOMNode).on("mousedown","> [data-role=gutter-number]",(function(){if(!this.hasAttribute("data-selected")){var n=~~this.getAttribute("data-index");t(e.clientDOMNode).find("> [data-role=row][data-selected]").each((function(){e.rows[~~this.getAttribute("data-index")].withSelectedState(!1)})),e.rows[n].withSelectedState(!0),setTimeout((function(){e.clientDOMNode.focus()}),100)}})),t(e.clientDOMNode).on("mousedown","> [data-role=row]",(function(){if(!this.hasAttribute("data-selected")){var n=~~this.getAttribute("data-index");t(e.clientDOMNode).find("> [data-role=row][data-selected]").each((function(){e.rows[~~this.getAttribute("data-index")].withSelectedState(!1)})),e.rows[n].withSelectedState(!0)}})).on("mousedown","> [data-role=row] > [data-role=cell]",(function(){var t=~~this.getAttribute("data-index"),n=~~this.parentNode.getAttribute("data-index");e.rows[n].withSelectedCellIndex(t)})).on("dblclick","> [data-role=row] > [data-role=cell]",(function(){e.editor.isEditing()||e.editor.editCell(e.getActiveCellCoordinates())})),e.clientDOMNode.addEventListener("keydown",(function(t){var n=t.keyCode||t.charCode,r=t.srcElement||t.target,i=!1;if(r&&-1===["input","select","textarea"].indexOf(r.nodeName.toLowerCase()))switch(n){case 37:e.editor.isEditing()||(i=!0,e.focusPreviousSiblingCell());break;case 39:e.editor.isEditing()||(i=!0,e.focusNextSiblingCell());break;case 38:e.editor.isEditing()||(i=!0,e.focusPreviousRowCell());break;case 40:e.editor.isEditing()||(i=!0,e.focusNextRowCell());break;case 36:e.editor.isEditing()||(i=!0,e.focusFirstColumnCell());break;case 35:e.editor.isEditing()||(i=!0,e.focusLastColumnCell());break;case 33:e.editor.isEditing()||(i=!0,e.focusPageUpCell());break;case 34:e.editor.isEditing()||(i=!0,e.focusPageDownCell());break;case 9:e.editor.isEditing()?(e.editor.doneEditing(),t.shiftKey?e.focusPreviousCell():e.focusNextCell(),e.editor.editCell(e.getActiveCellCoordinates()),i=!0):(i=!0,t.shiftKey?e.focusPreviousCell():e.focusNextCell());break;case 13:e.editor.isEditing()||(e.editor.editCell(e.getActiveCellCoordinates()),i=!0);break;case 27:e.editor.isEditing()&&(e.editor.cancelEditing(),setTimeout((function(){e.clientDOMNode.focus()}),10),i=!0)}else 27===n&&e.editor.isEditing()&&(e.editor.cancelEditing(),setTimeout((function(){e.clientDOMNode.focus()}),10),i=!0),13===n&&e.editor.isEditing()&&(e.editor.doneEditing(),setTimeout((function(){e.clientDOMNode.focus()}),10),i=!0),9===n&&(e.editor.isEditing()?(e.editor.doneEditing(),t.shiftKey?e.focusPreviousCell():e.focusNextCell(),e.editor.editCell(e.getActiveCellCoordinates()),i=!0):(i=!0,t.shiftKey?e.focusPreviousCell():e.focusNextCell(),setTimeout((function(){e.clientDOMNode.focus()}),10)));i&&(t.stopPropagation(),t.preventDefault())}),!0)}},{key:"renderInternalCSS",value:function(){for(var t="",e=0,n=this.columns.length;e<n;e++)t+='\n                [data-role=data-grid][data-grid-uid="'.concat(this.uniqueGridId,'"] > [data-role=body] > [data-role=client] > [data-role=row] > [data-role=cell]:nth-child(').concat(e+1,") {\n                    width: ").concat(this.columns[e].getWidth(),"px\n                }\n            ");this.internalStyleDOMNode.textContent='\n\n            [data-role=data-grid][data-grid-uid="'.concat(this.uniqueGridId,'"] > [data-role=gutter] > [data-role=gutter-number]:first-child {\n                margin-top: -').concat(this.clientScrollTop,'px;\n            }\n\n            [data-role=data-grid][data-grid-uid="').concat(this.uniqueGridId,'"] > [data-role=header] > [data-role=select-all-columns] + [data-role=column] {\n                margin-left: -').concat(this.clientScrollLeft,"px;\n            }\n\n        ")+t}},{key:"getColumns",value:function(){return this.columns}},{key:"withCollection",value:function(t){var e=this;if(this.dispose(),this.collection&&this.collection.dispose(),this.collection=t||null,!this.collection)return this.rootDOMNode.removeAttribute("data-has-footer"),void(this.footerDOMNode.innerHTML="");this.rootDOMNode.setAttribute("data-has-footer",""),this.footerDOMNode.innerHTML=this.collection.getGridFooterHTMLMarkup();for(var n=t.getColumnDescriptors(),r=n.length,i=0;i<r;i++)this.createColumn().withColumnType(n[i].type).withColumnName(n[i].name).withColumnCaption(n[i].caption).withEditable(n[i].editable);return setTimeout((function(){e.collection.setPage(1).fail((function(t){console.error(t)}))}),10),this.collection.onCollectionEmbedded(this.footerDOMNode),this.collection.on("change",(function(){e.clearRows();for(var t=0,n=e.collection.getNumberOfItemsOnCurrentPage();t<n;t++)e.createRow(e.collection.getRowAt(t)).withRowIndex(e.collection.getFirstRowOffsetStart()+t)})),this.collection.on("insert-row",(function(t){for(var n=e.createRow(t),r=0,i=e.rows.length;r<i;r++)e.rows[r]===n?e.rows[r].withSelectedState(!0):e.rows[r].getSelectedState()&&e.rows[r].withSelectedState(!1);e.maintainFocusCellViewportPosition()})),this.collection.on("commit-row",(function(t){e.rows[t].withRowIndex(e.collection.getFirstRowOffsetStart()+t)})),this}},{key:"withEmptyStateHTML",value:function(t){return this.emptyStateHTMLDOMNode.innerHTML=String(t||""),this}},{key:"getCollection",value:function(){return this.collection||null}},{key:"onColumnSorted",value:function(t){this.collection&&this.collection.setSortedColumn(t.getColumnName(),t.getSortDirection())}},{key:"getActiveCellCoordinates",value:function(){for(var t=0,e=0,n=0,r=this.rows.length;n<r;n++){if(this.rows[n].getSelectedState()){for(var i=0,o=Math.min(this.columns.length-1,~~this.rows[n].getSelectedCellIndex());i<o;i++)e+=this.columns[i].getWidth();return{rowIndex:n,columnIndex:this.rows[n].getSelectedCellIndex(),top:t,left:e}}t+=this.rows[n].getHeight()}return null}},{key:"focusPreviousSiblingCell",value:function(){var t=this.getActiveCellCoordinates();t&&0!==t.columnIndex&&(this.rows[t.rowIndex].withSelectedCellIndex(null===t.columnIndex?0:t.columnIndex-1),this.maintainFocusCellViewportPosition())}},{key:"focusNextSiblingCell",value:function(){var t=this.getActiveCellCoordinates();t&&t.columnIndex!==this.columns.length-1&&(this.rows[t.rowIndex].withSelectedCellIndex(null===t.columnIndex?0:t.columnIndex+1),this.maintainFocusCellViewportPosition())}},{key:"focusPreviousRowCell",value:function(){var t=this.getActiveCellCoordinates();t&&0!==t.rowIndex&&null!==t.columnIndex&&(this.rows[t.rowIndex].withSelectedState(!1),this.rows[t.rowIndex].withSelectedCellIndex(null),t.rowIndex--,this.rows[t.rowIndex].withSelectedState(!0),this.rows[t.rowIndex].withSelectedCellIndex(t.columnIndex),this.maintainFocusCellViewportPosition())}},{key:"focusNextRowCell",value:function(){var t=this.getActiveCellCoordinates();if(t&&t.rowIndex!==this.rows.length-1&&null!==t.columnIndex){this.clientDOMNode.offsetHeight;this.rows[t.rowIndex].withSelectedState(!1),this.rows[t.rowIndex].withSelectedCellIndex(null),t.rowIndex++,this.rows[t.rowIndex].withSelectedState(!0),this.rows[t.rowIndex].withSelectedCellIndex(t.columnIndex),this.maintainFocusCellViewportPosition()}}},{key:"focusFirstColumnCell",value:function(){var t=this.getActiveCellCoordinates();t&&0!==t.columnIndex&&(this.rows[t.rowIndex].withSelectedCellIndex(0),this.maintainFocusCellViewportPosition())}},{key:"focusLastColumnCell",value:function(){var t=this.getActiveCellCoordinates();t&&t.columnIndex!==this.columns.length-1&&(this.rows[t.rowIndex].withSelectedCellIndex(this.columns.length-1),this.maintainFocusCellViewportPosition())}},{key:"focusPageUpCell",value:function(){var t=this.getActiveCellCoordinates();if(t&&0!==t.rowIndex&&null!==t.columnIndex){var e=this.clientDOMNode.offsetHeight;for(this.rows[t.rowIndex].withSelectedState(!1),this.rows[t.rowIndex].withSelectedCellIndex(null);t.rowIndex>0&&e>0;)e-=this.rows[t.rowIndex].getHeight(),t.rowIndex--;this.rows[t.rowIndex].withSelectedState(!0),this.rows[t.rowIndex].withSelectedCellIndex(t.columnIndex),this.maintainFocusCellViewportPosition()}}},{key:"focusPageDownCell",value:function(){var t=this.getActiveCellCoordinates();if(t&&t.rowIndex!==this.rows.length-1&&null!==t.columnIndex){var e=this.clientDOMNode.offsetHeight;for(this.rows[t.rowIndex].withSelectedState(!1),this.rows[t.rowIndex].withSelectedCellIndex(null);t.rowIndex<this.rows.length-1&&e>0;)e-=this.rows[t.rowIndex].getHeight(),t.rowIndex++;this.rows[t.rowIndex].withSelectedState(!0),this.rows[t.rowIndex].withSelectedCellIndex(t.columnIndex),this.maintainFocusCellViewportPosition()}}},{key:"focusNextCell",value:function(){var t=this.getActiveCellCoordinates();t&&(null!==t.columnIndex?t.columnIndex<this.columns.length-1?this.focusNextSiblingCell():(this.rows[t.rowIndex].withSelectedState(!1),this.rows[t.rowIndex].withSelectedCellIndex(null),t.rowIndex++,t.rowIndex>=this.rows.length&&(t.rowIndex=0),t.columnIndex=0,this.rows[t.rowIndex].withSelectedState(!0),this.rows[t.rowIndex].withSelectedCellIndex(t.columnIndex),this.maintainFocusCellViewportPosition()):this.focusNextSiblingCell())}},{key:"focusPreviousCell",value:function(){var t=this.getActiveCellCoordinates();t&&(null!==t.columnIndex?t.columnIndex>0?this.focusPreviousSiblingCell():(this.rows[t.rowIndex].withSelectedState(!1),this.rows[t.rowIndex].withSelectedCellIndex(null),t.rowIndex--,t.rowIndex<0&&(t.rowIndex=this.rows.length-1),t.columnIndex=this.columns.length-1,this.rows[t.rowIndex].withSelectedState(!0),this.rows[t.rowIndex].withSelectedCellIndex(t.columnIndex),this.maintainFocusCellViewportPosition()):this.focusPreviousSiblingCell())}},{key:"maintainFocusCellViewportPosition",value:function(){var t=this.getActiveCellCoordinates();if(t){var e=this.rows[t.rowIndex].getRootDOMNode(),n=e.offsetTop;if(n<this.bodyDOMNode.scrollTop)this.bodyDOMNode.scrollTop=n;else{var r=e.offsetHeight,i=this.bodyDOMNode.offsetHeight-20;this.bodyDOMNode.scrollTop+i<n+r&&(this.bodyDOMNode.scrollTop=n+r-i)}if(null!==t.columnIndex){var o=this.rows[t.rowIndex].getCells()[t.columnIndex],a=o.offsetLeft;if(a<this.bodyDOMNode.scrollLeft)this.bodyDOMNode.scrollLeft=a;else{var s=o.offsetWidth,u=this.bodyDOMNode.offsetWidth-20;this.bodyDOMNode.scrollLeft+u<a+s&&(this.bodyDOMNode.scrollLeft=a+s-u)}}}}},{key:"getRows",value:function(){return this.rows}},{key:"onRowUpdated",value:function(t,e,n,r){if(this.trigger("row-updated",t,e,n,r),this.collection){for(var i=null,o=0,a=this.rows.length;o<a;o++)if(this.rows[o]===t){i=o;break}this.collection.updateRow(i,e,n).then((function(){})).fail((function(n){t.setDataAt(e,r),console.error(n)}))}}}]),n}(_.a);x()(In,"styleId",0);var On=function(){function t(e){E()(this,t),x()(this,"i18n",void 0),this.i18n=e}return T()(t,[{key:"convertFileSizeToString",value:function(e){var n,r;switch(!0){case e/t.KILOBYTE<1:n=e,r=null;break;case e/t.MEGABYTE<1:r="KB",n=e/t.KILOBYTE;break;case e/t.GIGABYTE<1:r="MB",n=e/t.MEGABYTE;break;case e/t.TERABYTE<1:r="GB",n=e/t.GIGABYTE;break;default:r="TB",n=e/t.TERABYTE}return Number(n).toFixed(1).replace(/\.0$/g,"")+(null===r?"":" "+r)}}],[{key:"download",value:function(e,n,r){var i,o,a=window,s="application/octet-stream",u=r||s,c=e,l=!n&&!r&&c,d=document.createElement("a"),h=function(t){return String(t)},f=a.Blob||a.MozBlob||a.WebKitBlob||h,p=n||"download";f=f.call?f.bind(a):Blob;var g=function(t,e){if("download"in d)return d.href=t,d.setAttribute("download",p),d.className="download-js-link",d.innerHTML="downloading...",d.style.display="none",document.body.appendChild(d),setTimeout((function(){d.click(),document.body.removeChild(d),!0===e&&setTimeout((function(){a.URL.revokeObjectURL(d.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-+]+)/,s)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var n=document.createElement("iframe");document.body.appendChild(n),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-+]+)/,s)),n.src=t,setTimeout((function(){document.body.removeChild(n)}),333)},v=function(t){for(var e=t.split(/[:;,]/),n=e[1],r=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),i=r.length,o=0,a=new Uint8Array(i);o<i;++o)a[o]=r.charCodeAt(o);return new f([a],{type:n})};if("true"===String(this)&&(u=(c=[c,u])[0],c=c[1]),l&&l.length<2048&&(p=l.split("/").pop().split("?")[0],d.href=l,-1!==d.href.indexOf(l))){var m=new XMLHttpRequest;return m.open("GET",l,!0),m.responseType="blob",m.onload=function(e){t.download(e.target.response,p,s)},setTimeout((function(){m.send()}),0),m}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(c.length>2096103.424&&f!==h))return navigator.msSaveBlob?navigator.msSaveBlob(v(c),p):g(c);u=(c=v(c)).type||s}else if(/([\x80-\xff])/.test(c)){for(var y=0,b=new Uint8Array(c.length),E=b.length;y<E;++y)b[y]=c.charCodeAt(y);c=new f([b],{type:u})}if(i=M()(c,f)?c:new f([c],{type:u}),navigator.msSaveBlob)return navigator.msSaveBlob(i,p);if(a.URL)g(a.URL.createObjectURL(i),!0);else{if("string"===typeof i||i.constructor===h)try{return g("data:"+u+";base64,"+a.btoa(i))}catch(w){return g("data:"+u+","+encodeURIComponent(i))}(o=new FileReader).onload=function(){g(this.result)},o.readAsDataURL(i)}return!0}}]),t}();x()(On,"KILOBYTE",1024),x()(On,"MEGABYTE",1048576),x()(On,"GIGABYTE",1073741824),x()(On,"TERABYTE",1099511627776);var An=n(12);function xn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}function _n(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Ln=function(t){S()(n,t);var e=_n(n);function n(t,r,i){var o;return E()(this,n),o=e.call(this),x()(R()(o),"numberOfPages",0),x()(R()(o),"numberOfItemsPerPage",14),x()(R()(o),"rows",[]),x()(R()(o),"currentPage",null),x()(R()(o),"jq",void 0),x()(R()(o),"tableName",void 0),x()(R()(o),"database",void 0),x()(R()(o),"sortColumnName",void 0),x()(R()(o),"sortColumnDirection",void 0),x()(R()(o),"embeddedRootNode",void 0),x()(R()(o),"rowOffsetStart",0),x()(R()(o),"selectedRowIndex",void 0),x()(R()(o),"newRows",[]),o.jq=t,o.tableName=r,o.database=i,"controls"===o.tableName&&(o.numberOfItemsPerPage=99999),o}return T()(n,[{key:"getNumberOfPages",value:function(){return this.numberOfPages}},{key:"getNumberOfItemsPerPage",value:function(){return this.numberOfItemsPerPage}},{key:"getColumnDescriptors",value:function(){for(var t=this.database.getTable(this.tableName).describe(),e=[],r=0,i=t.length;r<i;r++)e.push({caption:t[r].name,name:t[r].name,type:n.convertJQLColumnTypeToGridColumnType(t[r].type),editable:!0});return e}},{key:"getCurrentPageNumber",value:function(){return this.currentPage}},{key:"setPage",value:function(t){return e=this,this.jq.Deferred((function(n){var r=e.getUncomittedRows();try{var i=e.database.createStatement(e.computePageFetchSQL(t,e.numberOfItemsPerPage,e.sortColumnName,e.sortColumnDirection));e.database.executeStatement(i).then((function(n){e.setSelectedRowIndex(null),e.onNumberOfPagesChanged(e.computeNumberOfPages(n.getCalcFoundRows())),e.rowOffsetStart=(t-1)*e.numberOfItemsPerPage+1,e.onCurrentPageChanged(t),e.rows=[];for(var i=0,o=n.getRowsAsArray(),a=o.length;i<a;i++)e.rows.push(o[i]);e.newRows=[];for(var s=0,u=r.length;s<u;s++)e.rows.push(r[s]),e.newRows.push(e.rows.length-1);e.trigger("change")})).catch((function(t){n.reject(t)}))}catch(o){n.reject(o)}})).promise();var e}},{key:"getNumberOfItemsOnCurrentPage",value:function(){return this.rows.length}},{key:"getRowAt",value:function(t){return JSON.parse(JSON.stringify(this.rows[t]))}},{key:"setSortedColumn",value:function(t,e){return this.sortColumnName=t,this.sortColumnDirection=e,this.setPage(this.currentPage)}},{key:"getGridFooterHTMLMarkup",value:function(){return'\n            <button data-role="previous-page"><span class="i-md i123-arrow_left"></span></button>\n            <label data-role="current-page"><span>Page: </span><input type="number" name="current-page" value="1" min="1" max="1" /></label>\n            <label data-role="total-pages"><span>of&nbsp;</span><span data-role="total-pages">0</span></label>\n            <button data-role="next-page"><span class="i-md i123-arrow_right"></span></button>\n            <span style="width: 20px"></span>\n            <button data-role="refresh" title="Refresh"><span class="i-md i123-refresh"></span></button>\n            <span style="width: 20px"></span>\n            <button data-role="insert-row" title="Insert row"><span class="i-md i123-add"></span></button>\n            <button data-role="delete-current-row" disabled title="Delete row"><span class="i-md i123-delete"></span></button>\n        '}},{key:"onCollectionEmbedded",value:function(t){var e,n;e=this.jq,(n=this).embeddedRootNode=t,e(t).find("input[name=current-page]").on("change",(function(){var t=~~this.value;t>=1&&t<=n.getNumberOfPages()?n.setPage(t):this.value=n.getCurrentPageNumber()})),e(t).find("button[data-role=previous-page]").on("click",(function(){n.getCurrentPageNumber()<=1||n.setPage(n.getCurrentPageNumber()-1)})),e(t).find("button[data-role=next-page]").on("click",(function(){n.getCurrentPageNumber()>=n.getNumberOfPages()||n.setPage(n.getCurrentPageNumber()+1)})),e(t).find("button[data-role=delete-current-row]").on("click",(function(){null!==n.selectedRowIndex&&n.deleteRow(n.selectedRowIndex)})),e(t).find("button[data-role=insert-row]").on("click",(function(){var t=n.createRow();n.rows.push(t),n.newRows.push(n.rows.length-1),n.trigger("insert-row",t)})),e(t).find("button[data-role=refresh]").on("click",(function(){n.setPage(n.getCurrentPageNumber())}))}},{key:"dispose",value:function(){this.events=void 0}},{key:"computePageFetchSQL",value:function(t,e,n,r){var i="";return this.database.getTable(this.tableName).isVirtual()||"session"===this.tableName||(i+="REMOTE "),i+="SELECT SQL_CALC_FOUND_ROWS * FROM "+this.tableName,!n||r!==wn.DESCENDING&&r!==wn.ASCENDING||(i+=" ORDER BY "+n,this.sortColumnDirection==wn.ASCENDING?i+=" ASC":i+=" DESC"),i+=" LIMIT "+(t-1)*e+","+e,console.warn(i),i}},{key:"computeNumberOfPages",value:function(t){return t%this.numberOfItemsPerPage===0?~~(t/this.numberOfItemsPerPage):1+~~(t/this.numberOfItemsPerPage)}},{key:"onNumberOfPagesChanged",value:function(t){var e,n;this.numberOfPages=t,(e=this.jq)((n=this).embeddedRootNode).find("span[data-role=total-pages]").each((function(){this.textContent=String(t)})),e(n.embeddedRootNode).find("input[name=current-page]").attr("max",String(t))}},{key:"getFirstRowOffsetStart",value:function(){return this.rowOffsetStart}},{key:"onCurrentPageChanged",value:function(t){this.currentPage=t,(0,this.jq)(this.embeddedRootNode).find("input[name=current-page]").each((function(){this.value!=t&&(this.value=t)}))}},{key:"updateRow",value:function(t,e,n){return function(r,i){if(i.isUncommitedRow(t))return i.rows[t][e]=n,i.attemptToInsertRow(t),r.Deferred((function(t){t.resolve(!0)}));try{var o=i.database.getTable(i.tableName),a=o.describe(),s=[],u="";o.isVirtual()||"session"===i.tableName||(u+="REMOTE "),u+="UPDATE "+i.tableName+" SET `"+a[e].name+"` = :____new_value____ WHERE ";for(var c={____new_value____:n},l=0,d=a.length;l<d;l++)a[e].name!=a[l].name&&(null!==i.castBinding(i.rows[t][l],a[l].type)?(s.push("`"+a[l].name+"` = :"+a[l].name),c[a[l].name]=i.castBinding(i.rows[t][l],a[l].type)):s.push("`"+a[l].name+"` IS NULL"));u+=s.join(" AND "),u+=" LIMIT 1";var h=i.database.createStatement(u);return console.warn(u),r.Deferred((function(r){i.database.executeStatement(h,c).then((function(o){1===o.getAffectedRows()?(i.rows[t][e]=n,r.resolve(!0)):r.reject(new Error("No rows affected!"))})).catch((function(t){r.reject(t)}))}))}catch(f){return r.Deferred((function(t){t.reject(f)}))}}(this.jq,this)}},{key:"setSelectedRowIndex",value:function(t){this.selectedRowIndex=0===t?0:t||null,function(t,e,n){t(e).find("button[data-role=delete-current-row]").each((function(){this.disabled=null===n}))}(this.jq,this.embeddedRootNode,this.selectedRowIndex)}},{key:"deleteRow",value:function(t){return function(e,n){if(n.isUncommitedRow(t))return n.deleteUncommitedRow(t),n.setPage(n.getCurrentPageNumber());try{var r=n.database.getTable(n.tableName).describe(),i="";"session"!==n.tableName&&(i+="REMOTE "),i+="DELETE FROM "+n.tableName+" WHERE ";for(var o={},a=0,s=r.length;a<s;a++)null!==n.castBinding(n.rows[t][a],r[a].type)?(i+=(a>0?" AND ":"")+"`"+r[a].name+"` = :"+r[a].name,o[r[a].name]=n.castBinding(n.rows[t][a],r[a].type)):i+=(a>0?" AND ":"")+"`"+r[a].name+"` IS NULL";i+=" LIMIT 1";var u=n.database.createStatement(i);return console.warn(i),e.Deferred((function(t){n.database.executeStatement(u,o).then((function(e){1===e.getAffectedRows()?(n.setPage(n.getCurrentPageNumber()),t.resolve(!0)):t.reject(new Error("No rows affected!"))})).catch((function(e){t.reject(e)}))}))}catch(c){return console.error(c),e.Deferred((function(t){t.reject(c)}))}}(this.jq,this)}},{key:"castBinding",value:function(t,e){switch(e){case f.BOOLEAN:return null===t?null:"0"!==t&&!!~~t;case f.NUMBER:if(null===t)return null;var n=parseFloat(String(t));return!isNaN(n)&&isFinite(n)?n:null;default:return t}}},{key:"createRow",value:function(){for(var t=[],e=this.database.getTable(this.tableName).describe(),n=0,r=e.length;n<r;n++)switch(e[n].type){case f.BOOLEAN:t.push(!1);break;case f.STRING:t.push("");break;case f.NUMBER:t.push(0);break;default:case f.NULL:t.push(null)}return t}},{key:"isUncommitedRow",value:function(t){return this.newRows.indexOf(t)>-1}},{key:"deleteUncommitedRow",value:function(t){this.rows.splice(t,1);for(var e=0,n=this.newRows.length;e<n;e++)if(this.newRows[e]===t){this.newRows.splice(e,1);break}for(var r=0,i=this.newRows.length;r<i;r++)if(this.newRows[r]>t){this.newRows[r]--;break}}},{key:"markRowAsComitted",value:function(t){for(var e=0,n=this.newRows.length;e<n;e++)if(this.newRows[e]===t){this.newRows.splice(e,1);break}this.trigger("commit-row",t)}},{key:"getUncomittedRows",value:function(){for(var t=[],e=0,n=this.newRows.length;e<n;e++)t.push(this.rows[this.newRows[e]]);return t}},{key:"attemptToInsertRow",value:function(t){return function(e,n){if(!n.isUncommitedRow(t))return e.Deferred((function(t){t.reject(new Error("Row is already in comitted state!"))})).promise();try{var r=n.database.getTable(n.tableName).describe(),i="";i+="REMOTE ",i+="INSERT INTO "+n.tableName+" SET ";for(var o={},a=0,s=r.length;a<s;a++)null!==n.castBinding(n.rows[t][a],r[a].type)?(i+=(a>0?" , ":"")+"`"+r[a].name+"` = :"+r[a].name,o[r[a].name]=n.castBinding(n.rows[t][a],r[a].type)):i+=(a>0?" , ":"")+"`"+r[a].name+"` = NULL";var u=n.database.createStatement(i);return console.warn(i),e.Deferred((function(e){n.database.executeStatement(u,o).then((function(r){n.markRowAsComitted(t),e.resolve(!0)})).catch((function(t){e.reject(t)}))}))}catch(c){return e.Deferred((function(t){t.reject(c)}))}}(this.jq,this)}}],[{key:"convertJQLColumnTypeToGridColumnType",value:function(t){switch(t){case f.STRING:return yn.b.STRING;case f.NUMBER:return yn.b.NUMBER;case f.BOOLEAN:return yn.b.BOOLEAN;case f.NULL:default:return yn.b.UNKNOWN}}}]),n}(function(t){S()(n,t);var e=xn(n);function n(){return E()(this,n),e.apply(this,arguments)}return n}(_.a));function Mn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Fn=function(t){S()(n,t);var e=Mn(n);function n(){return E()(this,n),e.apply(this,arguments)}return T()(n,[{key:"getGridFooterHTMLMarkup",value:function(){return'\n            <button data-role="previous-page"><span class="i-md i123-arrow_left"></span></button>\n            <label data-role="current-page"><span>Page: </span><input type="number" name="current-page" value="1" min="1" max="1" /></label>\n            <label data-role="total-pages"><span>of&nbsp;</span><span data-role="total-pages">0</span></label>\n            <button data-role="next-page"><span class="i-md i123-arrow_right"></span></button>\n        '}}]),n}(Ln),Pn=function(){function t(e){var n=this;E()(this,t),x()(this,"uniqueId",void 0),x()(this,"rootDOMNode",void 0),x()(this,"controlsDOMNode",void 0),x()(this,"eventsDOMNode",void 0),x()(this,"controlId",null),x()(this,"eventTypeId",null),x()(this,"index",null),x()(this,"selected",!1),x()(this,"formControlsList",void 0),x()(this,"actions",[]),t.UID++,this.uniqueId=t.UID,this.rootDOMNode=document.createElement("div"),this.rootDOMNode.setAttribute("data-role","rule"),this.controlsDOMNode=document.createElement("select"),this.controlsDOMNode.setAttribute("data-role","control"),this.rootDOMNode.appendChild(this.controlsDOMNode),this.eventsDOMNode=document.createElement("select"),this.eventsDOMNode.setAttribute("data-role","event"),this.formControlsList=e,this.initFormControlsList(),this.controlsDOMNode.onchange=function(){n.controlId=""===n.controlsDOMNode.value?null:n.controlsDOMNode.value,n.initEventsDOMNodeDropdown(n.controlsDOMNode.value),n.onErrorStateChanged()},this.eventsDOMNode.onchange=function(){n.eventTypeId=""===n.eventsDOMNode.value?null:parseInt(n.eventsDOMNode.value),n.onErrorStateChanged()},this.initEventsDOMNodeDropdown(this.eventsDOMNode.value),this.rootDOMNode.appendChild(this.eventsDOMNode),this.rootDOMNode.setAttribute("data-rule-uid",String(this.uniqueId)),this.onErrorStateChanged()}return T()(t,[{key:"getControlId",value:function(){return this.controlId}},{key:"withControlId",value:function(t){if(this.controlId=t||null,!this.controlId)return this.controlsDOMNode.value="",this;for(var e=-1,n=0,r=this.formControlsList.length;n<r;n++)if(this.formControlsList[n].id===t){e=n;break}if(-1===e&&"control_0"!==t){var i=document.createElement("option");i.value=t,i.text="DELETED "+this.controlId,this.controlsDOMNode.add(i)}return this.controlsDOMNode.value=this.controlId,this.initEventsDOMNodeDropdown(this.controlsDOMNode.value),this.onErrorStateChanged(),this}},{key:"getEventTypeId",value:function(){return this.eventTypeId}},{key:"withEventTypeId",value:function(t){return this.eventTypeId=t,this.eventsDOMNode.value=null===t?"":String(t),this.onErrorStateChanged(),this}},{key:"getRootDOMNode",value:function(){return this.rootDOMNode}},{key:"initEventsDOMNodeDropdown",value:function(t){for(var e=this.eventsDOMNode.value;this.eventsDOMNode.options.length;)this.eventsDOMNode.remove(0);var n=document.createElement("option");n.value="",n.text="[Select]",this.eventsDOMNode.add(n),"control_0"!==t?((n=document.createElement("option")).value=JSON.stringify(y.ALL_EVENTS),n.text="* Any",this.eventsDOMNode.add(n),(n=document.createElement("option")).value=JSON.stringify(y.INIT),n.text="Initialized",this.eventsDOMNode.add(n),(n=document.createElement("option")).value=JSON.stringify(y.CHANGE),n.text="Changed",this.eventsDOMNode.add(n),(n=document.createElement("option")).value=JSON.stringify(y.CHECK),n.text="Checked",this.eventsDOMNode.add(n),(n=document.createElement("option")).value=JSON.stringify(y.UNCHECK),n.text="Unchecked",this.eventsDOMNode.add(n),(n=document.createElement("option")).value=JSON.stringify(y.TEXT_INPUT),n.text="Edited",this.eventsDOMNode.add(n),(n=document.createElement("option")).value=JSON.stringify(y.INIT),n.text="Initialized",(n=document.createElement("option")).value=JSON.stringify(y.REINITIALIZE),n.text="Reloaded",this.eventsDOMNode.add(n)):((n=document.createElement("option")).value=JSON.stringify(y.SUBMITTED),n.text="Submitted",this.eventsDOMNode.add(n),(n=document.createElement("option")).value=JSON.stringify(y.APPROVED),n.text="Approved",this.eventsDOMNode.add(n)),this.eventsDOMNode.value=e,-1===this.eventsDOMNode.selectedIndex&&(this.eventsDOMNode.selectedIndex=0)}},{key:"initFormControlsList",value:function(){for(;this.controlsDOMNode.options.length;)this.controlsDOMNode.remove(0);var t=document.createElement("option");t.value="",t.text="[Select]",this.controlsDOMNode.add(t),(t=document.createElement("option")).value="control_0",t.text="[This Form]",this.controlsDOMNode.add(t);for(var e=0,n=this.formControlsList.length;e<n;e++)(t=document.createElement("option")).value=this.formControlsList[e].id,t.text=this.formControlsList[e].name,this.controlsDOMNode.add(t)}},{key:"isSelected",value:function(){return this.selected}},{key:"setSelected",value:function(t){this.selected=!!t,this.selected?this.rootDOMNode.setAttribute("data-selected",""):this.rootDOMNode.removeAttribute("data-selected")}},{key:"getUniqueId",value:function(){return this.uniqueId}},{key:"addAction",value:function(t){return this.actions.push(t),t.withParentRule(this),t}},{key:"deleteAction",value:function(t){for(var e=0,n=this.actions.length;e<n;e++)if(this.actions[e]===t)return this.actions.splice(e,1)[0];return null}},{key:"getActions",value:function(){return this.actions.slice(0)}},{key:"getActionByUniqueId",value:function(t){for(var e=0,n=this.actions.length;e<n;e++)if(this.actions[e].getUniqueId()===t)return this.actions[e];return null}},{key:"onErrorStateChanged",value:function(){if(this.controlId&&null!==this.eventTypeId){for(var t=0,e=this.actions.length;t<e;t++)if(this.actions[t].getRootDOMNode().hasAttribute("data-has-errors"))return void this.rootDOMNode.setAttribute("data-has-errors","");this.rootDOMNode.removeAttribute("data-has-errors")}else this.rootDOMNode.setAttribute("data-has-errors","")}},{key:"getSelectedAction",value:function(){for(var t=0,e=this.actions.length;t<e;t++)if(this.actions[t].isActive())return this.actions[t];return null}},{key:"setSelectedAction",value:function(t){for(var e=0,n=this.actions.length;e<n;e++)this.actions[e]===t?this.actions[e].setActive(!0):this.actions[e].isActive()&&this.actions[e].setActive(!1)}},{key:"moveActionUp",value:function(t){var e=null;if(!(this.actions.length<2)){for(var n=0,r=this.actions.length;n<r;n++)if(this.actions[n]===t){e=n;break}if(0!==e&&null!==e){this.actions.splice(e,1);var i=t.getRootDOMNode().previousSibling;t.getRootDOMNode().parentNode.removeChild(t.getRootDOMNode()),this.actions.splice(e-1,0,t),i.parentNode.insertBefore(t.getRootDOMNode(),i)}}}},{key:"moveActionDown",value:function(t){var e=null;if(!(this.actions.length<2)){for(var n=0,r=this.actions.length;n<r;n++)if(this.actions[n]===t){e=n;break}if(e!==this.actions.length-1&&null!==e){this.actions.splice(e,1);var i=t.getRootDOMNode().nextSibling;t.getRootDOMNode().parentNode.removeChild(t.getRootDOMNode()),this.actions.splice(e+1,0,t),i.parentNode.insertBefore(t.getRootDOMNode(),i.nextSibling)}}}}]),t}();x()(Pn,"UID",0);var Bn=function(){function t(e,n,r,i){var o=this;E()(this,t),x()(this,"uniqueId",void 0),x()(this,"rootDOMNode",void 0),x()(this,"actionTypeDOMNode",void 0),x()(this,"formControlsList",void 0),x()(this,"targetControlDOMNode",void 0),x()(this,"sqlTextEditor",void 0),x()(this,"sql",""),x()(this,"db",void 0),x()(this,"errorDOMNode",void 0),x()(this,"error",null),x()(this,"statement",null),x()(this,"toolbarDOMNode",void 0),x()(this,"jq",void 0),x()(this,"carretCharIndex",0),x()(this,"carretLineIndex",0),x()(this,"commandDispatcher",void 0),x()(this,"onCursorPositionChangedThrottled",void 0),x()(this,"editorInited",!1),x()(this,"parentRule",void 0),x()(this,"active",!1),this.db=n,this.jq=r,this.commandDispatcher=i,t.UID++,this.uniqueId=t.UID,this.rootDOMNode=document.createElement("div"),this.rootDOMNode.setAttribute("data-role","action"),this.rootDOMNode.setAttribute("data-action-uid",String(this.uniqueId)),this.actionTypeDOMNode=document.createElement("select"),this.actionTypeDOMNode.setAttribute("data-role","action-type"),this.rootDOMNode.appendChild(this.actionTypeDOMNode),this.formControlsList=e,this.targetControlDOMNode=document.createElement("select"),this.targetControlDOMNode.setAttribute("data-role","target-control"),this.rootDOMNode.appendChild(this.targetControlDOMNode),this.toolbarDOMNode=document.createElement("div"),this.toolbarDOMNode.setAttribute("data-role","toolbar"),this.rootDOMNode.appendChild(this.toolbarDOMNode),this.iniToolbar(),this.errorDOMNode=document.createElement("div"),this.errorDOMNode.setAttribute("data-role","error"),this.onCursorPositionChangedThrottled=F.a.create((function(){o.onCursorPositionChanged()}),300),this.initActionTypeDOMNode(),this.initTargetControlDOMNode(),this.actionTypeDOMNode.onchange=function(){o.onCursorPositionChangedThrottled(),o.onErrorStateChanged()},this.targetControlDOMNode.onchange=function(){o.onCursorPositionChangedThrottled(),o.onErrorStateChanged()}}return T()(t,[{key:"asyncInitCodeMirrorEditor",value:function(){var t,e,n,r,i,o;this.editorInited||((t=this).sqlTextEditor=null===(e=CodeMirror)||void 0===e?void 0:e(t.rootDOMNode,{value:"asd",mode:"text/x-mariadb",lineNumbers:!0}),t.rootDOMNode.appendChild(t.errorDOMNode),null===(n=t.sqlTextEditor)||void 0===n||n.setSize("100%","80px"),null===(r=t.sqlTextEditor)||void 0===r||r.setValue(t.sql),null===(i=t.sqlTextEditor)||void 0===i||i.on("change",(function(){var e,n;t.sql=null!==(e=null===(n=t.sqlTextEditor)||void 0===n?void 0:n.getValue())&&void 0!==e?e:"",t.onSQLQueryChanged()})),null===(o=t.sqlTextEditor)||void 0===o||o.on("cursorActivity",(function(e){var n=e.getCursor();t.carretCharIndex=n.ch,t.carretLineIndex=n.line,t.onCursorPositionChangedThrottled()})),this.editorInited=!0)}},{key:"getRootDOMNode",value:function(){return this.rootDOMNode}},{key:"getUniqueId",value:function(){return this.uniqueId}},{key:"initActionTypeDOMNode",value:function(){var t=document.createElement("option");t.text="Execute SQL using:",t.value="run",this.actionTypeDOMNode.add(t),(t=document.createElement("option")).text="Set value of control:",t.value="set",this.actionTypeDOMNode.add(t)}},{key:"initTargetControlDOMNode",value:function(){var t=document.createElement("option");t.text="[Select]",t.value="",this.targetControlDOMNode.add(t);for(var e=0,n=this.formControlsList.length;e<n;e++)(t=document.createElement("option")).text=this.formControlsList[e].name,t.value=this.formControlsList[e].id,this.targetControlDOMNode.appendChild(t)}},{key:"getError",value:function(){return this.error}},{key:"getStatement",value:function(){return this.statement}},{key:"onSQLQueryChanged",value:function(){try{if(""===String(this.sql).trim())return this.rootDOMNode.removeAttribute("data-error-state"),this.errorDOMNode.textContent="",this.error=null,this.statement=null,void this.onErrorStateChanged();this.statement=this.db.createStatement(this.sql),this.errorDOMNode.textContent="",this.error=null,this.onErrorStateChanged()}catch(t){this.errorDOMNode.textContent=String(t).replace(/^Error: /g,"").replace(/^Failed to create statement: /g,""),this.error=t,this.statement=null,this.onErrorStateChanged()}}},{key:"iniToolbar",value:function(){var t;this.toolbarDOMNode.innerHTML='\n            <button data-role="insert-table" title="Insert table"><span class="i-md i123-memory" ></span></button>\n            <button data-role="insert-column" title="Insert column"><span class="i-md i123-reports" ></span></button>\n            <button data-role="insert-control" title="Insert form control"><span class="i-md i123-input_area" ></span></button>\n            <div data-role="editor-selection-feedback"></div>\n        ',(0,this.jq)((t=this).toolbarDOMNode).on("click","button[data-role]",(function(){switch(this.getAttribute("data-role")){case"insert-table":t.commandDispatcher.browserForDatabaseTablesDialog().then((function(e){var n;null===(n=t.sqlTextEditor)||void 0===n||n.replaceSelection(e,!0)}));break;case"insert-column":t.commandDispatcher.browserForDatabaseTableColumnsDialog().then((function(e){var n;null===(n=t.sqlTextEditor)||void 0===n||n.replaceSelection(e,!0)}));break;case"insert-control":t.commandDispatcher.browseForFormsControlDialog().then((function(e){var n;null===(n=t.sqlTextEditor)||void 0===n||n.replaceSelection(e,!0)}))}}))}},{key:"onCursorPositionChanged",value:function(){var t,e=this.sql.split("\n")[this.carretLineIndex],n=this.getIdentifierFromStringPosition(e,this.carretCharIndex);t=this,/^control_[\d]+(_[\d]+)?$/.test(n)?t.jq(t.toolbarDOMNode).find("[data-role=editor-selection-feedback]").each((function(){for(var e="<b>UNKNOWN</b> control <b>:"+n+"</b>",r=0,i=t.formControlsList.length;r<i;r++)if(t.formControlsList[r].id==n){e="<b>:"+n+"</b> => <b>"+t.formControlsList[r].name+"</b>";break}this.innerHTML=e})):"this"===n?t.jq(t.toolbarDOMNode).find("[data-role=editor-selection-feedback]").each((function(){if(t.getParentRule().getControlId()){for(var e="",n=t.getParentRule().getControlId(),r=0,i=t.formControlsList.length;r<i;r++)t.formControlsList[r].id===n&&(e=t.formControlsList[r].name);this.innerHTML=e?"<b>:this</b> => <b>"+e+"</b> (:"+n+")":"<b>:this</b> => Select a control on the rule"}else this.innerHTML="<b>:this</b> => Select a control on the rule"})):t.jq(t.toolbarDOMNode).find("[data-role=editor-selection-feedback]").text("")}},{key:"getIdentifierFromStringPosition",value:function(e,n){var r,i,o="",a="",s=e.length;for(i=n-1;i>=0&&t.IDENTIFIER_CHARS.indexOf(r=e.charAt(i))>-1;)o=r+o,i--;for(i=n;i<s&&t.IDENTIFIER_CHARS.indexOf(r=e.charAt(i))>-1;)a+=r,i++;return(o+a).replace(/^[0-9]+/g,"")}},{key:"withSQL",value:function(t){return this.sql=t||"",this.carretLineIndex=0,this.carretCharIndex=0,this.onSQLQueryChanged(),this.onErrorStateChanged(),this}},{key:"withControlId",value:function(t){for(var e=0,n=this.formControlsList.length;e<n;e++)if(this.formControlsList[e].id===t)return this.targetControlDOMNode.value=t,this;var r=document.createElement("option");return r.value=t,r.text="DELETED "+t,this.targetControlDOMNode.add(r),this.targetControlDOMNode.value=t,this}},{key:"getControlId",value:function(){return this.targetControlDOMNode.value}},{key:"getSQL",value:function(){return this.sql}},{key:"onErrorStateChanged",value:function(){this.statement&&(this.statement.getStatementType()===i.SELECT?"set"!==this.actionTypeDOMNode.value&&(this.actionTypeDOMNode.value="set"):"run"!==this.actionTypeDOMNode.value&&(this.actionTypeDOMNode.value="run"));var t=this.rootDOMNode.hasAttribute("data-has-errors");this.error||!this.statement?t||(this.rootDOMNode.setAttribute("data-has-errors",""),this.parentRule&&this.parentRule.onErrorStateChanged()):t&&(this.rootDOMNode.removeAttribute("data-has-errors"),this.parentRule&&this.parentRule.onErrorStateChanged())}},{key:"getParentRule",value:function(){return this.parentRule}},{key:"withParentRule",value:function(t){return this.parentRule=t,this}},{key:"setActive",value:function(t){return this.active=!!t,this.active?this.rootDOMNode.setAttribute("data-selected",""):this.rootDOMNode.removeAttribute("data-selected"),this}},{key:"isActive",value:function(){return this.active}}]),t}();function Un(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}x()(Bn,"IDENTIFIER_CHARS","abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789"),x()(Bn,"UID",0);var Vn=function(t){S()(n,t);var e=Un(n);function n(){var t;E()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),x()(R()(t),"rules",[]),t}return T()(n,[{key:"addRule",value:function(t){this.rules.length;return this.rules.push(t),this.trigger("change"),t}},{key:"deleteRule",value:function(t){for(var e=0,n=this.rules.length;e<n;e++)if(this.rules[e]===t){var r=this.rules.splice(e,1)[0];return this.trigger("change"),r}return null}},{key:"setSelectedRule",value:function(t){for(var e=0,n=this.rules.length;e<n;e++)this.rules[e]===t?this.rules[e].setSelected(!0):this.rules[e].isSelected()&&this.rules[e].setSelected(!1)}},{key:"getSelectedRule",value:function(){for(var t=0,e=this.rules.length;t<e;t++)if(this.rules[t].isSelected())return this.rules[t];return null}},{key:"getRuleByUniqueId",value:function(t){for(var e=0,n=this.rules.length;e<n;e++)if(this.rules[e].getUniqueId()===t)return this.rules[e];return null}},{key:"getRules",value:function(){return this.rules}},{key:"getJQLConfiguration",value:function(){for(var t=[],e=0,n=this.rules.length;e<n;e++){for(var r={actions:[],eventType:this.rules[e].getEventTypeId(),controlId:this.rules[e].getControlId()},i=0,o=this.rules[e].getActions(),a=o.length;i<a;i++)r.actions.push({controlId:o[i].getControlId(),jql:o[i].getSQL()});t.push(r)}return t}},{key:"moveRuleUp",value:function(t){var e=null;if(!(this.rules.length<2)){for(var n=0,r=this.rules.length;n<r;n++)if(this.rules[n]===t){e=n;break}if(0!==e&&null!==e){this.rules.splice(e,1);var i=t.getRootDOMNode().previousSibling;t.getRootDOMNode().parentNode.removeChild(t.getRootDOMNode()),this.rules.splice(e-1,0,t),i.parentNode.insertBefore(t.getRootDOMNode(),i)}}}},{key:"moveRuleDown",value:function(t){var e=null;if(!(this.rules.length<2)){for(var n=0,r=this.rules.length;n<r;n++)if(this.rules[n]===t){e=n;break}if(e!==this.rules.length-1&&null!==e){this.rules.splice(e,1);var i=t.getRootDOMNode().nextSibling;t.getRootDOMNode().parentNode.removeChild(t.getRootDOMNode()),this.rules.splice(e+1,0,t),i.parentNode.insertBefore(t.getRootDOMNode(),i.nextSibling)}}}}],[{key:"createFromJQLFormRulesConfiguration",value:function(t,e,r,i,o){for(var a=new n,s=0,u=t.length;s<u;s++){var c=a.addRule(new Pn(e));c.withControlId(t[s].controlId).withEventTypeId(t[s].eventType);for(var l=0,d=(t[s].actions||[]).length;l<d;l++){c.addAction(new Bn(e,r,i,o)).withSQL(t[s].actions[l].jql).withControlId(t[s].actions[l].controlId)}}return setTimeout((function(){for(var t=0,e=a.getRules(),n=e.length;t<n;t++)e[t].onErrorStateChanged()}),100),a}}]),n}(_.a),jn=function(){function t(e){E()(this,t),x()(this,"app",void 0),x()(this,"csvParserOptions",{endOfLineCharacter:"\r\n",columnsEnclosedBy:'"',columnsTerminatedBy:",",fieldsEscapedBy:"",autoTrimAllFields:!0,allColumnsAreEnclosed:!1}),this.app=e}return T()(t,[{key:"setApplicationEnabledStateAction",value:function(t){var e,n,r;e=this.app.getJQuery(),n=this.app,r=this.app,this.app.getResourceManager(),e.ajax("/sf_applications_actions.php",{type:"POST",data:{someaction:"applications_csvconnector_enable_disable",appid:String(r.getApplicationId()),formid:String(r.getFormId()),a_enabled:t?"1":"0"}}).then((function(e){"OK"===String(e||"").trim()&&(t?n.createNotification("Virtual Database & SQL Manager application settings saved successfully",!1,yn.d.SUCCESS,!0):n.createNotification("Virtual Database & SQL Manager application was successfully disabled for this form",!1,yn.d.SUCCESS,!0))})).fail((function(){n.createNotification("Failed to change Virtual Database & SQL Manager enabled state",!1,yn.d.ERROR,!0)}))}},{key:"createNewTableAction",value:function(){var t,e,n,r;t=this.app.getJQuery(),e=this.app,this.app,n=this.app.getResourceManager(),r=this,n.get("/modules/RulesV3/resources/create-new-table-action.html").then((function(n){var i=new An.a(n),o=null,a=e.createDialog("Create new table",[{type:yn.c.CREATE,callback:function(){try{var n={csvFile:o,tableName:t(a.body).find("label[data-role=database-name] input").val(),tableNamespace:t(a.body).find("label[data-role=database-global-flag] input").is(":checked")?m.GLOBAL:m.FORM,tableAccessMode:t(a.body).find("label[data-role=table-write-access] input").is(":checked")?v.READ_WRITE:v.READ,tableStorageEngine:t(a.body).find("label[data-role=table-storage-engine] input").is(":checked")?g.REMOTE:g.IN_MEMORY,csvFieldEnclosure:r.csvParserOptions.columnsEnclosedBy,csvEncloseAllFields:r.csvParserOptions.allColumnsAreEnclosed,csvFieldDelimiter:r.csvParserOptions.columnsTerminatedBy,csvEscapeCharacter:r.csvParserOptions.fieldsEscapedBy,csvAutoTrim:r.csvParserOptions.autoTrimAllFields,csvLineTerminator:r.csvParserOptions.endOfLineCharacter};if(!n.tableName)throw new Error("Please input a Database table name");if(!o)throw new Error("Please select a CSV file first");if(!o.size)throw new Error("Selected file is empty. Please select a non-empty file");if(!/^([\s\S]+)\.csv$/i.test(o.name))throw new Error('Selected file seems not to be a csv file ("'+o.type+'"). Please select a CSV file');if(o.size>15728640)throw new Error("Selected file size is greater than 15Mb, which is the maximum csv file size");r.app.getDatabase().createTableFromCSVFile(n).then((function(){e.alert("Table created","Table '"+n.tableName+"' was successfully created!",(function(){a.close()}))})).catch((function(t){e.alert("Failed to create table",'There was an error encountered while trying to create your table. Please inspect if the "Advanced options" settings are set up correctly.')}))}catch(i){e.alert("Error creating database table",String(i||"").replace(/^Error: /g,""))}}},{type:yn.c.CANCEL,callback:function(){a.close()}}],{width:"600px"});a.body.innerHTML=i.parse({}),a.body.setAttribute("data-dialog-role","csv-connector-create-table-dialog"),t(a.body).each((function(){t(this).on("click","label[data-role=database-source] a",(function(){r.editAdvancedCSVSettingsPreferencesAction()})),t(this).find("label[data-role=csv-file] input[type=file]").on("change",(function(){o=this.files[0],t(a.body).find("label[data-role=csv-file]").addClass("has-file").find("span.file-name").text(o.name),this.value=null})),t(this).find("label[data-role=csv-file] a").on("click",(function(){t(a.body).find("label[data-role=csv-file]").removeClass("has-file").find("span.file-name").text(""),o=null}))}))})).fail((function(t){e.createNotification('Failed to load "modules/RulesV3/resources/create-new-table-action.html',!1,yn.d.ERROR,!0)}))}},{key:"editAdvancedCSVSettingsPreferencesAction",value:function(){var t,e,n,r;t=this.app.getJQuery(),e=this.app,this.app,n=this.app.getResourceManager(),r=this,n.get("/modules/RulesV3/resources/edit-csv-import-file-options.html").then((function(n){var i=new An.a(n),o=JSON.parse(JSON.stringify(r.csvParserOptions)),a=e.createDialog("Advanced options",[{type:yn.c.DONE,callback:function(){t(a.body).each((function(){t(this).find("label[data-role=auto-trim-all-fields] input").each((function(){r.csvParserOptions.autoTrimAllFields=this.checked})),t(this).find("label[data-role=enclose-all-fields] input").each((function(){r.csvParserOptions.allColumnsAreEnclosed=this.checked})),t(this).find("label[data-role=end-of-line] select").each((function(){r.csvParserOptions.endOfLineCharacter=r.html2RawString(this.value)})),t(this).find("label[data-role=columns-terminated-by] select").each((function(){r.csvParserOptions.columnsTerminatedBy=r.html2RawString(this.value)})),t(this).find("label[data-role=fields-escaped-by] select").each((function(){r.csvParserOptions.fieldsEscapedBy=r.html2RawString(this.value)})),t(this).find("label[data-role=columns-enclosed-by] select").each((function(){r.csvParserOptions.columnsEnclosedBy=r.html2RawString(this.value)}))})),a.close()}},{type:yn.c.CANCEL,callback:function(){a.close()}}],{width:"700px"});a.body.innerHTML=i.parse(o),a.body.setAttribute("data-dialog-role","csv-connector-edit-csv-options"),t(a.body).each((function(){t(this).find("label[data-role=auto-trim-all-fields] input").each((function(){this.checked=o.autoTrimAllFields})),t(this).find("label[data-role=enclose-all-fields] input").each((function(){this.checked=o.allColumnsAreEnclosed})),t(this).find("label[data-role=end-of-line] select").each((function(){this.value=r.rawString2HTML(o.endOfLineCharacter)})),t(this).find("label[data-role=columns-terminated-by] select").each((function(){this.value=r.rawString2HTML(o.columnsTerminatedBy)})),t(this).find("label[data-role=fields-escaped-by] select").each((function(){this.value=r.rawString2HTML(o.fieldsEscapedBy)})),t(this).find("label[data-role=columns-enclosed-by] select").each((function(){this.value=r.rawString2HTML(o.columnsEnclosedBy)})),t(this).find("form").on("submit",(function(t){t.preventDefault(),t.stopPropagation()}))}))})).fail((function(t){e.createNotification('Failed to load "modules/RulesV3/resources/edit-csv-import-file-options.html',!0,yn.d.ERROR,!0)}))}},{key:"exploreDatabasesAction",value:function(){var t,e,n,r,i;t=this.app.getJQuery(),e=this.app,n=this.app,r=this.app.getResourceManager(),i=this,r.get("/modules/RulesV3/resources/explore-database-dialog.html").then((function(r){var o,a,s={tables:function(){for(var t=[],e=n.getDatabase().enumerateTables(),r=0,i=e.length;r<i;r++){var o=n.getDatabase().getTable(e[r].name);t.push({name:e[r].name,isRemote:o.isRemote(),isInMemory:!o.isRemote()&&!o.isVirtual(),isVirtual:o.isVirtual(),isTransactional:o.isTransactional(),isIndexable:o.isIndexable()})}return t}()},u=new An.a(r),c=e.createDialog("Explore database",[],{width:"920px",height:"600px"});c.body.innerHTML=u.parse(s),c.dialog.setAttribute("data-dialog-role","explore-database-dialog"),t(c.body).on("click","[data-role=table]",(function(){!function(e){console.warn("set view: ",e),e!==a&&(t(c.dialog).attr("data-has-selected-table",""),t(c.body).find("[data-role=tables-list] > [data-role=table]").each((function(){t(this).attr("data-selected",this.getAttribute("data-name")===e?"":null)})),a=e,o=o||new In(i.app.getJQuery()).withSortingEnabled(!0),window.g=o,t(c.body).find("[data-role=selected-table]").each((function(){this.appendChild(o.getRootDOMNode()),n.getDatabase().getTable(e).isVirtual()?o.withCollection(new Fn(t,e,n.getDatabase())).withEmptyStateHTML("Table <b>"+e+"</b> is a virtual table, which is only available in <b>view form</b> mode."):o.withCollection(new Ln(t,e,n.getDatabase())).withEmptyStateHTML("There are no items to show in this view")})))}(this.getAttribute("data-name"))})),t(c.body).on("click","[data-role=tables-operations] button[data-role=drop-database]",(function(){var n=null;t(c.body).find("[data-role=tables-list] > [data-role=table][data-selected]").each((function(){n=this.getAttribute("data-name")})),n&&e.prompt("Confirm table deletion",'Are you sure you want to delete table "'+n+'"?',(function(){i.app.getDatabase().dropTable(n,{applicationConfig:btoa(i.app.getDatabase().getApplicationConfig())}).then((function(){t(c.body).find("[data-role=tables-list] > [data-role=table][data-selected]").remove(),o&&o.getRootDOMNode()&&o.getRootDOMNode().parentNode.removeChild(o.getRootDOMNode()),t(c.dialog).attr("data-has-selected-table",null)})).catch((function(t){e.alert("Failed to delete table",'Failed to delete table "'+a+'"')}))}))})).on("click","[data-role=tables-operations] button[data-role=download-database]",(function(){var r=null;t(c.body).find("[data-role=tables-list] > [data-role=table][data-selected]").each((function(){r=this.getAttribute("data-name")})),r&&(n.getDatabase().getTable(r).isVirtual()?e.alert("Table not exportable",'Table "'+r+'" is a virtual table, and cannot be exported to CSV!'):i.app.getDatabase().downloadTableAsCSV(r,{applicationConfig:btoa(i.app.getDatabase().getApplicationConfig())}).then((function(t){"string"===typeof t?On.download(t,r+".csv","text/csv"):"object"===V()(t)&&t.value?On.download(t.value,r+".csv","text/csv"):e.alert("Table export failed!","There was an error exporting your table as CSV!")})).catch((function(t){e.alert("Table export failed!","There was an error exporting your table as CSV!"),console.error(t)})))})).on("click","[data-role=tables-operations] button[data-role=database-indexes]",(function(){var e=null;t(c.body).find("[data-role=tables-list] > [data-role=table][data-selected]").each((function(){e=this.getAttribute("data-name")})),e&&i.editTableIndexes(e)}))})).fail((function(t){e.createNotification('Failed to load "modules/RulesV3/resources/explore-database-dialog.html"',!0,yn.d.ERROR,!0)}))}},{key:"editFormRulesAction",value:function(){var t,e,n,r,i;t=this.app.getJQuery(),e=this.app,n=this.app,r=this.app.getResourceManager(),i=this,t.when(r.get("/modules/RulesV3/resources/edit-rules-dialog.html")).then((function(r){n.getDatabase().getJQLFormConfiguration({applicationConfig:btoa(n.getDatabase().getApplicationConfig())}).then((function(o){var a,s,u,c=new An.a(r),l=Vn.createFromJQLFormRulesConfiguration(o||[],n.getFormControlsList(),n.getDatabase(),t,i),d=e.createDialog("Edit SQL rules",[{type:yn.c.SAVE,callback:function(){n.getDatabase().saveJQLFormConfiguration(l.getJQLConfiguration(),{applicationConfig:btoa(n.getDatabase().getApplicationConfig())}).then((function(){d.close()})).catch((function(){e.alert("Error saving configuration","There was an error saving configuration. Please fix errors, and try again")}))}},{type:yn.c.CANCEL,callback:function(){d.close()}}],{width:"800px",height:"800px"});d.dialog.setAttribute("data-dialog-role","edit-sql-rules"),d.body.innerHTML=c.parse({});var h=function(t){for(;u.firstChild;)u.removeChild(u.firstChild);if(t){u.setAttribute("data-rule-uid",String(t.getUniqueId()));for(var e=t.getActions(),n=e.length,r=0;r<n;r++)u.appendChild(e[r].getRootDOMNode()),e[r].asyncInitCodeMirrorEditor();t.setSelectedAction(t.getActions()[0]||null)}else u.removeAttribute("data-rule-id")};t(d.body).find("[data-role=rules]").each((function(){t(a=this).on("click","> [data-role=rule]",(function(){var t=~~this.getAttribute("data-rule-uid"),e=l.getRuleByUniqueId(t);l.setSelectedRule(e),h(e)}))})),t(d.body).find("[data-role=actions]").each((function(){t(u=this).on("mousedown","> [data-role=action]",(function(){var t=l.getSelectedRule();t.setSelectedAction(t.getActionByUniqueId(~~this.getAttribute("data-action-uid")))}))})),t(d.body).find("[data-role=rules-toolbar]").each((function(){s=this})),t(d.body).find("[data-role=actions-toolbar]").each((function(){t(this).on("click","button[data-role=create-action]",(function(){var e,r,o=~~u.getAttribute("data-rule-uid"),a=l.getRuleByUniqueId(o);e=a,r=new Bn(n.getFormControlsList(),n.getDatabase(),t,i),e.addAction(r),u.appendChild(r.getRootDOMNode()),r.asyncInitCodeMirrorEditor(),e.setSelectedAction(r),e.onErrorStateChanged()})).on("click","button[data-role=delete-action]",(function(){var t=~~u.getAttribute("data-rule-uid"),n=l.getRuleByUniqueId(t);if(n){var r,i,o=n.getSelectedAction();o&&(r=n,i=o,e.prompt("Delete action","Are you sure you want to delete this action?",(function(){u.removeChild(i.getRootDOMNode()),r.deleteAction(i),r.setSelectedAction(null),r.onErrorStateChanged()})))}})).on("click","button[data-role=move-up]",(function(){var t=l.getSelectedRule();if(t){var e=t.getSelectedAction();e&&t.moveActionUp(e)}})).on("click","button[data-role=move-down]",(function(){var t=l.getSelectedRule();if(t){var e=t.getSelectedAction();e&&t.moveActionDown(e)}}))})),t(s).on("click","button[data-role=create-rule]",(function(){var t;t=new Pn(n.getFormControlsList()),l.addRule(t),a.appendChild(t.getRootDOMNode()),l.setSelectedRule(t),h(t)})).on("click","button[data-role=delete-rule]",(function(){var t=l.getSelectedRule();t&&function(t){e.prompt("Delete rule","Are you sure you want to delete this rule containing "+t.getActions().length+" actions?",(function(){for(l.deleteRule(t),a.removeChild(t.getRootDOMNode());u.firstChild;)u.removeChild(u.firstChild)}))}(t)})).on("click","button[data-role=move-up]",(function(){l.moveRuleUp(l.getSelectedRule())})).on("click","button[data-role=move-down]",(function(){l.moveRuleDown(l.getSelectedRule())})),function(){for(;a.firstChild;)a.removeChild(a.firstChild);for(var t=0,e=l.getRules(),n=e.length;t<n;t++)a.appendChild(e[t].getRootDOMNode());if(l.getRules().length){var r=l.getRules()[0];l.setSelectedRule(r),h(r)}}()})).catch((function(t){throw t}))}))}},{key:"getTestConnectionButton",value:function(){return this.app.getJQuery()("[data-role=csv-remote-connection-dialog] #connection-test-button")}},{key:"getConnectionDialogFormSerializedData",value:function(){return btoa(this.app.getJQuery()("#form-connection-dialog").serialize())}},{key:"getDialogSaveButton",value:function(){return this.app.getJQuery()(".ui-dialog .ui-buttons button.btn-secondary-cta")}},{key:"disableDialogSaveButton",value:function(){var t=this.getDialogSaveButton();t&&t.attr("disabled","disabled")}},{key:"enableDialogSaveButton",value:function(){var t=this.getDialogSaveButton();t&&t.removeAttr("disabled")}},{key:"disableDialogTestConnectionButton",value:function(){var t=this.getTestConnectionButton();t&&t.attr("disabled","disabled")}},{key:"enableDialogTestConnectionButton",value:function(){var t=this.getTestConnectionButton();t&&t.removeAttr("disabled")}},{key:"setTextConnectionValue",value:function(t){this.getObjectConnectionTestInput().val(t)}},{key:"testConnection",value:function(){var t,e,n=this,r=(this.getTestConnectionButton(),this.getObjectTestConnectionMessageContainer()),i=this.getObjectTestConnectionMessageExtraDetailsContainer(),o=this.getObjectTestConnectionLoaderContainer(),a=this.getConnectionDialogFormSerializedData();this.disableDialogTestConnectionButton(),t=this.app.getJQuery(),this.app,e=this.app,this.app.getResourceManager(),r.hide(),r.removeClass("errorInDialog"),i.html(""),o.show(),t.when(t.ajax("/sf_applications_actions.php",{type:"POST",data:{someaction:"applications_csvconnector_remote_test_connection",formid:String(e.getFormId()),appid:String(e.getApplicationId()),application_service:"36",formData:a}})).then((function(t,e){n.enableDialogTestConnectionButton();var a=JSON.parse(t);o.hide(),a.success?(r.removeClass("errorInDialog"),i.html(""),n.setTextConnectionValue(1),n.enableDialogSaveButton(),n.disableDialogTestConnectionButton()):(r.addClass("errorInDialog"),i.html(a.errorDetails),n.setTextConnectionValue(0),n.disableDialogSaveButton(),n.enableDialogTestConnectionButton()),r.show(),r.html(a.message)})).fail((function(t){o.hide(),r.show(),r.html(t.toString),n.enableDialogTestConnectionButton()}))}},{key:"getObjectTestConnectionLoaderContainer",value:function(){return this.app.getJQuery()(".ui-dialog .ui-body  [data-role=test-connection-loader]")}},{key:"getObjectTestConnectionMessageContainer",value:function(){return this.app.getJQuery()(".ui-dialog .ui-body  [data-role=csv-remote-test-connection-message]")}},{key:"getObjectTestConnectionMessageExtraDetailsContainer",value:function(){return this.app.getJQuery()(".ui-dialog .ui-body  [data-role=csv-remote-test-connection-message-extra-details]")}},{key:"getObjectConnectionTestInput",value:function(){return this.app.getJQuery()("#connection-test")}},{key:"isConnectionTested",value:function(){return Boolean(1==this.getObjectConnectionTestInput().val())}},{key:"applyOriginalState",value:function(){this.setTextConnectionValue(0),this.getObjectTestConnectionMessageContainer().hide(),this.disableDialogSaveButton(),this.enableDialogTestConnectionButton(),this.getObjectTestConnectionMessageContainer().attr("title","")}},{key:"fillConnectionFields",value:function(){var t={};try{t=JSON.parse(window["CSVConnectorApplicationBox"+String(this.app.getApplicationId())].getConfig())}catch(e){}t&&t.connection&&(t.connection.dbType&&this.app.getJQuery()('form[name="form-connection-dialog"] #connection-type').val(t.connection.dbType),t.connection.host&&this.app.getJQuery()('form[name="form-connection-dialog"] #connection-host').val(t.connection.host),t.connection.port&&this.app.getJQuery()('form[name="form-connection-dialog"] #connection-port').val(t.connection.port),t.connection.user&&this.app.getJQuery()('form[name="form-connection-dialog"] #connection-username').val(t.connection.username),t.connection.dbname&&this.app.getJQuery()('form[name="form-connection-dialog"] #connection-database-name').val(t.connection.dbname),t.connection.isPublicConnection&&this.app.getJQuery()('form[name="form-connection-dialog"] #connection-is-public').val(t.connection.isPublicConnection))}},{key:"useExternalDbAction",value:function(){var t,e,n,r=this;t=this.app.getJQuery(),e=this.app,n=this.app,this.app.getResourceManager().get("/modules/RulesV3/resources/connect-external-db-dialog.html").then((function(i){var o=e.createDialog("Connect to external database",[{type:yn.c.SAVE,callback:function(){if(r.isConnectionTested()){var e=r.getConnectionDialogFormSerializedData();t.when(t.ajax("/sf_applications_actions.php",{type:"POST",data:{someaction:"applications_csvconnector_remote_save_connection",formid:String(n.getFormId()),appid:String(n.getApplicationId()),application_service:"36",formData:e}})).then((function(e,r){var i=JSON.parse(e);i&&i.data&&i.data.useRemoteDatabaseText&&t("#CSVAppBoxConnectionSetExternalDBText-"+String(n.getApplicationId())).html(i.data.useRemoteDatabaseText),window["CSVConnectorApplicationBox"+String(n.getApplicationId())].withConfig(i.config),window["CSVConnectorApplicationBox"+String(n.getApplicationId())].updateRulesV3Data(i),window["CSVConnectorApplicationBox"+String(n.getApplicationId())].applyUseConnectionExternalDB(),o.close()})).fail((function(t){}))}}},{type:yn.c.CANCEL,callback:function(){o.close()}}],{width:"600px"});o.body.innerHTML=i,r.applyOriginalState(),r.fillConnectionFields()}))}},{key:"removeApplicationAction",value:function(){var t,e,n;t=this.app.getJQuery(),e=this.app,n=this.app,this.app.getResourceManager().get("/modules/RulesV3/resources/remove-application-dialog.html").then((function(r){var i=e.createDialog("Remove application",[{type:yn.c.DELETE,callback:function(){var e=t(i.body).find("[name=delete-sql-rules]").is(":checked");t.when(t.ajax("/sf_applications_actions.php",{type:"POST",data:{someaction:"applications_remove",formid:String(n.getFormId()),application_id:String(n.getApplicationId()),application_service:"36",withRules:e}}),n.getDatabase().deleteAllAssociatedSettingsAndAllTables({applicationconfig:btoa(n.getDatabase().getApplicationConfig())})).then((function(t,e){i.close()})).fail((function(t){}))}},{type:yn.c.CANCEL,callback:function(){i.close()}}],{width:"500px"});i.body.innerHTML=r}))}},{key:"rawString2HTML",value:function(t){return JSON.stringify(t||"").replace(/(^"|"$)/g,"").replace(/^\\\\$/g,"\\").replace(/^\\"$/g,'"')}},{key:"html2RawString",value:function(t){return'"'===t?'"':JSON.parse('"'+t.replace(/^\\$/g,"\\\\")+'"')}},{key:"convertJQLColumnTypeToGridColumnType",value:function(t){switch(t){case f.STRING:return yn.b.STRING;case f.NUMBER:return yn.b.NUMBER;case f.BOOLEAN:return yn.b.BOOLEAN;case f.NULL:default:return yn.b.UNKNOWN}}},{key:"editTableIndexes",value:function(t){var e,n,r,i;e=this.app.getJQuery(),n=this.app,r=this.app,i=this.app.getResourceManager(),r.getDatabase().getTable(t).isIndexable()?i.get("/modules/RulesV3/resources/edit-table-indexes-dialog.html").then((function(i){var o,a=r.getDatabase().getTable(t),s=new An.a(i),u=n.createDialog("Edit indexes",[{type:yn.c.SAVE,callback:function(){for(var e=[],i=0,a=o.getRows(),s=a.length;i<s;i++)(a[i].getDataAt(2)||a[i].getDataAt(3))&&e.push({autoIncrement:a[i].getDataAt(3),unique:a[i].getDataAt(2),name:a[i].getDataAt(0)});r.getDatabase().getTable(t).alterIndexes(e).then((function(){u.close()})).catch((function(t){console.error(t),n.alert("Error modifying indexes","There was an error while trying to modify the table indexes!")}))}},{type:yn.c.CANCEL,callback:function(){u.close()}}],{width:"500px",height:"500px"});u.dialog.setAttribute("data-dialog-role","edit-table-indexes"),u.body.innerHTML=s.parse({}),(o=new In(e).withSortingEnabled(!1)).createColumn().withColumnName("Column").withColumnType(yn.b.STRING).withEditable(!1).withWidth(165),o.createColumn().withColumnName("Type").withColumnType(yn.b.STRING).withEditable(!1).withWidth(70),o.createColumn().withColumnName("Unique").withColumnType(yn.b.BOOLEAN).withEditable(!0).withWidth(60).withValueRenderer((function(t){return t?'<span class="i-md i123-key icon"></span>':""})),o.createColumn().withColumnName("Auto").withColumnType(yn.b.BOOLEAN).withEditable(!0).withWidth(60).withValueRenderer((function(t){return t?'<span class="i-md i123-input_number icon"></span>':""}));for(var c=0,l=a.describe(),d=l.length;c<d;c++){var h=function(t){for(var e=[!1,!1],n=0,r=a.getIndexes(),i=r.length;n<i;n++){var o=r[n].getDescriptors();if(1===o.length&&o[0].name===t){e[0]=r[n].isUnique(),e[1]=r[n].isAutoIncrement();break}}return e}(l[c].name);o.createRow([l[c].name,l[c].type,h[0],h[1]]).withRowIndex(c+1)}o.on("row-updated",(function(t,e,r,i){if(3===e)if(t.getDataAt(1)===f.NUMBER){if(r){t.setDataAt(2,!0);for(var a=0,s=o.getRows(),u=s.length;a<u;a++)s[a]!==t&&s[a].getDataAt(3)&&s[a].setDataAt(3,!1)}}else r&&(t.setDataAt(3,!1),n.alert("Not supported","Only columns of type number can be Auto Incremented"))})),u.body.appendChild(o.getRootDOMNode())})):n.alert("Table not indexable",'Table "'+t+'" does not support indexes!')}},{key:"browserForDatabaseTablesDialog",value:function(){return t=this.app.getJQuery(),e=this.app.getDatabase(),n=this.app.getResourceManager(),r=this.app,t.Deferred((function(i){n.get("/modules/RulesV3/resources/browse-for-database-table-dialog.html").then((function(n){var o=new An.a(n),a=r.createDialog("Insert table in SQL query",[{type:yn.c.OK,callback:function(){a.close();var t=s.getSelectedIndex();if(-1!==t){var e=s.getRows()[t].getDataAt(0);i.resolve(e)}else i.reject(new Error("Canceled"))}},{type:yn.c.CANCEL,callback:function(){a.close(),i.reject(new Error("Close button pressed"))}}],{width:"500px",height:"500px",onCloseButtonClick:function(){i.reject(new Error("Dialog closed by user"))}});a.dialog.setAttribute("data-dialog-role","browse-for-table-dialog"),a.body.innerHTML=o.parse({});var s=new In(t).withEmptyStateHTML("There are no database tables created").withSortingEnabled(!1);a.body.appendChild(s.getRootDOMNode()),s.createColumn().withColumnName("table").withWidth(300).withColumnType(yn.b.STRING);for(var u=0,c=e.enumerateTables(),l=c.length;u<l;u++)s.createRow([c[u].name])}))})).promise();var t,e,n,r}},{key:"browserForDatabaseTableColumnsDialog",value:function(){return t=this.app.getJQuery(),e=this.app.getDatabase(),n=this.app.getResourceManager(),r=this.app,t.Deferred((function(i){n.get("/modules/RulesV3/resources/browse-for-database-table-dialog.html").then((function(n){var o=new An.a(n),a=r.createDialog("Insert table column in SQL query",[{type:yn.c.OK,callback:function(){a.close();var t=s.getSelectedIndex();if(-1!==t){var e=s.getRows()[t].getDataAt(1);i.resolve(e)}else i.reject(new Error("Canceled"))}},{type:yn.c.CANCEL,callback:function(){a.close(),i.reject(new Error("Close button pressed"))}}],{width:"500px",height:"500px",onCloseButtonClick:function(){i.reject(new Error("Dialog closed by user"))}});a.dialog.setAttribute("data-dialog-role","browse-for-table-dialog"),a.body.innerHTML=o.parse({});var s=new In(t).withEmptyStateHTML("There are no database tables created").withSortingEnabled(!1);a.body.appendChild(s.getRootDOMNode()),s.createColumn().withColumnName("table").withWidth(100).withColumnType(yn.b.STRING),s.createColumn().withColumnName("column").withWidth(150).withColumnType(yn.b.STRING),s.createColumn().withColumnName("type").withWidth(100).withColumnType(yn.b.STRING);for(var u=0,c=e.enumerateTables(),l=c.length;u<l;u++)for(var d=e.getTable(c[u].name).describe(),h=0,f=d.length;h<f;h++)s.createRow([c[u].name,d[h].name,d[h].type])}))})).promise();var t,e,n,r}},{key:"browseForFormsControlDialog",value:function(){return t=this.app.getJQuery(),e=this.app.getFormControlsList(),n=this.app.getResourceManager(),r=this.app,t.Deferred((function(i){n.get("/modules/RulesV3/resources/browse-for-form-control-dialog.html").then((function(n){var o=new An.a(n),a=r.createDialog("Insert control in SQL query",[{type:yn.c.OK,callback:function(){a.close();var e=s.getSelectedIndex();if(-1!==e){var n=s.getRows()[e].getDataAt(0),r=t(a.body).find("input[name=insert-as-binding]").is(":checked");i.resolve((r?":":"")+n)}else i.reject(new Error("Canceled"))}},{type:yn.c.CANCEL,callback:function(){a.close(),i.reject(new Error("Close button pressed"))}}],{width:"500px",height:"500px",onCloseButtonClick:function(){i.reject(new Error("Dialog closed by user"))}});a.dialog.setAttribute("data-dialog-role","browse-for-control-dialog"),a.body.innerHTML=o.parse({});var s=new In(t).withEmptyStateHTML("There are no database tables created").withSortingEnabled(!1);t(a.body).find("[data-role=grid-placeholder]").get(0).appendChild(s.getRootDOMNode()),s.createColumn().withColumnName("control_id").withColumnCaption("ID").withWidth(180).withColumnType(yn.b.STRING),s.createColumn().withColumnName("control_label").withColumnCaption("Label").withWidth(200).withColumnType(yn.b.STRING);for(var u=0,c=e.length;u<c;u++)s.createRow([e[u].id,e[u].name])}))})).promise();var t,e,n,r}},{key:"queryDatabaseAction",value:function(){var t,e,n;t=this.app.getJQuery(),e=this.app,n=this.app,this.app.getResourceManager().get("/modules/RulesV3/resources/query-database-dialog.html").then((function(r){var o,a,s=new An.a(r),u=e.createDialog("Database console",[],{width:"800px"});u.dialog.setAttribute("data-dialog-role","database-console"),u.body.innerHTML=s.parse({});var c=function(e){var r=+new Date;t(u.body).find("[data-role=query-result]").each((function(){var o;(o=this).innerHTML="<div data-role=loading>Loading</div>",t(u.body).find("[data-role=query-statistics]").each((function(){!function(s){s.innerHTML="";try{var u=n.getDatabase().createStatement(e);n.getDatabase().executeStatement(u,{}).then((function(e){o.innerHTML="";var n=+new Date;switch(u.getStatementType()){case i.SELECT:!function(e,n,r,i){if(a?a.dispose():a=new In(t).withSortingEnabled(!1).withEmptyStateHTML("Query returned no rows"),e.appendChild(a.getRootDOMNode()),r.getRows().length){var o=r.getRows()[0],s=0;for(var u in o)a.createColumn().withColumnName("col_"+s).withColumnCaption(u).withWidth(100).withColumnType(yn.b.UNKNOWN),s++;for(var c=0,l=r.getRowsAsArray().length,d=r.getRowsAsArray(),h=0,f=d.length;h<f;h++)if(a.createRow(d[h]).withRowIndex(h+1),h>=49){c=f-50;break}t(n).append('<div data-role="info">'+l+" row(s) found in "+(i/1e3).toFixed(3)+" seconds</div>"),0!=c&&t(n).append('<div data-role="info">'+c+" row(s) were not displayed</div>")}}(o,s,e,n-r);break;case i.DELETE:case i.UPDATE:case i.INSERT:!function(e,n,r){t(e).append('<div data-role="info">'+n.getAffectedRows()+" row(s) affected in "+(r/1e3).toFixed(3)+" seconds</div>")}(s,e,n-r)}})).catch((function(t){var e;o.innerHTML="",e=M()(t,Error)?String(t):"string"===typeof t?t:JSON.stringify(t,void 0,4);var n=document.createElement("div");n.setAttribute("data-role","error"),n.textContent=e.replace(/^Error: /g,""),o.appendChild(n)}))}catch(l){o.innerHTML="";var c=document.createElement("div");c.setAttribute("data-role","error"),c.textContent=l.toString().replace(/^Error: /g,""),o.appendChild(c)}}(this)}))}))};t(u.body).find("[data-role=query-builder]").each((function(){var t,e;null===(e=o=null===(t=CodeMirror)||void 0===t?void 0:t(this,{value:"",mode:"text/x-mariadb",lineNumbers:!0}))||void 0===e||e.setSize("100%","80px")})),t(u.body).on("click","button[data-role=run-query]",(function(){var t,e,n=null!==(t=null===(e=o)||void 0===e?void 0:e.getValue())&&void 0!==t?t:"";c(n)}))}))}},{key:"onChangeConnectionCredentials",value:function(){this.applyOriginalState()}}]),t}(),Gn=n(79),qn=function(){function t(e){E()(this,t),x()(this,"jq",void 0),x()(this,"i18n",void 0),this.jq=e,this.i18n=new Gn.a,this.i18n.setTranslations({myforms_UI_btn_SAVE:"Save",myforms_UI_btn_CANCEL:"Cancel",myforms_UI_btn_OK:"Ok",myforms_UI_btn_CLOSE:"Close",myforms_UI_btn_YES:"Yes",myforms_UI_btn_NO:"No",applications_UI_btn_CREATE:"Create",applications_UI_btn_DONE:"Done",myforms_UI_btn_DELETE:"Delete"})}return T()(t,[{key:"getI18n",value:function(){return this.i18n}},{key:"getJQuery",value:function(){return this.jq}}]),t}(),Hn=function(){function t(){E()(this,t)}return T()(t,null,[{key:"create",value:function(t){return an.createVirtualTable([{name:"index",type:f.NUMBER,default:0},{name:"name",type:f.STRING,default:0},{name:"label",type:f.STRING,default:""},{name:"readOnly",type:f.BOOLEAN,default:!1},{name:"disabled",type:f.BOOLEAN,default:!1},{name:"value",type:f.STRING,default:""},{name:"checked",type:f.BOOLEAN,default:!1},{name:"visible",type:f.BOOLEAN,default:!1},{name:"calculated",type:f.BOOLEAN,default:!1}])}}]),t}(),Qn=function(){function t(){E()(this,t)}return T()(t,null,[{key:"create",value:function(t){return an.createVirtualTable([{name:"userId",type:f.NUMBER,default:0},{name:"userEmail",type:f.STRING,default:""}])}}]),t}();function Jn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Yn=function(t){S()(n,t);var e=Jn(n);function n(t,r,i,o,a){var s,u,c;return E()(this,n),s=e.call(this,new qn(i),i,null,null),x()(R()(s),"applicationId",void 0),x()(R()(s),"formId",void 0),x()(R()(s),"jq",void 0),x()(R()(s),"db",void 0),x()(R()(s),"resourceManager",void 0),x()(R()(s),"formControlsList",[]),x()(R()(s),"commandDispatcher",void 0),x()(R()(s),"onApplicationEnableCheckboxClick",void 0),x()(R()(s),"onCreateNewDatabaseButtonClick",void 0),x()(R()(s),"onExploreDatabaseButtonClick",void 0),x()(R()(s),"onCreateSQLRuleButtonClick",void 0),x()(R()(s),"onRemoveApplicationButtonClick",void 0),x()(R()(s),"onQueryDatabaseButtonClick",void 0),x()(R()(s),"sessionVirtualTable","session"),x()(R()(s),"controlsVirtualTable","controls"),s.jq=i,s.db=o,s.resourceManager=new Tn(s.jq,{}),s.applicationId=t,s.formId=r,s.formControlsList=a,s.commandDispatcher=new jn(R()(s)),u=R()(s),c=s.jq,u.db.hasTable("controls")||u.db.withTable("controls",Hn.create(u.db)),u.db.hasTable("session")||u.db.withTable("session",Qn.create(u.db)),u.onApplicationEnableCheckboxClick=function(t){u._onApplicationEnableCheckboxClick(this)},u.onCreateNewDatabaseButtonClick=function(t){u._onCreateNewTableButtonClick(this)},u.onExploreDatabaseButtonClick=function(t){u._onExploreDatabaseButtonClick(this)},u.onCreateSQLRuleButtonClick=function(t){u._onCreateSQLRuleButtonClick(this)},u.onRemoveApplicationButtonClick=function(t){u._onRemoveApplicationButtonClick(this)},u.onQueryDatabaseButtonClick=function(t){u._onQueryDatabaseButtonClick(this)},c(document).on("click","#app_isenabled_".concat(u.applicationId),u.onApplicationEnableCheckboxClick).on("click","#csvConnectorAppCreateDatabaseButton-".concat(u.applicationId),u.onCreateNewDatabaseButtonClick).on("click","#csvConnectorAppExploreDatabaseButton-".concat(u.applicationId),u.onExploreDatabaseButtonClick).on("click","#csvConnectorAppCustomizeButton-".concat(u.applicationId),u.onCreateSQLRuleButtonClick).on("click","#csvConnectorAppRemoveButton-".concat(u.applicationId),u.onRemoveApplicationButtonClick).on("click","#csvConnectorAppQueryDatabaseButton-".concat(u.applicationId),u.onQueryDatabaseButtonClick).on("click","#csvConnectorAppUseExternalDBButton-".concat(u.applicationId),u._onUseExternalDbButtonClick.bind(u)).on("click","[data-role=csv-remote-connection-dialog] #connection-test-button",u._onTestConnectionButtonClick.bind(u)),c(document).on("change",".ui-dialog select[name=connection-type]",u._onChangeConnectionCredentials.bind(u)).on("change",".ui-dialog input[name=connection-host]",u._onChangeConnectionCredentials.bind(u)).on("change",".ui-dialog input[name=connection-port]",u._onChangeConnectionCredentials.bind(u)).on("change",".ui-dialog input[name=connection-username]",u._onChangeConnectionCredentials.bind(u)).on("change",".ui-dialog input[name=connection-password]",u._onChangeConnectionCredentials.bind(u)).on("change",".ui-dialog input[name=connection-database-name]",u._onChangeConnectionCredentials.bind(u)),s}return T()(n,[{key:"getApplicationId",value:function(){return this.applicationId}},{key:"getFormId",value:function(){return this.formId}},{key:"getResourceManager",value:function(){return this.resourceManager}},{key:"getJQuery",value:function(){return this.jq}},{key:"getDatabase",value:function(){return this.db}},{key:"getFormControlsList",value:function(){return this.formControlsList}},{key:"destroy",value:function(){var t,e;t=this.jq,e=this,t(document).off("click","#app_isenabled_"+e.applicationId,e.onApplicationEnableCheckboxClick).off("click","#csvConnectorAppCreateDatabaseButton-"+e.applicationId,e.onCreateNewDatabaseButtonClick).off("click","#csvConnectorAppExploreDatabaseButton-"+e.applicationId,e.onExploreDatabaseButtonClick).off("click","#csvConnectorAppCustomizeButton-"+e.applicationId,e.onCreateSQLRuleButtonClick).off("click","#csvConnectorAppRemoveButton-"+e.applicationId,e.onRemoveApplicationButtonClick),this.db=null,this.jq=null}},{key:"_onApplicationEnableCheckboxClick",value:function(t){this.commandDispatcher.setApplicationEnabledStateAction(t.checked)}},{key:"_onCreateNewTableButtonClick",value:function(t){this.commandDispatcher.createNewTableAction()}},{key:"_onExploreDatabaseButtonClick",value:function(t){this.commandDispatcher.exploreDatabasesAction()}},{key:"_onCreateSQLRuleButtonClick",value:function(t){this.commandDispatcher.editFormRulesAction()}},{key:"_onRemoveApplicationButtonClick",value:function(t){this.commandDispatcher.removeApplicationAction()}},{key:"_onQueryDatabaseButtonClick",value:function(t){this.commandDispatcher.queryDatabaseAction()}},{key:"_onUseExternalDbButtonClick",value:function(){this.commandDispatcher.useExternalDbAction()}},{key:"_onTestConnectionButtonClick",value:function(){this.commandDispatcher.testConnection()}},{key:"_onChangeConnectionCredentials",value:function(){this.commandDispatcher.onChangeConnectionCredentials()}},{key:"createNotification",value:function(t){arguments.length>2&&void 0!==arguments[2]||yn.d.DEFAULT;console.warn("NOTIFICATION: ",t);try{messages_to_user_push_message(t,0,this.applicationId)}catch(e){}return null}},{key:"getVirtualTables",value:function(){this.db.hasTable(this.controlsVirtualTable)||this.db.withTable(this.controlsVirtualTable,Hn.create(this.db)),this.db.hasTable(this.sessionVirtualTable)||this.db.withTable(this.sessionVirtualTable,Qn.create(this.db))}}]),n}(bn),Wn=function(){function t(){E()(this,t)}return T()(t,null,[{key:"initDatabaseFunctions",value:function(t){return t.hasLocalFunction("DATE_DIFF")||t.withFunction("DATE_DIFF",gn.DATE_DIFF,!0,!1),t.hasLocalFunction("DATE_BETWEEN")||t.withFunction("DATE_BETWEEN",gn.DATE_BETWEEN,!0,!1),t.hasLocalFunction("DATE_GET_NUMBER_OF_DAYS")||t.withFunction("DATE_GET_NUMBER_OF_DAYS",gn.DATE_GET_NUMBER_OF_DAYS,!0,!1),t.hasLocalFunction("TIME_GET_NUMBER_OF_MINUTES")||t.withFunction("TIME_GET_NUMBER_OF_MINUTES",gn.TIME_GET_NUMBER_OF_MINUTES,!0,!1),t.hasLocalFunction("DATE_FORMAT")||t.withFunction("DATE_FORMAT",gn.DATE_FORMAT,!0,!1),t.hasLocalFunction("CURRENT_DATE")||t.withFunction("CURRENT_DATE",gn.CURRENT_DATE,!0,!1),t.hasLocalFunction("DATE_COMPARE")||t.withFunction("DATE_COMPARE",gn.DATE_COMPARE,!0,!1),t.hasLocalFunction("TIME_COMPARE")||t.withFunction("TIME_COMPARE",gn.TIME_COMPARE,!0,!1),t.hasLocalFunction("DATE_ADD_INTERVAL")||t.withFunction("DATE_ADD_INTERVAL",gn.DATE_ADD_INTERVAL,!0,!1),t.hasLocalFunction("CONCAT")||t.withFunction("CONCAT",gn.CONCAT,!0,!0),t.hasLocalFunction("SUM")||t.withFunction("SUM",gn.SUM,!0,!1),t.hasLocalFunction("EQUALS")||t.withFunction("EQUALS",gn.EQUALS,!0,!1),t.hasLocalFunction("COMPARE")||t.withFunction("COMPARE",gn.COMPARE,!0,!1),t.hasLocalFunction("IF")||t.withFunction("IF",gn.IF,!0,!1),t.hasLocalFunction("BOOL")||t.withFunction("BOOL",gn.BOOL,!0,!1),t.hasLocalFunction("INT")||t.withFunction("INT",gn.INT,!0,!1),t.hasLocalFunction("FLOAT")||t.withFunction("FLOAT",gn.FLOAT,!0,!1),t.hasLocalFunction("STRING")||t.withFunction("STRING",gn.STRING,!0,!1),t.hasLocalFunction("ALERT")||t.withFunction("ALERT",gn.ALERT,!0,!1),t.hasLocalFunction("DATE_UID")||t.withFunction("DATE_UID",gn.UNIQUE_ID_BASED_ON_DATE_MILISECOND,!0,!1),t.hasLocalFunction("WORKING_DAYS_BETWEEN")||t.withFunction("WORKING_DAYS_BETWEEN",null,!1,!0),t.hasLocalFunction("RESERVATION_DATE_INTERSECT")||t.withFunction("RESERVATION_DATE_INTERSECT",null,!1,!0),t.hasLocalFunction("FROM_BASE64")||t.withFunction("FROM_BASE64",gn.FROM_BASE64,!0,!0),t.hasLocalFunction("TO_BASE64")||t.withFunction("TO_BASE64",gn.TO_BASE64,!0,!0),t.hasLocalFunction("REPLACE")||t.withFunction("REPLACE",gn.REPLACE,!0,!0),t}}]),t}(),zn=function(){function t(){E()(this,t),x()(this,"queries",{}),x()(this,"active",!1)}return T()(t,[{key:"setActive",value:function(t){return this.active=t,this.active||(this.queries={}),this}},{key:"isActive",value:function(){return this.active}},{key:"isQueryDuplicate",value:function(t){if(!this.active)return!1;if("number"===typeof this.queries[t]&&+new Date-this.queries[t]<50)return!0;return!1}},{key:"storeQuery",value:function(t){this.active&&(this.queries[t]=+new Date)}}]),t}(),Kn=function(){function t(){E()(this,t),x()(this,"enabled",!1);try{window.localStorage&&window.localStorage.getItem&&window.localStorage.getItem("FormRulesDebugging")?(console.log("Rules v3 Logger enabled"),this.enabled=!0):console.log("Rules v3 Logger disabled")}catch(e){console.log("Rules v3 Logger disabled")}}return T()(t,[{key:"log",value:function(){if(!this.enabled&&!window.FormRulesDebugging)return this;for(var t=new Date,e=["[LOG]["+t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear()+"@"+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()+","+t.getMilliseconds()+"]"],n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(var o=0,a=r.length;o<a;o++)e.push("string"===typeof r[o]?r[o]:JSON.stringify(r[o]));return console.log(e.join(" ")),this}}]),t}();function $n(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var i=O()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k()(this,n)}}var Xn=function(t){S()(n,t);var e=$n(n);function n(){var t;return E()(this,n),t=e.call(this),x()(R()(t),"jq",void 0),x()(R()(t),"rpcEndpointName",void 0),x()(R()(t),"rpcEndpointSalesforceName",void 0),x()(R()(t),"authorizationToken",void 0),x()(R()(t),"authorizationTokenSalesforce",void 0),x()(R()(t),"db",void 0),x()(R()(t),"adminApplication",void 0),x()(R()(t),"rules",[]),x()(R()(t),"domAbstractionLayer",void 0),x()(R()(t),"logger",void 0),x()(R()(t),"initialized",!1),x()(R()(t),"previouslySubmittedData",null),x()(R()(t),"duplicateQueryDiscarder",void 0),x()(R()(t),"salesforceAffectedControlsTriggers",void 0),x()(R()(t),"salesforceAffectedControls",void 0),x()(R()(t),"statementCache",{}),x()(R()(t),"applicationConfig",void 0),t.db=Wn.initDatabaseFunctions(new fn),t.logger=new Kn,t.duplicateQueryDiscarder=new zn,t}return T()(n,[{key:"getDatabase",value:function(){return this.db}},{key:"withJQuery",value:function(t){return this.jq=t,this.db.initPlanner(),this}},{key:"withRPCEndpointName",value:function(t){return this.db.withRPCEndpointName(this.rpcEndpointName=t),this}},{key:"withRPCEndpointSalesforceName",value:function(t){return this.db.withRPCEndpointSalesforceName(this.rpcEndpointSalesforceName=t),this}},{key:"withAuthorizationToken",value:function(t){return this.db.withAuthorizationToken(this.authorizationToken=t),this}},{key:"withApplicationConfig",value:function(t){return this.db.withApplicationConfig(this.applicationConfig=t),this}},{key:"withAuthorizationTokenSalesforce",value:function(t){return this.db.withAuthorizationTokenSalesforce(this.authorizationTokenSalesforce=t),this}},{key:"withJQLBackendTables",value:function(t){if(null===t)return this;for(var e=this.db.enumerateTables(),n=0,r=e.length;n<r;n++)this.db.unmountTable(e[n].name);return this.db.withTablesList(t),this}},{key:"withJQLTable",value:function(t,e){return this.db.withTable(t,e),this}},{key:"exploreDatabase",value:function(t){if(!this.domAbstractionLayer)throw new Error("This operation is only available in view-form page!");new jn(t).exploreDatabasesAction()}},{key:"bootstrapCSVConnectorApplication",value:function(t,e,n){var r=/^applications_box_([\d]+)$/.exec(t);if(r){var i=parseInt(r[1]);if(!isNaN(i)){if(this.adminApplication){if(this.adminApplication.getApplicationId()===i&&this.adminApplication.getFormId()===e)return void this.adminApplication.getVirtualTables();this.adminApplication.destroy()}this.adminApplication=new Yn(i,e,window.$||window.$x,this.getDatabase(),n),console.warn("Bootstrapped admin application #".concat(i))}}}},{key:"withDOMAbstractionLayer",value:function(t){return this.domAbstractionLayer=t,this}},{key:"getRules",value:function(){return this.rules}},{key:"resetRules",value:function(t){this.rules=t}},{key:"withRules",value:function(t){for(var e=0,n=(t||[]).length;e<n;e++)this.rules.push(t[e]);return this.logger.log("Added ".concat((t||[]).length," rules in RulesV3 engine")),this}},{key:"initializeInFormViewMode",value:function(){var t=this;if(this.initialized)throw new Error("RulesV3: Engine already initialized!");if(!this.domAbstractionLayer)throw new Error("Cannot initialize RulesV3 engine: No DOMAbstraction layer provided at this point!");return this.domAbstractionLayer.on("control-event",(function(e,n,r,i){t.dispatchControlEvent(e,r,n,i)})),this.domAbstractionLayer.trigger("initialize"),this.initialized=!0,this.logger.log("Initialized RulesV3 in view form mode"),this.markUsedSalesforceControls(),this}},{key:"dispatchControlEvent",value:function(t,e,n,r){var i=this,o=e;if(t===y.REINITIALIZE&&this.initializeControlValueWithPreviouslySubmittedData(e,n,r),this.rules&&this.rules.length){var a=null,s=null,u=null;n&&(!function(t){try{var e=t(n).parents('div[data-type="repeatable-group"]')[0];a=t(e).data("repeatable-path")}catch(r){}}(window.jQuery||window.$||window.$x),a&&(u="".concat(e,"_rp").concat(String(a)),s=n.value));for(var c=0,l=this.rules.length;c<l;c++)null!==(e="undefined"!==typeof this.rules[c].repeatablePath&&a?u:o)&&this.areTheSameControlIDs(String(this.rules[c].controlId),e)&&null!==t&&(t===this.rules[c].eventType||y.ALL_EVENTS===this.rules[c].eventType&&y.REINITIALIZE!==t||y.INIT===t&&this.rules[c].isRule)&&null!==this.rules[c].actions&&this.rules[c].actions.length&&this.executeControlEventActions(this.rules[c].actions,(function(){return s||i.domAbstractionLayer.getControlValueById(e)}),r,t,a);this.trigger("dispatch",e)}}},{key:"initializeControlValueWithPreviouslySubmittedData",value:function(t,e,n){null!==this.domAbstractionLayer&&this.domAbstractionLayer.initializeControlValueWhenTheFormIsPrefillingASubmission(t,n)}},{key:"areTheSameControlIDs",value:function(t,e){return t.replace(/^control_/g,"")===e.replace(/^control_/g,"")}},{key:"executeControlEventActions",value:function(t,e,n,r,o){var a=this;o=o||null;for(var s,u,c,l=+new Date,d=0,h=t.length;d<h;d++)if((s=t[d].jql)&&!/^([\s]+)?$/.test(s))if(this.duplicateQueryDiscarder.isQueryDuplicate(s))this.logger.log("DISCARD: ",s),setTimeout((function(){a.db.triggerNextQuery()}));else if(this.duplicateQueryDiscarder.storeQuery(s),!t[d].controlId||this.domAbstractionLayer.controlExistsInForm(String(t[d].controlId))){u=function(){return{this:r!==y.REINITIALIZE?e():n}},this.logger.log("SQL: ".concat(s));try{var f=s+t[d].controlId;(c=this.statementCache[f])||(c=this.db.createStatement(s),this.statementCache[f]=c),function(t,e){a.db.executeStatement(t,u).then((function(n){var r=+new Date;t.getStatementType()===i.SELECT?(a.logger.log("".concat(t.getStatementType()," statement (").concat(((r-l)/1e3).toFixed(3),"s): "),JSON.stringify(n.getRowsAsArray()),"to control: ",String(e.controlId)),a.domAbstractionLayer.setControlValueById(String(e.controlId),n.getRowsAsArray(),null,o)):a.logger.log("".concat(t.getStatementType()," statement (").concat(((r-l)/1e3).toFixed(3),"s): "),n.getAffectedRows(),"rows were affected")})).catch((function(t){console.warn("SQL failed: ".concat(String(s),": ").concat(t.toString())),console.error(t)}))}(c,t[d])}catch(p){this.logger.log("JQL failed: ","".concat(String(s),": ").concat(p.toString())),console.error(p)}}else console.warn("SKIP QUERY: ","".concat(s," => control id ").concat(JSON.stringify(t[d].controlId)," not found in form")),setTimeout((function(){a.db.triggerNextQuery()}));else setTimeout((function(){a.db.triggerNextQuery()}))}},{key:"getLogger",value:function(){return this.logger}},{key:"getDOMAbstractionLayer",value:function(){return this.domAbstractionLayer}},{key:"getPreviouslySubmittedFormData",value:function(){return this.previouslySubmittedData}},{key:"getSubmissionValueForControlId",value:function(t){return null!==this.previouslySubmittedData&&t&&this.previouslySubmittedData.hasOwnProperty(t)?this.previouslySubmittedData[t]:null}},{key:"createDOMAbstractionLayer",value:function(t){switch(t){case hn.LEGACY_EDITOR:return new mn(this.jq,this);case hn.LATEST_EDITOR_VERSION:return new window.AbstractionLayerV2(arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]);default:throw new Error("Sorry, but RulesV3 engine don't know how to create a DOM Abstraction layer of type ".concat(JSON.stringify(this.domAbstractionLayer)))}}},{key:"getDuplicateQueryDiscarder",value:function(){return this.duplicateQueryDiscarder}},{key:"markUsedSalesforceControls",value:function(){for(var t=[],e=[],n=0,r=this.rules||[],i=r.length;n<i;n++)if(r[n].isSalesforce){t.push(r[n].controlId);for(var o=0,a=r[n].actions||[],s=a.length;o<s;o++)e.push(a[o].controlId)}this.salesforceAffectedControlsTriggers=t,this.salesforceAffectedControls=e}},{key:"getSalesforceAffectedControlsTriggers",value:function(){return this.salesforceAffectedControlsTriggers}},{key:"getSalesforceAffectedControls",value:function(){return this.salesforceAffectedControls}},{key:"hasSalesforceRule",value:function(){return this.rules.some((function(t){return!0===t.isSalesforce}))}},{key:"isSalesforceWithPrefillTriggerRule",value:function(){var t=[y.REINITIALIZE,y.CHANGE];return this.rules.every((function(e){return t.includes(e.eventType)}))}},{key:"shouldShowLoaderOnSalesforce",value:function(){return this.hasSalesforceRule&&!this.isSalesforceWithPrefillTriggerRule()}},{key:"shouldShowLoader",value:function(){return 0!==this.rules.length&&(this.rules.length>n.SHOW_LOADER_RULES_COUNT||this.shouldShowLoaderOnSalesforce())}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new n)}}]),n}(_.a);x()(Xn,"SHOW_LOADER_RULES_COUNT",100),x()(Xn,"instance",void 0),window.RulesV3=Xn,window.JQLNativeFunctions=gn}});